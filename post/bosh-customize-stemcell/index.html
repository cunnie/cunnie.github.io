<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to Customize a BOSH Stemcell | Brian Cunnie's Technical Blog</title><meta name=keywords content><meta name=description content="In this blog post, we describe the procedure we followed in order to create a custom Google Compute Engine (GCE) stemcell with a user cunnie whose ~/.ssh/authorized_keys is pre-populated with a specific public key.
Customizing stemcells is highly discouraged — it voids your warranty, and opens a host of problems which will only cause pain. This post is intended as an educational demonstration of the stemcell building process. You have been warned."><meta name=author content="Brian Cunnie"><link rel=canonical href=https://blog.nono.io/post/bosh-customize-stemcell/><link crossorigin=anonymous href=/assets/css/stylesheet.min.6cba0d81b5f3f42bb578d49f402ba4175aa72b43def148780b8ad714c957c6f5.css integrity="sha256-bLoNgbXz9Cu1eNSfQCukF1qnK0Pe8Uh4C4rXFMlXxvU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.nono.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.nono.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.nono.io/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.nono.io/apple-touch-icon.png><link rel=mask-icon href=https://blog.nono.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.104.3"><script async src="https://www.googletagmanager.com/gtag/js?id=G-0NJ11E527T"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0NJ11E527T",{anonymize_ip:!1})}</script><meta property="og:title" content="How to Customize a BOSH Stemcell"><meta property="og:description" content="In this blog post, we describe the procedure we followed in order to create a custom Google Compute Engine (GCE) stemcell with a user cunnie whose ~/.ssh/authorized_keys is pre-populated with a specific public key.
Customizing stemcells is highly discouraged — it voids your warranty, and opens a host of problems which will only cause pain. This post is intended as an educational demonstration of the stemcell building process. You have been warned."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.nono.io/post/bosh-customize-stemcell/"><meta property="og:image" content="https://nono.io/images/brian_cunnie_profile.jpg"><meta property="article:section" content="post"><meta property="article:published_time" content="2016-09-23T05:35:01-07:00"><meta property="article:modified_time" content="2016-09-23T05:35:01-07:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nono.io/images/brian_cunnie_profile.jpg"><meta name=twitter:title content="How to Customize a BOSH Stemcell"><meta name=twitter:description content="In this blog post, we describe the procedure we followed in order to create a custom Google Compute Engine (GCE) stemcell with a user cunnie whose ~/.ssh/authorized_keys is pre-populated with a specific public key.
Customizing stemcells is highly discouraged — it voids your warranty, and opens a host of problems which will only cause pain. This post is intended as an educational demonstration of the stemcell building process. You have been warned."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.nono.io/post/"},{"@type":"ListItem","position":2,"name":"How to Customize a BOSH Stemcell","item":"https://blog.nono.io/post/bosh-customize-stemcell/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to Customize a BOSH Stemcell","name":"How to Customize a BOSH Stemcell","description":"In this blog post, we describe the procedure we followed in order to create a custom Google Compute Engine (GCE) stemcell with a user cunnie whose ~/.ssh/authorized_keys is pre-populated with a specific public key.\nCustomizing stemcells is highly discouraged — it voids your warranty, and opens a host of problems which will only cause pain. This post is intended as an educational demonstration of the stemcell building process. You have been warned.","keywords":[],"articleBody":"In this blog post, we describe the procedure we followed in order to create a custom Google Compute Engine (GCE) stemcell with a user cunnie whose ~/.ssh/authorized_keys is pre-populated with a specific public key.\nCustomizing stemcells is highly discouraged — it voids your warranty, and opens a host of problems which will only cause pain. This post is intended as an educational demonstration of the stemcell building process. You have been warned.\nThis blog post describes customizing a stemcell, not building a stemcell from scratch. The BOSH GitHub repository has an excellent description of the procedure to build a stemcell.\n0. Download the Stemcell to Customize We need to make our changes from a Linux machine (macOS can not mount Linux filesystems as a loopback device). [macOS mount]\nWe repurpose our BOSH Lite Director as a stemcell-building VM (BOSH Lite is already installed on our macOS workstation, it has mounted our macOS’s filesystem under /vagrant (simplifies stemcell transfer and eliminates running-out-of-space issues), and using it to build our stemcell in no way impedes its ability to perform as a BOSH Director).\n# we use the BOSH Lite directory as a staging point cd ~/workspace/bosh-lite # download the stemcell: curl -L https://bosh.io/d/stemcells/bosh-google-kvm-ubuntu-trusty-go_agent?v=3263.3 -o tmp/custom_stemcell_3263.3.tgz Don’t download the “Light” stemcell. Certain IaaSes (e.g. Amazon Web Services (AWS)) have “Light” stemcells as well as “Regular” stemcells, but “Light” stemcells aren’t true stemcells (i.e. they don’t contain a bootable disk image); instead they are pointers to the actual stemcell (in Amazon’s case, a list of Amazon Machine Images (AMIs) by region). Always be sure to download the regular stemcell. Light stemcells are small, typically ~20kB; Regular stemcells are large, typically ~600MB. On bosh.io, a light stemcell will be denoted with the word “Light” (e.g. “AWS Xen-HVM Light”).\nDownload the “Raw” stemcell. These instructions assume a “raw” stemcell and may not work with non-raw images (e.g. vSphere’s .ovf format). OpenStack for example has two types of stemcells: “Raw” and “Regular”. “Raw” stemcell’s disk image can be mounted via a loop device and modified. The regular stemcell’s disk image is QEMU Copy On Write (QCOW) formatted and cannot be mounted (thus cannot be customized). On bosh.io, a raw stemcell will be denoted with the word “raw” (e.g. “OpenStack KVM (raw)”).\n1. Use BOSH Lite to Modify stemcell # bring up BOSH Lite (if it isn't already running): vagrant up vagrant ssh # we are now in a Linux box; we will customize our stemcell here: # create our mountpoint sudo mkdir /mnt/stemcell cd /vagrant/tmp mkdir stemcell image cd stemcell # unpack the stemcell: tar xvf ../custom_stemcell_3263.3.tgz cd ../image # unpack the bootable Linux disk image tar xvf ../stemcell/image # connect the bootable Linux disk image to a loopback device # the extracted file may be `disk.raw` instead of `root.img` sudo losetup /dev/loop0 root.img # probe for the new partitions sudo partprobe /dev/loop0 # mount the disk image sudo mount /dev/loop0p1 /mnt/stemcell # we like to use chroot to avoid accidentally polluting the BOSH Lite filesystem sudo chroot /mnt/stemcell /bin/bash # update the stemcell to 3263.3.1 echo -n 3263.3.1 \u003e /var/vcap/bosh/etc/stemcell_version # we create user 'cunnie' in the admin, bosh_sudoers, and bosh_sshers groups # (sudo \u0026 ssh), passwd `c1oudc0w`. # CentOS stemcells should use group wheel instead of group admin useradd -m -G admin,bosh_sudoers,bosh_sshers -p $(openssl passwd -1 -salt xyz c1oudc0w) cunnie # change to the new user's homedir cd ~cunnie # we create the directory mkdir .ssh # install the public key echo 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC9An3FOF/vUnEA2VkaYHoACjbmk3G4yAHE3lXnGpIhz3EV5k4B5RzEFKZnAIFcX18eBjYQIN9xQO0L9xkhlCyrQHrnXBjCDwt/BuQSiRvp3tlx9g0tGyuuJRI5n656Shc7w/g4UbrQWUBdLKjxTT4kTgAdK+1pgDbhAXdPtMwt4D/sz5OEFdf5O5Cp+0spxC+Ctdb94taZhScqB4xt6dRl7bwI28vZdq6Sjg/hbMBbTXzSJ17+ql8LJtXiUHO5W7MwNtKdZmlglOUy3CEIwDz3FdI9zKEfnfpfosp/hu+07/8Y02+U/fsjQyJy8ZCSsGY2e2XpvNNVj/3mnj8fP5cX cunnie@nono.io' \u003e .ssh/authorized_keys # set ownerships and permissions chmod 700 .ssh chmod 600 .ssh/authorized_keys chown -R cunnie:cunnie .ssh # we're done, hop back to our \"normal\" BOSH Lite root filesystem exit # unmount our filesystem sudo umount /mnt/stemcell # delete our loop device sudo losetup -d /dev/loop0 # tar up our modified Linux bootable disk image tar czvf ../stemcell/image * Configure a DNS server if the customization requires connecting to the internet (e.g. apt install telnetd): echo 'nameserver 8.8.8.8' \u003e /etc/resolv.conf.\nWe find it good practice to modify the stemcell number when customizing a stemcell — it prevents many kinds of errors, and well worth the additional time spent re-compiling BOSH releases. In this example, we bump the stemcell number to 3263.3.1:\n# change back to our stemcell directory cd ../stemcell # update the manifest to use a new stemcell number vi stemcell.MF -version: '3263.3' +version: '3263.3.1' bosh_protocol: 1 sha1: 6dec63560e5ee516e8495eeb39553e81049e19b8 operating_system: ubuntu-trusty cloud_properties: name: bosh-google-kvm-ubuntu-trusty-go_agent - version: '3263.3' + version: '3263.3.1' We create our new, custom stemcell; we put the new version number in the name:\n# create the stemcell tar czvf ../custom_stemcell_3263.3.1.tgz * # exit the Vagrant ssh session exit 2. Upload the New Stemcell We upload our new stemcell to our director, which takes ~6 minutes with our internet connection.\n# we upload the stemcell to our BOSH Director bosh upload-stemcell ~/workspace/bosh-lite/tmp/custom_stemcell_3263.3.1.tgz 3. Deploy We use the new BOSH Golang CLI to deploy: [Golang CLI]\nbosh deploy -d concourse concourse-ntp-pdns-gce.yml \\ -l \u003c(lpass show --note deployments) \\ -l \u003c(curl -L https://raw.githubusercontent.com/cunnie/sslip.io/master/conf/sslip.io%2Bnono.io.yml) \\ --no-redact 4. Test We test our custom stemcell by ssh’ing into our newly-deployed VM (ns-gce.nono.io) using the special user account we created, “cunnie”, with our private key:\nssh -i ~/.ssh/google cunnie@ns-gce.nono.io Don’t assume too much when customizing. Stemcells are different beasts than most UNIX distributions: for example, /tmp/ is not world-writeable, dæmons such as rsyslog and sshd are restarted several times by several different mechanisms (e.g. upstart, kill), directories are obscured by subsequent bind-mounts (don’t add any files to /var/log and expect to find them). Tread carefully, the ice is thin.\n5. Alternate Stemcell Formats: .vmdk Virtual Machine Disk (VMDK) is a format frequently used by VMware and VirtualBox virtualization.\nThe above instructions do not work for .vmdk-format disks; however, such disks can be customized with additional steps. The steps require the executable qemu-img, a utility which converts different disk formats.\nWe need to convert the .vmdk to a raw disk image (root.img); Run the following command after running tar xvf ../stemcell/image in the instructions above:\nif [ -f image-disk1.vmdk ]; then qemu-img convert image-disk1.vmdk -O raw root.img fi Similarly, when we tar up the new stemcell, we need to convert the raw disk image (root.img) back to a .vmdk. Run the following command after running sudo losetup -d /dev/loop0 in the instructions above:\nif [ -f image-disk1.vmdk ]; then rm image-disk1.vmdk qemu-img convert root.img -O vmdk image-disk1.vmdk # For Vmware Vsphere # qemu-img convert -o subformat=streamOptimized,compat6 root.img -O vmdk image-disk1.vmdk rm root.img SHASUM=($(shasum image-disk1.vmdk)) perl -pi -e \"s/vmdk\\)=\\s\\S+\\$/vmdk\\)= $SHASUM/\" image.mf fi Note that we have taken the opportunity to update the Secure Hash Algorithms (SHA) inside the image’s manifest (image.mf). If we didn’t update the SHA, the stemcell would fail to upload to the director.\nFootnotes [macOS mount] We would be interested if someone has mounted a Linux filesystem to a macOS machine using a loopback device. If the procedure is not too burdensome, we may include it in our blog post.\n[Golang CLI] We are using an experimental Golang-based BOSH command line interface (CLI), and the arguments are slightly different than those of canonical Ruby-based BOSH CLI; however, the arguments are similar enough to be readily adapted to the Ruby CLI (e.g. the Golang CLI’s bosh upload-stemcell equivalent to the Ruby CLI’s bosh upload stemcell (no dash)).\nThe new CLI also allows variable interpolation, with the value of the variables to interpolate passed in via YAML file on the command line. This feature allows the redaction of sensitive values (e.g. SSL keys) from the manifest. The format is similar to Concourse’s interpolation, except that interpolated values are bracketed by double parentheses “((key))”, whereas Concourse uses double curly braces “{{key}}”.\nSimilar to Concourse, the experimental BOSH CLI allows the YAML file containing the secrets to be passed via the command line, e.g. -l ~/secrets.yml or -l \u003c(lpass show --note secrets)\nThe Golang CLI is in alpha and should not be used on production systems.\nCorrections \u0026 Updates 2017-07-04\nAdded instructions for customizing .vmdk stemcells.\n2017-04-12\nUserid created is a member of the bosh_sshers and bosh_sudoers groups. Newer stemcells have been hardened to only allow ssh access to users who are a member of the bosh_sshers group.\n","wordCount":"1361","inLanguage":"en","datePublished":"2016-09-23T05:35:01-07:00","dateModified":"2016-09-23T05:35:01-07:00","author":{"@type":"Person","name":"Brian Cunnie"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.nono.io/post/bosh-customize-stemcell/"},"publisher":{"@type":"Organization","name":"Brian Cunnie's Technical Blog","logo":{"@type":"ImageObject","url":"https://blog.nono.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://blog.nono.io/ accesskey=h title="Brian Cunnie's Technical Blog (Alt + H)">Brian Cunnie's Technical Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.nono.io/>Home</a>&nbsp;»&nbsp;<a href=https://blog.nono.io/post/>Posts</a></div><h1 class=post-title>How to Customize a BOSH Stemcell</h1><div class=post-meta>September 23, 2016&nbsp;·&nbsp;7 min&nbsp;·&nbsp;Brian Cunnie&nbsp;|&nbsp;<a href=https://github.com/cunnie/cunnie.github.io/tree/master/content/post/bosh-customize-stemcell.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>In this blog post, we describe the procedure we followed in order to create a
custom Google Compute Engine (GCE) stemcell with a user <code>cunnie</code> whose
<code>~/.ssh/authorized_keys</code> is pre-populated with a specific public key.</p><div class="alert alert-error" role=alert><p>Customizing stemcells is highly discouraged — it voids your warranty, and opens
a host of problems which will only cause pain. This post is intended as an
educational demonstration of the stemcell building process. You have been warned.</p></div><div class="alert alert-info" role=alert><p>This blog post describes <i>customizing</i> a stemcell, not <i>building</i> a
stemcell from scratch. The BOSH GitHub repository has an <a class=alert-link href=https://github.com/cloudfoundry/bosh/tree/4115bef082722ec24d69d41d0deb54017679c94c/bosh-stemcell>excellent
description</a> of the procedure to <i>build</i> a stemcell.</p></div><h2 id=0-download-the-stemcell-to-customize>0. Download the Stemcell to Customize<a hidden class=anchor aria-hidden=true href=#0-download-the-stemcell-to-customize>#</a></h2><p>We need to make our changes from a Linux machine (macOS can not mount Linux
filesystems as a loopback device). <sup><a href=#macos_mount class=alert-link>[macOS mount]</a></sup></p><p>We repurpose our <a href=https://github.com/cloudfoundry/bosh-lite>BOSH Lite</a> Director
as a stemcell-building VM (BOSH Lite is already installed on our macOS
workstation, it has mounted our macOS&rsquo;s filesystem under <code>/vagrant</code> (simplifies
stemcell transfer and eliminates running-out-of-space issues), and using it to
build our stemcell in no way impedes its ability to perform as a BOSH Director).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> <span style=color:#75715e># we use the BOSH Lite directory as a staging point</span>
</span></span><span style=display:flex><span>cd ~/workspace/bosh-lite
</span></span><span style=display:flex><span> <span style=color:#75715e># download the stemcell:</span>
</span></span><span style=display:flex><span>curl -L https://bosh.io/d/stemcells/bosh-google-kvm-ubuntu-trusty-go_agent?v<span style=color:#f92672>=</span>3263.3 -o tmp/custom_stemcell_3263.3.tgz
</span></span></code></pre></div><div class="alert alert-warning" role=alert><p><b>Don&rsquo;t download the &ldquo;Light&rdquo; stemcell</b>. Certain IaaSes (e.g. Amazon Web
Services (AWS)) have &ldquo;Light&rdquo; stemcells as well as &ldquo;Regular&rdquo; stemcells, but
&ldquo;Light&rdquo; stemcells aren&rsquo;t true stemcells (i.e. they don&rsquo;t contain a bootable disk
image); instead they are pointers to the actual stemcell (in Amazon&rsquo;s case, a
list of Amazon Machine Images (AMIs) by region). Always be sure to download the
regular stemcell. Light stemcells are small, typically ~20kB; Regular stemcells
are large, typically ~600MB. On <a class=alert-link href=http://bosh.io/>bosh.io</a>, a light stemcell will be denoted with the
word &ldquo;Light&rdquo; (e.g. &ldquo;AWS Xen-HVM Light&rdquo;).</p></div><div class="alert alert-warning" role=alert><p><b>Download the &ldquo;Raw&rdquo; stemcell</b>. These instructions assume a &ldquo;raw&rdquo; stemcell
and may not work with non-raw images (e.g. vSphere&rsquo;s .ovf format). OpenStack
for example has two types of stemcells: &ldquo;Raw&rdquo; and &ldquo;Regular&rdquo;. &ldquo;Raw&rdquo; stemcell&rsquo;s
disk image can be mounted via a loop device and modified. The regular stemcell&rsquo;s
disk image is QEMU Copy On Write (QCOW) formatted and cannot be mounted (thus
cannot be customized). On <a class=alert-link href=http://bosh.io/>bosh.io</a>, a raw stemcell will be denoted with the word
&ldquo;raw&rdquo; (e.g. &ldquo;OpenStack KVM (raw)&rdquo;).</p></div><h2 id=1-use-bosh-lite-to-modify-stemcell>1. Use BOSH Lite to Modify stemcell<a hidden class=anchor aria-hidden=true href=#1-use-bosh-lite-to-modify-stemcell>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> <span style=color:#75715e># bring up BOSH Lite (if it isn&#39;t already running):</span>
</span></span><span style=display:flex><span>vagrant up
</span></span><span style=display:flex><span>vagrant ssh
</span></span><span style=display:flex><span> <span style=color:#75715e># we are now in a Linux box; we will customize our stemcell here:</span>
</span></span><span style=display:flex><span> <span style=color:#75715e># create our mountpoint</span>
</span></span><span style=display:flex><span>sudo mkdir /mnt/stemcell
</span></span><span style=display:flex><span>cd /vagrant/tmp
</span></span><span style=display:flex><span>mkdir stemcell image
</span></span><span style=display:flex><span>cd stemcell
</span></span><span style=display:flex><span> <span style=color:#75715e># unpack the stemcell:</span>
</span></span><span style=display:flex><span>tar xvf ../custom_stemcell_3263.3.tgz
</span></span><span style=display:flex><span>cd ../image
</span></span><span style=display:flex><span> <span style=color:#75715e># unpack the bootable Linux disk image</span>
</span></span><span style=display:flex><span>tar xvf ../stemcell/image
</span></span><span style=display:flex><span> <span style=color:#75715e># connect the bootable Linux disk image to a loopback device</span>
</span></span><span style=display:flex><span> <span style=color:#75715e># the extracted file may be `disk.raw` instead of `root.img`</span>
</span></span><span style=display:flex><span>sudo losetup /dev/loop0 root.img
</span></span><span style=display:flex><span> <span style=color:#75715e># probe for the new partitions</span>
</span></span><span style=display:flex><span>sudo partprobe /dev/loop0
</span></span><span style=display:flex><span> <span style=color:#75715e># mount the disk image</span>
</span></span><span style=display:flex><span>sudo mount /dev/loop0p1 /mnt/stemcell
</span></span><span style=display:flex><span> <span style=color:#75715e># we like to use chroot to avoid accidentally polluting the BOSH Lite filesystem</span>
</span></span><span style=display:flex><span>sudo chroot /mnt/stemcell /bin/bash
</span></span><span style=display:flex><span> <span style=color:#75715e># update the stemcell to 3263.3.1</span>
</span></span><span style=display:flex><span>echo -n 3263.3.1 &gt; /var/vcap/bosh/etc/stemcell_version
</span></span><span style=display:flex><span> <span style=color:#75715e># we create user &#39;cunnie&#39; in the admin, bosh_sudoers, and bosh_sshers groups</span>
</span></span><span style=display:flex><span> <span style=color:#75715e># (sudo &amp; ssh), passwd `c1oudc0w`.</span>
</span></span><span style=display:flex><span> <span style=color:#75715e># CentOS stemcells should use group wheel instead of group admin</span>
</span></span><span style=display:flex><span>useradd -m -G admin,bosh_sudoers,bosh_sshers -p <span style=color:#66d9ef>$(</span>openssl passwd -1 -salt xyz c1oudc0w<span style=color:#66d9ef>)</span> cunnie
</span></span><span style=display:flex><span> <span style=color:#75715e># change to the new user&#39;s homedir</span>
</span></span><span style=display:flex><span>cd ~cunnie
</span></span><span style=display:flex><span> <span style=color:#75715e># we create the directory</span>
</span></span><span style=display:flex><span>mkdir .ssh
</span></span><span style=display:flex><span> <span style=color:#75715e># install the public key</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC9An3FOF/vUnEA2VkaYHoACjbmk3G4yAHE3lXnGpIhz3EV5k4B5RzEFKZnAIFcX18eBjYQIN9xQO0L9xkhlCyrQHrnXBjCDwt/BuQSiRvp3tlx9g0tGyuuJRI5n656Shc7w/g4UbrQWUBdLKjxTT4kTgAdK+1pgDbhAXdPtMwt4D/sz5OEFdf5O5Cp+0spxC+Ctdb94taZhScqB4xt6dRl7bwI28vZdq6Sjg/hbMBbTXzSJ17+ql8LJtXiUHO5W7MwNtKdZmlglOUy3CEIwDz3FdI9zKEfnfpfosp/hu+07/8Y02+U/fsjQyJy8ZCSsGY2e2XpvNNVj/3mnj8fP5cX cunnie@nono.io&#39;</span> &gt; .ssh/authorized_keys
</span></span><span style=display:flex><span> <span style=color:#75715e># set ownerships and permissions</span>
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>700</span> .ssh
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>600</span> .ssh/authorized_keys
</span></span><span style=display:flex><span>chown -R cunnie:cunnie .ssh
</span></span><span style=display:flex><span> <span style=color:#75715e># we&#39;re done, hop back to our &#34;normal&#34; BOSH Lite root filesystem</span>
</span></span><span style=display:flex><span>exit
</span></span><span style=display:flex><span> <span style=color:#75715e># unmount our filesystem</span>
</span></span><span style=display:flex><span>sudo umount /mnt/stemcell
</span></span><span style=display:flex><span> <span style=color:#75715e># delete our loop device</span>
</span></span><span style=display:flex><span>sudo losetup -d /dev/loop0
</span></span><span style=display:flex><span> <span style=color:#75715e># tar up our modified Linux bootable disk image</span>
</span></span><span style=display:flex><span>tar czvf ../stemcell/image *
</span></span></code></pre></div><div class="alert alert-success" role=alert><p>Configure a DNS server if the customization requires connecting to the internet
(e.g. <code>apt install telnetd</code>): <code>echo 'nameserver 8.8.8.8' > /etc/resolv.conf</code>.</p></div><p><p>We find it good practice to modify the stemcell number when customizing a
stemcell — it prevents many kinds of errors, and well worth the additional time
spent re-compiling BOSH releases. In this example, we bump the stemcell number
to <code>3263.3.1</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> <span style=color:#75715e># change back to our stemcell directory</span>
</span></span><span style=display:flex><span>cd ../stemcell
</span></span><span style=display:flex><span> <span style=color:#75715e># update the manifest to use a new stemcell number</span>
</span></span><span style=display:flex><span>vi stemcell.MF
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span><span style=color:#f92672>-version: &#39;3263.3&#39;
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+version: &#39;3263.3.1&#39;
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>bosh_protocol: 1
</span></span><span style=display:flex><span>sha1: 6dec63560e5ee516e8495eeb39553e81049e19b8
</span></span><span style=display:flex><span>operating_system: ubuntu-trusty
</span></span><span style=display:flex><span>cloud_properties:
</span></span><span style=display:flex><span>  name: bosh-google-kvm-ubuntu-trusty-go_agent
</span></span><span style=display:flex><span><span style=color:#f92672>-  version: &#39;3263.3&#39;
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+  version: &#39;3263.3.1&#39;
</span></span></span></code></pre></div><p>We create our new, custom stemcell; we put the new version number in the name:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> <span style=color:#75715e># create the stemcell</span>
</span></span><span style=display:flex><span>tar czvf ../custom_stemcell_3263.3.1.tgz *
</span></span><span style=display:flex><span> <span style=color:#75715e># exit the Vagrant ssh session</span>
</span></span><span style=display:flex><span>exit
</span></span></code></pre></div><h2 id=2-upload-the-new-stemcell>2. Upload the New Stemcell<a hidden class=anchor aria-hidden=true href=#2-upload-the-new-stemcell>#</a></h2><p>We upload our new stemcell to our director, which takes ~6 minutes with our
internet connection.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> <span style=color:#75715e># we upload the stemcell to our BOSH Director</span>
</span></span><span style=display:flex><span>bosh upload-stemcell ~/workspace/bosh-lite/tmp/custom_stemcell_3263.3.1.tgz
</span></span></code></pre></div><h2 id=3-deploy>3. Deploy<a hidden class=anchor aria-hidden=true href=#3-deploy>#</a></h2><p>We use the new BOSH Golang CLI to deploy: <sup>[<a href=#golangcli>Golang CLI</a>]</sup></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bosh deploy -d concourse concourse-ntp-pdns-gce.yml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -l &lt;<span style=color:#f92672>(</span>lpass show --note deployments<span style=color:#f92672>)</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -l &lt;<span style=color:#f92672>(</span>curl -L https://raw.githubusercontent.com/cunnie/sslip.io/master/conf/sslip.io%2Bnono.io.yml<span style=color:#f92672>)</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --no-redact
</span></span></code></pre></div><h2 id=4-test>4. Test<a hidden class=anchor aria-hidden=true href=#4-test>#</a></h2><p>We test our custom stemcell by ssh&rsquo;ing into our newly-deployed VM
(ns-gce.nono.io) using the special user account we created, &ldquo;cunnie&rdquo;, with our
private key:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh -i ~/.ssh/google cunnie@ns-gce.nono.io
</span></span></code></pre></div><div class="alert alert-warning" role=alert><p><b>Don&rsquo;t assume too much when customizing</b>. Stemcells are different beasts
than most UNIX distributions: for example, <code>/tmp/</code> is not world-writeable,
dæmons such as <code>rsyslog</code> and <code>sshd</code> are restarted several times by several
different mechanisms (e.g. upstart, <code>kill</code>), directories are obscured by
subsequent bind-mounts (don&rsquo;t add any files to <code>/var/log</code> and expect to find
them). Tread carefully, the ice is thin.</p></div><h2 id=5-alternate-stemcell-formats-vmdk>5. Alternate Stemcell Formats: <code>.vmdk</code><a hidden class=anchor aria-hidden=true href=#5-alternate-stemcell-formats-vmdk>#</a></h2><p><a href=https://en.wikipedia.org/wiki/VMDK>Virtual Machine Disk</a> (VMDK) is a
format frequently used by VMware and VirtualBox virtualization.</p><p>The above instructions do <em>not</em> work for <code>.vmdk</code>-format disks; however,
such disks <em>can</em> be customized with additional steps. The steps require
the executable <code>qemu-img</code>, a utility which converts different
disk formats.</p><p>We need to convert the <code>.vmdk</code> to a raw disk image (<code>root.img</code>);
Run the following command <em>after</em> running <code>tar xvf ../stemcell/image</code>
in the instructions above:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -f image-disk1.vmdk <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  qemu-img convert image-disk1.vmdk -O raw root.img
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p>Similarly, when we tar up the new stemcell, we need to convert
the raw disk image (<code>root.img</code>) back to a <code>.vmdk</code>. Run the
following command <em>after</em> running <code>sudo losetup -d /dev/loop0</code>
in the instructions above:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -f image-disk1.vmdk <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  rm image-disk1.vmdk
</span></span><span style=display:flex><span>  qemu-img convert root.img -O vmdk image-disk1.vmdk
</span></span><span style=display:flex><span>  <span style=color:#75715e># For Vmware Vsphere</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># qemu-img convert -o subformat=streamOptimized,compat6 root.img -O vmdk image-disk1.vmdk</span>
</span></span><span style=display:flex><span>  rm root.img
</span></span><span style=display:flex><span>  SHASUM<span style=color:#f92672>=(</span><span style=color:#66d9ef>$(</span>shasum image-disk1.vmdk<span style=color:#66d9ef>)</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  perl -pi -e <span style=color:#e6db74>&#34;s/vmdk\)=\s\S+\$/vmdk\)= </span>$SHASUM<span style=color:#e6db74>/&#34;</span> image.mf
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p>Note that we have taken the opportunity to update the
Secure Hash Algorithms
(<a href=https://en.wikipedia.org/wiki/Secure_Hash_AlgorithmsSHA>SHA</a>)
inside the image&rsquo;s manifest (<code>image.mf</code>).
If we didn&rsquo;t update the SHA, the stemcell would fail to upload to
the director.</p><hr><h2 id=footnotes>Footnotes<a hidden class=anchor aria-hidden=true href=#footnotes>#</a></h2><p><a name=macos_mount><sup>[macOS mount]</sup></a> We would be interested if
someone has mounted a Linux filesystem to a macOS machine using a loopback
device. If the procedure is not too burdensome, we may include it in our blog
post.</p><p><a name=golangcli><sup>[Golang CLI]</sup></a> We are using an experimental
Golang-based BOSH command line interface
(<a href=https://github.com/cloudfoundry/bosh-cli>CLI</a>), and the arguments are
slightly different than those of canonical Ruby-based <a href=https://github.com/cloudfoundry/bosh/tree/master/bosh_cli>BOSH
CLI</a>; however, the
arguments are similar enough to be readily adapted to the Ruby CLI (e.g. the
Golang CLI&rsquo;s <code>bosh upload-stemcell</code> equivalent to the Ruby CLI&rsquo;s <code>bosh upload stemcell</code> (no dash)).</p><p>The new CLI also allows variable interpolation, with the value of the variables
to interpolate passed in via YAML file on the command line. This feature allows
the redaction of sensitive values (e.g. SSL keys) from the manifest. The format
is similar to Concourse&rsquo;s interpolation, except that interpolated values are
bracketed by double parentheses &ldquo;((key))&rdquo;, whereas Concourse uses double curly
braces &ldquo;{{key}}&rdquo;.</p><p>Similar to Concourse, the experimental BOSH CLI allows the YAML file containing
the secrets to be passed via the command line, e.g. <code>-l ~/secrets.yml</code> or
<code>-l &lt;(lpass show --note secrets)</code></p><p>The Golang CLI is in alpha and should not be used on production systems.</p><h2 id=corrections--updates>Corrections & Updates<a hidden class=anchor aria-hidden=true href=#corrections--updates>#</a></h2><p><em>2017-07-04</em></p><p>Added instructions for customizing <code>.vmdk</code> stemcells.</p><p><em>2017-04-12</em></p><p>Userid created is a member of the <code>bosh_sshers</code> and <code>bosh_sudoers</code> groups.
Newer stemcells have been hardened to only allow ssh access to users who
are a member of the <code>bosh_sshers</code> group.</p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://blog.nono.io/post/nsx_with_bosh/><span class=title>« Prev Page</span><br><span>Leveraging NSX's Features with BOSH's vSphere CPI</span></a>
<a class=next href=https://blog.nono.io/post/updating-a-bosh-release/><span class=title>Next Page »</span><br><span>Updating a BOSH Release</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share How to Customize a BOSH Stemcell on twitter" href="https://twitter.com/intent/tweet/?text=How%20to%20Customize%20a%20BOSH%20Stemcell&url=https%3a%2f%2fblog.nono.io%2fpost%2fbosh-customize-stemcell%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to Customize a BOSH Stemcell on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.nono.io%2fpost%2fbosh-customize-stemcell%2f&title=How%20to%20Customize%20a%20BOSH%20Stemcell&summary=How%20to%20Customize%20a%20BOSH%20Stemcell&source=https%3a%2f%2fblog.nono.io%2fpost%2fbosh-customize-stemcell%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to Customize a BOSH Stemcell on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.nono.io%2fpost%2fbosh-customize-stemcell%2f&title=How%20to%20Customize%20a%20BOSH%20Stemcell"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to Customize a BOSH Stemcell on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.nono.io%2fpost%2fbosh-customize-stemcell%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to Customize a BOSH Stemcell on whatsapp" href="https://api.whatsapp.com/send?text=How%20to%20Customize%20a%20BOSH%20Stemcell%20-%20https%3a%2f%2fblog.nono.io%2fpost%2fbosh-customize-stemcell%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to Customize a BOSH Stemcell on telegram" href="https://telegram.me/share/url?text=How%20to%20Customize%20a%20BOSH%20Stemcell&url=https%3a%2f%2fblog.nono.io%2fpost%2fbosh-customize-stemcell%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://blog.nono.io/>Brian Cunnie's Technical Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>