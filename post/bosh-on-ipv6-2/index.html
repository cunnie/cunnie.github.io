<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Deploying BOSH VMs with IPv6 Addresses on vSphere | Brian Cunnie's Technical Blog</title><meta name=keywords content><meta name=description content="0. Abstract
BOSH is a VM orchestrator; a BOSH Director creates, configures, monitors, and
deletes VMs. The BOSH Director interoperates with a number of IaaSes
(Infrastructure as a Service), one of which is VMware vSphere, a virtualization
platform. BOSH traditionally operates exclusively within the IPv4 networking
space (i.e. the BOSH Director has an IPv4 address (e.g. 10.0.0.6), and the VMs
which it deploys also have IPv4 addresses); however, recent changes have
enabled IPv6 networking within the BOSH Framework."><meta name=author content="Brian Cunnie"><link rel=canonical href=https://blog.nono.io/post/bosh-on-ipv6-2/><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.nono.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.nono.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.nono.io/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.nono.io/apple-touch-icon.png><link rel=mask-icon href=https://blog.nono.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.nono.io/post/bosh-on-ipv6-2/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-0NJ11E527T"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0NJ11E527T")}</script><meta property="og:url" content="https://blog.nono.io/post/bosh-on-ipv6-2/"><meta property="og:site_name" content="Brian Cunnie's Technical Blog"><meta property="og:title" content="Deploying BOSH VMs with IPv6 Addresses on vSphere"><meta property="og:description" content="0. Abstract BOSH is a VM orchestrator; a BOSH Director creates, configures, monitors, and deletes VMs. The BOSH Director interoperates with a number of IaaSes (Infrastructure as a Service), one of which is VMware vSphere, a virtualization platform. BOSH traditionally operates exclusively within the IPv4 networking space (i.e. the BOSH Director has an IPv4 address (e.g. 10.0.0.6), and the VMs which it deploys also have IPv4 addresses); however, recent changes have enabled IPv6 networking within the BOSH Framework."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2018-01-16T19:12:22+00:00"><meta property="article:modified_time" content="2018-01-16T19:12:22+00:00"><meta property="og:image" content="https://nono.io/images/brian_cunnie_profile.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nono.io/images/brian_cunnie_profile.jpg"><meta name=twitter:title content="Deploying BOSH VMs with IPv6 Addresses on vSphere"><meta name=twitter:description content="0. Abstract
BOSH is a VM orchestrator; a BOSH Director creates, configures, monitors, and
deletes VMs. The BOSH Director interoperates with a number of IaaSes
(Infrastructure as a Service), one of which is VMware vSphere, a virtualization
platform. BOSH traditionally operates exclusively within the IPv4 networking
space (i.e. the BOSH Director has an IPv4 address (e.g. 10.0.0.6), and the VMs
which it deploys also have IPv4 addresses); however, recent changes have
enabled IPv6 networking within the BOSH Framework."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.nono.io/post/"},{"@type":"ListItem","position":2,"name":"Deploying BOSH VMs with IPv6 Addresses on vSphere","item":"https://blog.nono.io/post/bosh-on-ipv6-2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Deploying BOSH VMs with IPv6 Addresses on vSphere","name":"Deploying BOSH VMs with IPv6 Addresses on vSphere","description":"0. Abstract BOSH is a VM orchestrator; a BOSH Director creates, configures, monitors, and deletes VMs. The BOSH Director interoperates with a number of IaaSes (Infrastructure as a Service), one of which is VMware vSphere, a virtualization platform. BOSH traditionally operates exclusively within the IPv4 networking space (i.e. the BOSH Director has an IPv4 address (e.g. 10.0.0.6), and the VMs which it deploys also have IPv4 addresses); however, recent changes have enabled IPv6 networking within the BOSH Framework.\n","keywords":[],"articleBody":"0. Abstract BOSH is a VM orchestrator; a BOSH Director creates, configures, monitors, and deletes VMs. The BOSH Director interoperates with a number of IaaSes (Infrastructure as a Service), one of which is VMware vSphere, a virtualization platform. BOSH traditionally operates exclusively within the IPv4 networking space (i.e. the BOSH Director has an IPv4 address (e.g. 10.0.0.6), and the VMs which it deploys also have IPv4 addresses); however, recent changes have enabled IPv6 networking within the BOSH Framework.\nIn this blog post we show how we deployed a BOSH Director with an IPv4 address (no IPv6), and, in turn, used the BOSH Director to deploy a VM with both IPv4 and IPv6 addresses and which runs an nginx web server. Future blog posts will describe installing a BOSH Director in a pure IPv6 network.\nWe expect this blog post to be of interest to those who plan to deploy BOSH in IPv6-enabled environments on vSphere.\nBOSH with IPv6 is in beta! We urge caution when deploying BOSH with IPv6 – limiting your deployments to test environments is a good idea. We welcome feedback.\n1. Prerequisites Use at least the following versions:\nStemcell 3468.13 Ubuntu/Trusty [Ubuntu] BOSH Director 264.5.0 BOSH CLI 2.0.45 bosh-deployment commit be379d8 2. Deployment Overview In this example, we deploy a multihomed VM [why not dual-stack?] running an nginx web server.\n3. Deploying the BOSH Director We use bosh-deployment to deploy our BOSH director. You can use your existing Director. If you need to deploy one, follow the instructions on bosh.io.\nWe set our BOSH Director’s alias to “ipv4” and log in:\n# set the alias for our BOSH Director to \"ipv4\" bosh -e 10.0.9.151 alias-env ipv4 # use something along these lines to find the admin password: # `bosh int --path /admin_password creds.yml` # log in bosh -e ipv4 log-in Email (): admin Password (): 4. Upload the Cloud Config Assuming that you already have a Cloud Config with an IPv4 network, let’s add an additional Cloud Config that defines the IPv6 network.\nbosh -e ipv4 update-config cloud cloud-config-vsphere-ipv6.yml --name ipv6 The IPv6 Cloud Config is shown below, and can also be seen on GitHub.\nnetworks: - name: ipv6 type: manual subnets: - range: \"2601:0646:0100:69f1:0000:0000:0000:0000/64\" gateway: \"2601:0646:0100:69f1:020d:b9ff:fe48:9249\" dns: - 2001:4860:4860:0000:0000:0000:0000:8888 - 2001:4860:4860:0000:0000:0000:0000:8844 azs: [z1] cloud_properties: name: IPv6 Don’t abbreviate IPv6 addresses in BOSH manifests or Cloud Configs [why no abbreviations?] . Don’t use double colons (::), don’t strip leading zeroes. As an extreme example, the loopback address (::1) should be represented as 0000:0000:0000:0000:0000:0000:0000:0001.\n4. Upload the Stemcell and the nginx Release bosh -e ipv4 us https://bosh.io/d/stemcells/bosh-vsphere-esxi-ubuntu-trusty-go_agent?v=3468.17 \\ --sha1 1691f18b9141ac59aec893a1e8437a7d68a88038 bosh -e ipv4 ur https://bosh.io/d/github.com/cloudfoundry-community/nginx-release?v=1.12.2 \\ --sha1 70a21f53d1f89d25847280d5c4fad25293cb0af9 5. Deploy the Web server We create a manifest for our deployment; it can be viewed on Github.\nWe assign our instance group to have two networks within our manifest as follows:\ninstance_groups: - name: nginx networks: - name: default - name: ipv6 default: [dns, gateway] Note that we assign our default gateway to the IPv6 interface. This has the implication that our IPv4 interface can only communicate on its local subnet (i.e. 10.0.9.0/24), which means that it must be deployed on the same subnet as the BOSH Director (otherwise the VM would be unable to communicate with the Director, hence would be unable to receive its configuration). [Routing]\nDeployment is straightforward:\nbosh -e ipv4 -d nginx deploy nginx-ipv46.yml 6. Check It’s Working We check to make sure our nginx VM is running and that it has configured its IP addresses properly:\nbosh -e ipv4 -d nginx instances Using environment 'bosh-vsphere-ipv4.nono.io' as user 'admin' (openid, bosh.admin) ... Instance Process State AZ IPs nginx/821894df-9441-4325-92aa-2f4ded0e2bd9 running z1 10.0.9.165 2601:0646:0100:69f1:0000:0000:0000:0165 Next we browse to our newly-deployed web server (note this must be done from a workstation with an IPv6 address), http://[2601:646:100:69f1::165]/ or http://nginx-ipv6.nono.io/\n7. Conclusion We have seen how, using a standard BOSH director with a standard stemcell, we were able to deploy an IPv6-enabled VM running a service (nginx) that was reachable from the internet.\nGotchas Don’t abbreviate IPv6 addresses in BOSH manifests or Cloud Configs.\nDon’t use large reserved IP ranges (\u003e 1k IP addresses); they will cause bosh deploy to hang.\nMake sure your application binds to the IPv6 address of your VM if you plan on using the IPv6 endpoint (e.g. http://[2601:646:100:69f1::165]/). You may need to make additional configuration changes, possibly code changes.\nTech notes: the underlying system call (kernel interface) to create a socket, socket(2), requires the specification of the address family, which can either be IPv4 (AF_INET) or IPv6 (AF_INET6), which means that applications need to “opt-in” to binding to the IPv6 address (it’s not automatic). Certain applications are coded to bind to both IPv4 and IPv6 addresses seamlessly (e.g. sshd); however, that’s not the case for the majority of applications. Even nginx, a popular webserver, requires a fairly cryptic directive to bind to both IPv4 \u0026 IPv6: listen [::]:80 ipv6only=off; (the directive to listen to IPv4 is a simple listen 80;).\nBe aware of the security implications of IPv6 Router Advertisements BOSH stemcells are currently configured to accept IPv6 router advertisements which expose the VM to man-in-the-middle attacks. [Router Advertisements]\nIPv6 is enabled on all the VM’s interfaces. Once BOSH assigns an IPv6 address to an interface on a VM, the other interfaces may pick up an IPv6 address as well, one that was not assigned by BOSH but rather acquired via IPv6’s Neighbor Discovery Protocol’s (ND’s) stateless address autoconfiguration (SLAAC). For example, the web server we deployed acquired an additional IPv6 addresses on its “IPv4” interface: 2601:646:100:69f0:250:56ff:fe8c:86a9.\nCurrently BOSH doesn’t have a concept of “dual-stack”. In other words, when it deploys a VM, BOSH assigns the VM’s network interface either an IPv4 or an IPv6 address, but not both (though an IPv4 interface may acquire an IPv6 address via SLAAC).\nCurrently BOSH requires the IPv6 default route to reside in the same subnet as the gateway (often the IPv6 default route is an fe80::... address).\nBOSH won’t allocate certain addresses, e.g. “subnet zero”.\nHistory We began work in January 2017. Each week we picked one day to work in the late evening for three hours. The changes spanned several BOSH components: the BOSH Director (e.g commit 4a35c4b8), the BOSH agent (e.g. commit 0962dce7), the BOSH CLI (e.g. commit 0316b3a5), and BOSH deployment (e.g. commit 214ebac4).\nAcknowledgements We’d like to thank the many people who made IPv6-on-BOSH possible: the BOSH Development Team (Danny Berger, Chris De Oliveira, Tom Viehman, Eve Quintana, Difan Zhao, Joshua Aresty) for merging the pull requests and fleshing-out the testing structure, Toolsmiths (Mark Stokan, Ken Lakin, and Der Wei Chan) for creating the necessary environments, and IOPS (Sachin Prasad, Quintin Donnelly, and Pablo Lopez) for enabling IPv6.\nFootnotes [Ubuntu] IPv6 only works on Ubuntu Trusty stemcells; we haven’t yet made changes to the bosh-agent to accommodate IPv6 on the CentOS-flavored or Ubuntu Xenial stemcells. Pull requests are welcome.\n[why not dual stack?] Our deployed webserver VM is multihomed — it has two network interfaces: one which has the IPv4 address (10.0.9.165), and the other which has the IPv6 address (2601:646:100:69f1::165). But a more common approach is to use a single, dual stack, network interface:\nA dual-stack device is a device with network interfaces that can originate and understand both IPv4 and IPv6 packets.\nSo why did we opt for the dual-homed single-stack approach instead of the single-homed, dual stack approach? The answer is that BOSH’s networking model assumes one and only one IP address (be it IPv4 or IPv6) is assigned to a given network interface. To accommodate dual stack we would have had to make changes to BOSH vSphere CPI and BOSH Agent - changes that would have required time we did not have. The multihomed single-stack approach was an expedient and technically valid choice.\n[Routing] Most non-BOSH-deployed machines with both IPv4 and IPv6 addresses have two default routes: one for IPv4, and one for IPv6 (we discount the link-local addresses (i.e. fe80::/10) which, by definition, don’t have a route). The BOSH networking model, as it currently stands, only allows one default route.\nThis restriction constrains the placement of the deployed VM: if the IPv6 interface has the default route, then the IPv4 doesn’t, which means that the VM must be deployed on the same subnet as the BOSH Director in order to communicate with it (the BOSH Director only communicates via IPv4, although we are actively working to change that).\nOn the other hand, if the IPv4 interface of the deployed VM has the default route, then the IPv6 interface doesn’t, which limits the usefulness of having a VM with an IPv6 address (the impetus to use IPv6 is driven by IPv4 address exhaustion, specifically routable addresses, and an IPv6 interface with no IPv6 route is not routable, and offers little value over an IPv4 address).\nHowever, all is not lost: the IPv6 interface of the deployed VM may acquire an IPv6 route via router advertisements. [Router Advertisements] That means it’s possible to deploy a VM with both IPv4 and IPv6 default routes.\n[why no abbreviations?] The BOSH Director codebase represents IPv6 addresses (in most cases, such as the internal database) as strings, and many manipulations will fail if abbreviated IPv6 addresses were used (e.g. “does this IPv6 address fall in this range?”).\nAlthough we’d like to have the capability to use abbreviated IPv6 addresses, and that may be a direction we take longer term, in the short term we must use fully-expanded IPv6 addresses. They are but a minor inconvenience to manifest writers.\n[Router Advertisements] IPv6’s Neighbor Discovery Protocol’s (ND’s) Router Advertisements allow for the discovery of IPv6 routes within an IPv6 subnet. Unfortunately, they may also be used to enable man-in-the-middle attacks (Infoblox has a blog post describing the security issues).\nThe BOSH agent enables the acceptance of router advertisements when an IPv6 is assigned to the VM (bosh-agent source code: sysctl settings and /etc/network/interfaces settings), which undoes the default settings of the stemcell (which disable router advertisements).\nWe plan to disable the acceptance of IPv6’s ND’s router advertisements and to replace it with another mechanism to allow both the IPv4 and IPv6 to have default routes (one idea we have been considering is a new property, ipv6_gateway).\nSimilarly, we plan to disable ICMPv6 Redirects on IPv6-enabled VMs in the future.\nUse caution when connecting to a VM that has acquired an IPv6 address on its IPv4 interface via SLAAC: having an IPv6 address on both interfaces of the deployed VM may cause odd networking behavior. For example, when using bosh ssh to connect to the IPv6 interface (i.e. the VM’s “far” interface) of the web server VM from a workstation on the same subnet (same VLAN) as the VM’s IPv4 interface, and if the VM has acquired an IPv6 address on its IPv4 interface (i.e. the VM’s “near” interface), then the bosh ssh sessions will disconnect (TCP RESET) within 60 seconds. A workaround would be to ssh to the IPv4 interface or the “near” IPv6 interface.\nCorrections \u0026 Updates 2018-01-27\nTrimmed Gotchas section; moved excessive detail into Footnotes section\nCreated an Acknowledgements section\n2018-01-28\nNeighbor Discovery Protocol is abbreviated “ND”, not “NP”\n","wordCount":"1855","inLanguage":"en","image":"https://nono.io/images/brian_cunnie_profile.jpg","datePublished":"2018-01-16T19:12:22Z","dateModified":"2018-01-16T19:12:22Z","author":{"@type":"Person","name":"Brian Cunnie"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.nono.io/post/bosh-on-ipv6-2/"},"publisher":{"@type":"Organization","name":"Brian Cunnie's Technical Blog","logo":{"@type":"ImageObject","url":"https://blog.nono.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://blog.nono.io/ accesskey=h title="Brian Cunnie's Technical Blog (Alt + H)">Brian Cunnie's Technical Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.nono.io/>Home</a>&nbsp;»&nbsp;<a href=https://blog.nono.io/post/>Posts</a></div><h1 class="post-title entry-hint-parent">Deploying BOSH VMs with IPv6 Addresses on vSphere</h1><div class=post-meta><span title='2018-01-16 19:12:22 +0000 UTC'>January 16, 2018</span>&nbsp;·&nbsp;<span>9 min</span>&nbsp;·&nbsp;<span>Brian Cunnie</span>&nbsp;|&nbsp;<span>
<a href=https://github.com/cunnie/cunnie.github.io/tree/master/content/post/bosh-on-ipv6-2.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></span></div></header><div class=post-content><h2 id=0-abstract>0. Abstract<a hidden class=anchor aria-hidden=true href=#0-abstract>#</a></h2><p>BOSH is a VM orchestrator; a BOSH Director creates, configures, monitors, and
deletes VMs. The BOSH Director interoperates with a number of IaaSes
(Infrastructure as a Service), one of which is VMware vSphere, a virtualization
platform. BOSH traditionally operates exclusively within the IPv4 networking
space (i.e. the BOSH Director has an IPv4 address (e.g. 10.0.0.6), and the VMs
which it deploys also have IPv4 addresses); however, recent changes have
enabled IPv6 networking within the BOSH Framework.</p><p>In this blog post we show how we deployed a BOSH Director with an IPv4 address
(no IPv6), and, in turn, used the BOSH Director to deploy a VM with both IPv4
and IPv6 addresses and which runs an nginx web server. Future blog posts will
describe installing a BOSH Director in a pure IPv6 network.</p><p>We expect this blog post to be of interest to those who plan to deploy BOSH in
IPv6-enabled environments on vSphere.</p><div class="alert alert-warning" role=alert><p><b>BOSH with IPv6 is in beta!</b> We urge caution when deploying BOSH with IPv6 –
limiting your deployments to test environments is a good idea. We welcome
feedback.</p></div><h2 id=1-prerequisites>1. Prerequisites<a hidden class=anchor aria-hidden=true href=#1-prerequisites>#</a></h2><p>Use <em>at least</em> the following versions:</p><ul><li>Stemcell <a href=https://bosh.io/stemcells/bosh-vsphere-esxi-ubuntu-trusty-go_agent>3468.13</a> Ubuntu/Trusty
<sup><a href=#ubuntu class=alert-link>[Ubuntu]</a></sup></li><li>BOSH Director <a href="https://bosh.io/releases/github.com/cloudfoundry/bosh?all=1">264.5.0</a></li><li>BOSH CLI <a href=https://bosh.io/docs/cli-v2.html#install>2.0.45</a></li><li><code>bosh-deployment</code> commit <a href=https://github.com/cloudfoundry/bosh-deployment/commit/be379d8bd9701c5f08d469a8cd8e1d531eecf259>be379d8</a></li></ul><h2 id=2-deployment-overview>2. Deployment Overview<a hidden class=anchor aria-hidden=true href=#2-deployment-overview>#</a></h2><p>In this example, we deploy a
<a href=https://en.wikipedia.org/wiki/Multihoming>multihomed</a> VM
<sup><a href=#dual_stack class=alert-link>[why not dual-stack?]</a></sup>
running an nginx web server.</p><figure><img loading=lazy src="https://docs.google.com/drawings/d/e/2PACX-1vQ13VLsT0OY9ngx7U2ul1Auxv19mVUx3q1NId9xXw9hb2QnwqbGdzxjj2Q5W8XWSTOb6H2Z3xiGDS9i/pub?w=1037&amp;amp;h=936"></figure><h2 id=3-deploying-the-bosh-director>3. Deploying the BOSH Director<a hidden class=anchor aria-hidden=true href=#3-deploying-the-bosh-director>#</a></h2><p>We use <a href=https://github.com/cloudfoundry/bosh-deployment>bosh-deployment</a> to
deploy our BOSH director. You can use your existing Director. If you need to
deploy one, follow the instructions on
<a href=https://bosh.io/docs/init-vsphere>bosh.io</a>.</p><p>We set our BOSH Director&rsquo;s alias to &ldquo;ipv4&rdquo; and log in:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> <span style=color:#75715e># set the alias for our BOSH Director to &#34;ipv4&#34;</span>
</span></span><span style=display:flex><span>bosh -e 10.0.9.151 alias-env ipv4
</span></span><span style=display:flex><span> <span style=color:#75715e># use something along these lines to find the admin password:</span>
</span></span><span style=display:flex><span> <span style=color:#75715e># `bosh int --path /admin_password creds.yml`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#75715e># log in</span>
</span></span><span style=display:flex><span>bosh -e ipv4 log-in
</span></span><span style=display:flex><span>  Email <span style=color:#f92672>()</span>: admin
</span></span><span style=display:flex><span>  Password <span style=color:#f92672>()</span>:
</span></span></code></pre></div><h2 id=4-upload-the-cloud-config>4. Upload the Cloud Config<a hidden class=anchor aria-hidden=true href=#4-upload-the-cloud-config>#</a></h2><p>Assuming that you already have a Cloud Config with an IPv4 network, let&rsquo;s add an
additional Cloud Config that defines the IPv6 network.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bosh -e ipv4 update-config cloud cloud-config-vsphere-ipv6.yml --name ipv6
</span></span></code></pre></div><p>The IPv6 Cloud Config is shown below, and can also be seen on
<a href=https://github.com/cunnie/deployments/blob/528e354d017e16a120bb505b14a3ba444e136c1a/cloud-config-vsphere-ipv6.yml>GitHub</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ipv6</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>manual</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>subnets</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>range</span>: <span style=color:#e6db74>&#34;2601:0646:0100:69f1:0000:0000:0000:0000/64&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>gateway</span>: <span style=color:#e6db74>&#34;2601:0646:0100:69f1:020d:b9ff:fe48:9249&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>dns</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>2001</span>:<span style=color:#ae81ff>4860</span>:<span style=color:#ae81ff>4860</span>:<span style=color:#ae81ff>0000</span>:<span style=color:#ae81ff>0000</span>:<span style=color:#ae81ff>0000</span>:<span style=color:#ae81ff>0000</span>:<span style=color:#ae81ff>8888</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>2001</span>:<span style=color:#ae81ff>4860</span>:<span style=color:#ae81ff>4860</span>:<span style=color:#ae81ff>0000</span>:<span style=color:#ae81ff>0000</span>:<span style=color:#ae81ff>0000</span>:<span style=color:#ae81ff>0000</span>:<span style=color:#ae81ff>8844</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>azs</span>: [<span style=color:#ae81ff>z1]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>cloud_properties</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>IPv6</span>
</span></span></code></pre></div><div class="alert alert-warning" role=alert><p><b>Don&rsquo;t <a href=https://en.wikipedia.org/wiki/IPv6_address#Representation>abbreviate</a>
IPv6 addresses in BOSH manifests or Cloud Configs</b> <sup><a href=#dont_abbreviate class=alert-link>[why no abbreviations?]</a></sup> .
Don&rsquo;t use double colons (<code>::</code>), don&rsquo;t strip leading zeroes. As an
extreme example, the loopback address (<code>::1</code>) should be represented
as <code>0000:0000:0000:0000:0000:0000:0000:0001</code>.</p></div><h2 id=4-upload-the-stemcell-and-the-nginx-release>4. Upload the Stemcell and the nginx Release<a hidden class=anchor aria-hidden=true href=#4-upload-the-stemcell-and-the-nginx-release>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bosh -e ipv4 us https://bosh.io/d/stemcells/bosh-vsphere-esxi-ubuntu-trusty-go_agent?v<span style=color:#f92672>=</span>3468.17 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --sha1 1691f18b9141ac59aec893a1e8437a7d68a88038
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>bosh -e ipv4 ur https://bosh.io/d/github.com/cloudfoundry-community/nginx-release?v<span style=color:#f92672>=</span>1.12.2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --sha1 70a21f53d1f89d25847280d5c4fad25293cb0af9
</span></span></code></pre></div><h2 id=5-deploy-the-web-server>5. Deploy the Web server<a hidden class=anchor aria-hidden=true href=#5-deploy-the-web-server>#</a></h2><p>We create a manifest for our deployment; it can be viewed on
<a href=https://github.com/cunnie/deployments/blob/f5c5d939c574ca86a0c2c6ce2e26fc21d9d73a44/nginx-ipv46.yml>Github</a>.</p><p>We assign our instance group to have two networks within our manifest as
follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>instance_groups</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ipv6</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>default</span>: [<span style=color:#ae81ff>dns, gateway]</span>
</span></span></code></pre></div><p>Note that we assign our default gateway to the <em>IPv6</em> interface. This has the
implication that our IPv4 interface can only communicate on its local subnet
(i.e. 10.0.9.0/24), which means that it must be deployed on the same subnet as
the BOSH Director (otherwise the VM would be unable to communicate with the
Director, hence would be unable to receive its configuration).
<sup><a href=#routing class=alert-link>[Routing]</a></sup></p><p>Deployment is straightforward:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bosh -e ipv4 -d nginx deploy nginx-ipv46.yml
</span></span></code></pre></div><h2 id=6-check-its-working>6. Check It&rsquo;s Working<a hidden class=anchor aria-hidden=true href=#6-check-its-working>#</a></h2><p>We check to make sure our nginx VM is running and that it has configured its IP
addresses properly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bosh -e ipv4 -d nginx instances
</span></span><span style=display:flex><span>  Using environment <span style=color:#e6db74>&#39;bosh-vsphere-ipv4.nono.io&#39;</span> as user <span style=color:#e6db74>&#39;admin&#39;</span> <span style=color:#f92672>(</span>openid, bosh.admin<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  Instance                                    Process State  AZ  IPs
</span></span><span style=display:flex><span>  nginx/821894df-9441-4325-92aa-2f4ded0e2bd9  running        z1  10.0.9.165
</span></span><span style=display:flex><span>                                                                 2601:0646:0100:69f1:0000:0000:0000:0165
</span></span></code></pre></div><p>Next we browse to our newly-deployed web server (note this must be done from a
workstation with an IPv6 address), <a href=http://[2601:646:100:69f1::165]/>http://[2601:646:100:69f1::165]/</a> or
<a href=http://nginx-ipv6.nono.io/>http://nginx-ipv6.nono.io/</a></p><figure><img loading=lazy src=https://user-images.githubusercontent.com/1020675/34973631-a56045e8-fa3d-11e7-8553-fefe1807c43e.png></figure><h2 id=7-conclusion>7. Conclusion<a hidden class=anchor aria-hidden=true href=#7-conclusion>#</a></h2><p>We have seen how, using a standard BOSH director with a standard stemcell, we
were able to deploy an IPv6-enabled VM running a service (nginx) that was
reachable from the internet.</p><h2 id=gotchas>Gotchas<a hidden class=anchor aria-hidden=true href=#gotchas>#</a></h2><p><strong>Don&rsquo;t abbreviate IPv6 addresses</strong> in BOSH manifests or Cloud Configs.</p><p><strong>Don&rsquo;t use large <a href=https://bosh.io/docs/networks.html#manual><code>reserved</code></a> IP
ranges</strong> (> 1k IP addresses); they will cause <code>bosh deploy</code> to hang.</p><p><strong>Make sure your application binds to the IPv6 address</strong> of your VM if you plan on
using the IPv6 endpoint (e.g. <a href=http://[2601:646:100:69f1::165]/>http://[2601:646:100:69f1::165]/</a>). You may
need to make additional configuration changes, possibly code changes.</p><p>Tech notes: the underlying system call (kernel interface) to create a socket,
<a href=http://man7.org/linux/man-pages/man2/socket.2.html>socket(2)</a>, requires the
specification of the address family, which can either be IPv4 (<code>AF_INET</code>) or
IPv6 (<code>AF_INET6</code>), which means that applications need to &ldquo;opt-in&rdquo; to binding to
the IPv6 address (it&rsquo;s not automatic). Certain applications are coded to bind to
both IPv4 and IPv6 addresses seamlessly (e.g. <code>sshd</code>); however, that&rsquo;s not the
case for the majority of applications. Even nginx, a popular webserver, requires
a fairly cryptic directive to bind to both IPv4 & IPv6: <code>listen [::]:80 ipv6only=off;</code> (the directive to listen to IPv4 is a simple <code>listen 80;</code>).</p><p>Be aware of the <strong>security implications of IPv6 Router Advertisements</strong> BOSH
stemcells are <em>currently</em> configured to accept IPv6 router advertisements
which expose the VM to man-in-the-middle attacks.
<sup><a href=#router_ads class=alert-link>[Router Advertisements]</a></sup></p><p>IPv6 is <strong>enabled on <em>all</em> the VM&rsquo;s interfaces</strong>. Once BOSH
assigns an IPv6 address to an interface on a VM, the other interfaces may pick up
an IPv6 address as well, one that was not assigned by BOSH but rather acquired
via IPv6&rsquo;s Neighbor Discovery Protocol&rsquo;s (ND&rsquo;s) <a href=https://en.wikipedia.org/wiki/IPv6_address#Stateless_address_autoconfiguration>stateless address
autoconfiguration</a>
(SLAAC). For example, the web server we deployed acquired an additional IPv6
addresses on its &ldquo;IPv4&rdquo; interface: <code>2601:646:100:69f0:250:56ff:fe8c:86a9</code>.</p><p>Currently <strong>BOSH doesn&rsquo;t have a concept of &ldquo;dual-stack&rdquo;</strong>. In other words, when
it deploys a VM, BOSH assigns the VM&rsquo;s network interface either an IPv4 or an
IPv6 address, but not both (though an IPv4 interface may acquire an IPv6 address
via SLAAC).</p><p>Currently BOSH requires the <strong>IPv6 default route to reside in the same subnet</strong>
as the gateway (often the IPv6 default route is an
<code>fe80::...</code> address).</p><p>BOSH won&rsquo;t allocate certain addresses, e.g. &ldquo;<a href=https://en.wikipedia.org/wiki/Subnetwork#Subnet_zero_and_the_all-ones_subnet>subnet
zero</a>&rdquo;.</p><h2 id=history>History<a hidden class=anchor aria-hidden=true href=#history>#</a></h2><p>We began work in January 2017. Each week we picked one day to work in the late
evening for three hours. The changes spanned several BOSH components: the BOSH
Director (e.g commit
<a href=https://github.com/cloudfoundry/bosh/commit/4a35c4b8daac86522f07884274dc6fa2c870fecb>4a35c4b8</a>),
the BOSH agent (e.g. commit
<a href=https://github.com/cloudfoundry/bosh-agent/commit/0962dce7801616f89ba2cd559e97b532379ba594>0962dce7</a>),
the BOSH CLI (e.g. commit
<a href=https://github.com/cloudfoundry/bosh-cli/commit/0316b3a5b58241ca78a75057fb64e6dfc6741f7b>0316b3a5</a>),
and BOSH deployment (e.g. commit
<a href=https://github.com/cloudfoundry/bosh-deployment/commit/214ebac44cdd30a892feafc8c4a62662ab36665b>214ebac4</a>).</p><h2 id=acknowledgements>Acknowledgements<a hidden class=anchor aria-hidden=true href=#acknowledgements>#</a></h2><p>We&rsquo;d like to thank the many people who made IPv6-on-BOSH possible: the BOSH
Development Team (Danny Berger, Chris De Oliveira, Tom Viehman, Eve Quintana,
Difan Zhao, Joshua Aresty) for merging the pull requests and fleshing-out the
testing structure, Toolsmiths (Mark Stokan, Ken Lakin, and Der Wei Chan) for
creating the necessary environments, and IOPS (Sachin Prasad, Quintin Donnelly,
and Pablo Lopez) for enabling IPv6.</p><h2 id=footnotes>Footnotes<a hidden class=anchor aria-hidden=true href=#footnotes>#</a></h2><p><a name=ubuntu><sup>[Ubuntu]</sup></a> IPv6 only works on Ubuntu Trusty stemcells; we
haven&rsquo;t yet made changes to the <code>bosh-agent</code> to accommodate IPv6 on the
CentOS-flavored or Ubuntu Xenial stemcells. Pull requests are welcome.</p><p><a name=dual_stack><sup>[why not dual stack?]</sup></a> Our deployed webserver
VM is multihomed — it has two network interfaces: one which has the IPv4 address
(10.0.9.165), and the other which has the IPv6 address
(2601:646:100:69f1::165). But a more common approach is to use a single,
<a href=https://www.juniper.net/documentation/en_US/junos/topics/concept/ipv6-dual-stack-understanding.html>dual
stack</a>,
network interface:</p><blockquote><p>A dual-stack device is a device with network interfaces that can originate and
understand both IPv4 and IPv6 packets.</p></blockquote><p>So why did we opt for the dual-homed single-stack approach instead of the
single-homed, dual stack approach? The answer is that BOSH&rsquo;s networking model
assumes one and only one IP address (be it IPv4 or IPv6) is assigned to a given
network interface. To accommodate dual stack we would have had to make changes
to BOSH vSphere CPI and BOSH Agent - changes that would have required time
we did not have. The multihomed single-stack approach was an expedient and
technically valid choice.</p><p><a name=routing><sup>[Routing]</sup></a> Most non-BOSH-deployed machines with
both IPv4 and IPv6 addresses have two default routes: one for IPv4, and one for
IPv6 (we discount the
<a href=https://en.wikipedia.org/wiki/Link-local_address>link-local</a> addresses (i.e.
<code>fe80::/10</code>) which, by definition, don&rsquo;t have a route). The BOSH networking
model, as it currently stands, only allows one default route.</p><p>This restriction constrains the placement of the deployed VM: if the IPv6
interface has the default route, then the IPv4 doesn&rsquo;t, which means that the VM
must be deployed on the same subnet as the BOSH Director in order to communicate
with it (the BOSH Director only communicates via IPv4, although we are actively
working to change that).</p><p>On the other hand, if the IPv4 interface of the deployed VM has the default
route, then the IPv6 interface doesn&rsquo;t, which limits the usefulness of having a
VM with an IPv6 address (the impetus to use IPv6 is driven by <a href=https://en.wikipedia.org/wiki/IPv4_address_exhaustion>IPv4 address
exhaustion</a>,
specifically routable addresses, and an IPv6 interface with no IPv6 route is not
routable, and offers little value over an IPv4 address).</p><p>However, all is not lost: the IPv6 interface of the deployed VM may acquire an
IPv6 route via router advertisements.
<sup><a href=#router_ads class=alert-link>[Router Advertisements]</a></sup>
That means it&rsquo;s possible to deploy a VM with <em>both</em> IPv4 and IPv6 default
routes.</p><p><a name=dont_abbreviate><sup>[why no abbreviations?]</sup></a> The BOSH
Director codebase represents IPv6 addresses (in most cases, such as the internal
database) as strings, and many manipulations will fail if abbreviated IPv6
addresses were used (e.g. &ldquo;does this IPv6 address fall in this range?&rdquo;).</p><p>Although we&rsquo;d like to have the capability to use abbreviated IPv6 addresses, and
that may be a direction we take longer term, in the short term we must use
fully-expanded IPv6 addresses. They are but a minor inconvenience to manifest
writers.</p><p><a name=router_ads><sup>[Router Advertisements]</sup></a>
IPv6&rsquo;s <a href=https://en.wikipedia.org/wiki/Neighbor_Discovery_Protocol>Neighbor Discovery
Protocol</a>&rsquo;s (ND&rsquo;s)
Router Advertisements allow for the discovery of IPv6 routes within an IPv6
subnet. Unfortunately, they may also be used to enable man-in-the-middle attacks
(Infoblox has a <a href=https://community.infoblox.com/t5/IPv6-CoE-Blog/Why-You-Must-Use-ICMPv6-Router-Advertisements-RAs/ba-p/3416>blog
post</a>
describing the security issues).</p><p>The BOSH agent enables the acceptance of router advertisements when an IPv6 is
assigned to the VM (<code>bosh-agent</code> source code: <a href=https://github.com/cloudfoundry/bosh-agent/blob/bbee23c0e055b66477a0bae7fc657f9b525a0a99/platform/net/kernel_ipv6.go#L58-L61><code>sysctl</code>
settings</a>
and <a href=https://github.com/cloudfoundry/bosh-agent/blob/ec9f5b2f5a09aae9f213bbd917af0ae010d50fbe/platform/net/ubuntu_net_manager.go#L372><code>/etc/network/interfaces</code>
settings</a>),
which undoes the default settings of the
<a href=https://github.com/cloudfoundry/bosh-linux-stemcell-builder/blob/7eaa5facbfb53676d9c0de2a5866439ebe4f40c6/stemcell_builder/stages/bosh_sysctl/assets/60-bosh-sysctl.conf#L21-L25>stemcell</a>
(which disable router advertisements).</p><p>We plan to disable the acceptance of IPv6&rsquo;s ND&rsquo;s router advertisements and
to replace it with another mechanism to allow <em>both</em> the IPv4 and IPv6 to have
default routes (one idea we have been considering is a new property,
<code>ipv6_gateway</code>).</p><p>Similarly, we plan to disable <a href=https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol#Redirect>ICMPv6 Redirects</a>
on IPv6-enabled VMs in the future.</p><p>Use caution when connecting to a VM that has acquired an IPv6 address on its
IPv4 interface via SLAAC: having an IPv6 address on both interfaces of the
deployed VM may cause odd networking behavior. For example, when using <code>bosh ssh</code> to connect to the IPv6 interface (i.e. the VM&rsquo;s &ldquo;far&rdquo; interface) of the web
server VM from a workstation on the same subnet (same VLAN) as the VM&rsquo;s IPv4
interface, <em>and</em> if the VM has acquired an IPv6 address on its IPv4 interface
(i.e. the VM&rsquo;s &ldquo;near&rdquo; interface), then the <code>bosh ssh</code> sessions will disconnect
(TCP RESET) within 60 seconds. A workaround would be to ssh to the IPv4
interface or the &ldquo;near&rdquo; IPv6 interface.</p><h2 id=corrections--updates>Corrections & Updates<a hidden class=anchor aria-hidden=true href=#corrections--updates>#</a></h2><p><em>2018-01-27</em></p><p>Trimmed Gotchas section; moved excessive detail into Footnotes section</p><p>Created an Acknowledgements section</p><p><em>2018-01-28</em></p><p>Neighbor Discovery Protocol is abbreviated &ldquo;ND&rdquo;, not &ldquo;NP&rdquo;</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://blog.nono.io/post/gobonniego_results/><span class=title>« Prev</span><br><span>Benchmarking the Disk Speed of IaaSes</span>
</a><a class=next href=https://blog.nono.io/post/bosh-deployed-with-concourse/><span class=title>Next »</span><br><span>Maintaining BOSH Directors with Concourse CI and bosh-deployment</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploying BOSH VMs with IPv6 Addresses on vSphere on x" href="https://x.com/intent/tweet/?text=Deploying%20BOSH%20VMs%20with%20IPv6%20Addresses%20on%20vSphere&amp;url=https%3a%2f%2fblog.nono.io%2fpost%2fbosh-on-ipv6-2%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploying BOSH VMs with IPv6 Addresses on vSphere on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.nono.io%2fpost%2fbosh-on-ipv6-2%2f&amp;title=Deploying%20BOSH%20VMs%20with%20IPv6%20Addresses%20on%20vSphere&amp;summary=Deploying%20BOSH%20VMs%20with%20IPv6%20Addresses%20on%20vSphere&amp;source=https%3a%2f%2fblog.nono.io%2fpost%2fbosh-on-ipv6-2%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploying BOSH VMs with IPv6 Addresses on vSphere on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.nono.io%2fpost%2fbosh-on-ipv6-2%2f&title=Deploying%20BOSH%20VMs%20with%20IPv6%20Addresses%20on%20vSphere"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploying BOSH VMs with IPv6 Addresses on vSphere on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.nono.io%2fpost%2fbosh-on-ipv6-2%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploying BOSH VMs with IPv6 Addresses on vSphere on whatsapp" href="https://api.whatsapp.com/send?text=Deploying%20BOSH%20VMs%20with%20IPv6%20Addresses%20on%20vSphere%20-%20https%3a%2f%2fblog.nono.io%2fpost%2fbosh-on-ipv6-2%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploying BOSH VMs with IPv6 Addresses on vSphere on telegram" href="https://telegram.me/share/url?text=Deploying%20BOSH%20VMs%20with%20IPv6%20Addresses%20on%20vSphere&amp;url=https%3a%2f%2fblog.nono.io%2fpost%2fbosh-on-ipv6-2%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploying BOSH VMs with IPv6 Addresses on vSphere on ycombinator" href="https://news.ycombinator.com/submitlink?t=Deploying%20BOSH%20VMs%20with%20IPv6%20Addresses%20on%20vSphere&u=https%3a%2f%2fblog.nono.io%2fpost%2fbosh-on-ipv6-2%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://blog.nono.io/>Brian Cunnie's Technical Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>