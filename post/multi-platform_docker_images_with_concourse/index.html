<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Creating Multi-Platform Docker Images with Concourse | Brian Cunnie's Technical Blog</title><meta name=keywords content><meta name=description content="Concourse CI/CD (continuous integration/continuous
delivery) can create multi-platform Docker images. This blog post describes how.
A multi-platform docker image is one that contains &ldquo;variants for
different architectures&rdquo;.
Docker images are often created for a single architecture (&ldquo;instruction set
architecture&rdquo; or
&ldquo;ISA&rdquo;), typically
Intel&rsquo;s/AMD&rsquo;s x86-64, but with the
advent of ARM64-based offerings such as AWS&rsquo;s
Graviton and Apple&rsquo;s
M1/M2,
It&rsquo;s becoming more common to build multi-platform images to avoid the heavy
emulation performance penalty (typically >10x) when running an image on a
different architecture. Multi-platform images enable a developer, for example,
to run a container just as fast on their Apple M1 laptop as their GCP (Google
Cloud Platform) Kubernetes cluster."><meta name=author content="Brian Cunnie"><link rel=canonical href=https://blog.nono.io/post/multi-platform_docker_images_with_concourse/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.nono.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.nono.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.nono.io/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.nono.io/apple-touch-icon.png><link rel=mask-icon href=https://blog.nono.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.nono.io/post/multi-platform_docker_images_with_concourse/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-0NJ11E527T"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0NJ11E527T")}</script><meta property="og:url" content="https://blog.nono.io/post/multi-platform_docker_images_with_concourse/"><meta property="og:site_name" content="Brian Cunnie's Technical Blog"><meta property="og:title" content="Creating Multi-Platform Docker Images with Concourse"><meta property="og:description" content="Concourse CI/CD (continuous integration/continuous delivery) can create multi-platform Docker images. This blog post describes how.
A multi-platform docker image is one that contains “variants for different architectures”.
Docker images are often created for a single architecture (“instruction set architecture” or “ISA”), typically Intel’s/AMD’s x86-64, but with the advent of ARM64-based offerings such as AWS’s Graviton and Apple’s M1/M2, It’s becoming more common to build multi-platform images to avoid the heavy emulation performance penalty (typically >10x) when running an image on a different architecture. Multi-platform images enable a developer, for example, to run a container just as fast on their Apple M1 laptop as their GCP (Google Cloud Platform) Kubernetes cluster."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-11-25T08:13:55-08:00"><meta property="article:modified_time" content="2022-11-25T08:13:55-08:00"><meta property="og:image" content="https://nono.io/images/brian_cunnie_profile.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nono.io/images/brian_cunnie_profile.jpg"><meta name=twitter:title content="Creating Multi-Platform Docker Images with Concourse"><meta name=twitter:description content="Concourse CI/CD (continuous integration/continuous
delivery) can create multi-platform Docker images. This blog post describes how.
A multi-platform docker image is one that contains &ldquo;variants for
different architectures&rdquo;.
Docker images are often created for a single architecture (&ldquo;instruction set
architecture&rdquo; or
&ldquo;ISA&rdquo;), typically
Intel&rsquo;s/AMD&rsquo;s x86-64, but with the
advent of ARM64-based offerings such as AWS&rsquo;s
Graviton and Apple&rsquo;s
M1/M2,
It&rsquo;s becoming more common to build multi-platform images to avoid the heavy
emulation performance penalty (typically >10x) when running an image on a
different architecture. Multi-platform images enable a developer, for example,
to run a container just as fast on their Apple M1 laptop as their GCP (Google
Cloud Platform) Kubernetes cluster."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.nono.io/post/"},{"@type":"ListItem","position":2,"name":"Creating Multi-Platform Docker Images with Concourse","item":"https://blog.nono.io/post/multi-platform_docker_images_with_concourse/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Creating Multi-Platform Docker Images with Concourse","name":"Creating Multi-Platform Docker Images with Concourse","description":"Concourse CI/CD (continuous integration/continuous delivery) can create multi-platform Docker images. This blog post describes how.\nA multi-platform docker image is one that contains \u0026ldquo;variants for different architectures\u0026rdquo;.\nDocker images are often created for a single architecture (\u0026ldquo;instruction set architecture\u0026rdquo; or \u0026ldquo;ISA\u0026rdquo;), typically Intel\u0026rsquo;s/AMD\u0026rsquo;s x86-64, but with the advent of ARM64-based offerings such as AWS\u0026rsquo;s Graviton and Apple\u0026rsquo;s M1/M2, It\u0026rsquo;s becoming more common to build multi-platform images to avoid the heavy emulation performance penalty (typically \u0026gt;10x) when running an image on a different architecture. Multi-platform images enable a developer, for example, to run a container just as fast on their Apple M1 laptop as their GCP (Google Cloud Platform) Kubernetes cluster.\n","keywords":[],"articleBody":"Concourse CI/CD (continuous integration/continuous delivery) can create multi-platform Docker images. This blog post describes how.\nA multi-platform docker image is one that contains “variants for different architectures”.\nDocker images are often created for a single architecture (“instruction set architecture” or “ISA”), typically Intel’s/AMD’s x86-64, but with the advent of ARM64-based offerings such as AWS’s Graviton and Apple’s M1/M2, It’s becoming more common to build multi-platform images to avoid the heavy emulation performance penalty (typically \u003e10x) when running an image on a different architecture. Multi-platform images enable a developer, for example, to run a container just as fast on their Apple M1 laptop as their GCP (Google Cloud Platform) Kubernetes cluster.\nQuick Start Make sure you’re on Concourse 7.9 or later; it has the registry-image resource necessary to create multi-platform images.\nCreate a Concourse resource, “multi-platform-docker-image”. This is the Docker image you’ll be building. Using the example below, make the following changes:\nreplace cunnie/multi-platform with the name of the multi-platform Docker image that you intend to create. replace username: cunnie with your Docker username. replace ((docker_token)) with your Docker hub access token resources: - name: multi-platform-docker-image type: registry-image icon: docker source: repository: cunnie/multi-platform # ← Replace with the name of your Docker image username: cunnie # ← Replace with your Docker Hub username password: ((docker_token)) # ← Replace with your Docker Hub token (or password) tag: latest Create a job to build the Docker image using the following as an example. Make the following changes:\nreplace CONTEXT: deployments/multi-platform-docker with the path to your Dockerfile’s location. In this example, I have a Concourse input resource “deployments”, and it has a subdirectory “multi-platform-docker/”, and that subdirectory has a “Dockerfile”. Note:\nIMAGE_PLATFORM defines the platforms to build. If you’re not sure, use linux/arm64,linux/amd64 OUTPUT_OCI: true is required for multi-platform image: image/image is required for OCI output jobs: - name: build-and-push-multi-platform-docker-image plan: - get: deployments trigger: true - task: build-image-task privileged: true config: platform: linux image_resource: type: registry-image source: repository: concourse/oci-build-task inputs: - name: deployments outputs: - name: image params: CONTEXT: deployments/multi-platform-docker IMAGE_PLATFORM: linux/arm64,linux/amd64 OUTPUT_OCI: true run: path: build - put: multi-platform-docker-image params: image: image/image Putting it all together, we have the following:\nThe Concourse pipeline The Concourse pipeline definition (YAML) The Dockerfile The generated Docker image The resulting Docker image is simple: it prints out the architecture of the underlying kernel (i.e. “aarch64” for ARM, “x86_64” for Intel) and then exits. See for yourself:\ndocker run -it --rm cunnie/multi-platform Gotchas Update your Concourse pipelines to use the new resource registry-image instead of the old, deprecated docker-image, otherwise your pipelines will pull the old (pre-multi-platform) image, and you’ll be sad.\njobs: name: unit plan: - get: sslip.io trigger: true - config: image_resource: source: repository: cunnie/fedora-golang-bosh - type: docker-image + type: registry-image Advanced Topics If your Docker image needs to be built slightly differently for different platforms, use the TARGETARCH environment variable. In the following Dockerfile snippet, we use the TARGETARCH to download and install tha Golang-compiled executables for the appropriate architecture:\nARG TARGETARCH # amd64, arm64 (so I can run on AWS graviton2) RUN curl -L https://github.com/cunnie/sslip.io/releases/download/2.6.1/sslip.io-dns-server-linux-$TARGETARCH \\ -o /usr/sbin/sslip.io-dns-server; \\ chmod 755 /usr/sbin/sslip.io-dns-server Corrections \u0026 Updates 2023-04-18\nGotcha: update your pipelines to use the new registry-image instead of the old docker-image, lest your pipelines don’t pull the new image.\n2022-12-04\nI updated the post to require Concourse 7.9, which allowed me to remove the custom Concourse resource type.\n","wordCount":"564","inLanguage":"en","image":"https://nono.io/images/brian_cunnie_profile.jpg","datePublished":"2022-11-25T08:13:55-08:00","dateModified":"2022-11-25T08:13:55-08:00","author":{"@type":"Person","name":"Brian Cunnie"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.nono.io/post/multi-platform_docker_images_with_concourse/"},"publisher":{"@type":"Organization","name":"Brian Cunnie's Technical Blog","logo":{"@type":"ImageObject","url":"https://blog.nono.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.nono.io/ accesskey=h title="Brian Cunnie's Technical Blog (Alt + H)">Brian Cunnie's Technical Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.nono.io/>Home</a>&nbsp;»&nbsp;<a href=https://blog.nono.io/post/>Posts</a></div><h1 class="post-title entry-hint-parent">Creating Multi-Platform Docker Images with Concourse</h1><div class=post-meta><span title='2022-11-25 08:13:55 -0800 -0800'>November 25, 2022</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Brian Cunnie&nbsp;|&nbsp;<a href=https://github.com/cunnie/cunnie.github.io/tree/master/content/post/multi-platform_docker_images_with_concourse.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><div class=post-content><p><a href=https://concourse-ci.org/>Concourse CI/CD</a> (continuous integration/continuous
delivery) can create multi-platform Docker images. This blog post describes how.</p><p>A multi-platform docker image is one that contains &ldquo;<a href=https://docs.docker.com/build/building/multi-platform/>variants for
different architectures</a>&rdquo;.</p><p>Docker images are often created for a single architecture (&ldquo;instruction set
architecture&rdquo; or
&ldquo;<a href=https://en.wikipedia.org/wiki/Instruction_set_architecture>ISA</a>&rdquo;), typically
Intel&rsquo;s/AMD&rsquo;s <a href=https://en.wikipedia.org/wiki/X86-64>x86-64</a>, but with the
advent of ARM64-based offerings such as AWS&rsquo;s
<a href=https://aws.amazon.com/ec2/graviton/>Graviton</a> and Apple&rsquo;s
<a href=https://en.wikipedia.org/wiki/Apple_M1>M1</a>/<a href=https://en.wikipedia.org/wiki/Apple_M2>M2</a>,
It&rsquo;s becoming more common to build multi-platform images to avoid the heavy
emulation performance penalty (typically >10x) when running an image on a
different architecture. Multi-platform images enable a developer, for example,
to run a container just as fast on their Apple M1 laptop as their GCP (Google
Cloud Platform) Kubernetes cluster.</p><h3 id=quick-start>Quick Start<a hidden class=anchor aria-hidden=true href=#quick-start>#</a></h3><p>Make sure you&rsquo;re on <strong>Concourse 7.9</strong> or later; it has the
<a href=https://github.com/concourse/registry-image-resource>registry-image</a> resource
necessary to create multi-platform images.</p><p>Create a Concourse resource, &ldquo;multi-platform-docker-image&rdquo;. This is the Docker
image you&rsquo;ll be building. Using the example below, make the following changes:</p><ul><li>replace
<a href=https://hub.docker.com/repository/docker/cunnie/multi-platform>cunnie/multi-platform</a>
with the name of the multi-platform Docker image that you intend to create.</li><li>replace <code>username: cunnie</code> with your Docker username.</li><li>replace <code>((docker_token))</code> with your <a href=https://docs.docker.com/docker-hub/access-tokens/>Docker hub access
token</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>multi-platform-docker-image</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>registry-image</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>icon</span>: <span style=color:#ae81ff>docker</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>source</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>repository</span>: <span style=color:#ae81ff>cunnie/multi-platform</span> <span style=color:#75715e># ← Replace with the name of your Docker image</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>username</span>: <span style=color:#ae81ff>cunnie</span> <span style=color:#75715e># ← Replace with your Docker Hub username</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>password</span>: <span style=color:#ae81ff>((docker_token))</span> <span style=color:#75715e># ← Replace with your Docker Hub token (or password)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tag</span>: <span style=color:#ae81ff>latest</span>
</span></span></code></pre></div><p>Create a job to build the Docker image using the following as an example. Make
the following changes:</p><ul><li>replace <a href=https://github.com/cunnie/deployments/tree/c8207ebc06bf2adb4fabe9632d81416f69ce00ae/multi-platform-docker><code>CONTEXT: deployments/multi-platform-docker</code></a>
with the path to your <code>Dockerfile</code>&rsquo;s location. In this example, I have a
Concourse input resource &ldquo;deployments&rdquo;, and it has a subdirectory
&ldquo;multi-platform-docker/&rdquo;, and that subdirectory has a &ldquo;Dockerfile&rdquo;.</li></ul><p>Note:</p><ul><li><code>IMAGE_PLATFORM</code> defines the platforms to build. If you&rsquo;re not sure, use
<code>linux/arm64,linux/amd64</code></li><li><code>OUTPUT_OCI: true</code> is required for multi-platform</li><li><code>image: image/image</code> is required for OCI output</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>build-and-push-multi-platform-docker-image</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>plan</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>get</span>: <span style=color:#ae81ff>deployments</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>trigger</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>task</span>: <span style=color:#ae81ff>build-image-task</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>privileged</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>linux</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>image_resource</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>registry-image</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>source</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>repository</span>: <span style=color:#ae81ff>concourse/oci-build-task</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>deployments</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>outputs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>image</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>params</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>CONTEXT</span>: <span style=color:#ae81ff>deployments/multi-platform-docker</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>IMAGE_PLATFORM</span>: <span style=color:#ae81ff>linux/arm64,linux/amd64</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>OUTPUT_OCI</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>run</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>path</span>: <span style=color:#ae81ff>build</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>put</span>: <span style=color:#ae81ff>multi-platform-docker-image</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>params</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>image/image</span>
</span></span></code></pre></div><p>Putting it all together, we have the following:</p><ul><li>The Concourse
<a href=https://ci.nono.io/teams/main/pipelines/multi-platform-docker>pipeline</a></li><li>The Concourse pipeline
<a href=https://github.com/cunnie/deployments/blob/22b50f6c60e8486e2e73fce996ab6ce6fa836ed1/ci/pipeline-multi-platform-docker.yml>definition</a>
(YAML)</li><li>The
<a href=https://github.com/cunnie/deployments/blob/c8207ebc06bf2adb4fabe9632d81416f69ce00ae/multi-platform-docker/Dockerfile>Dockerfile</a></li><li>The generated <a href=https://hub.docker.com/repository/docker/cunnie/multi-platform>Docker
image</a></li></ul><p>The resulting Docker image is simple: it prints out the architecture of the
underlying kernel (i.e. &ldquo;aarch64&rdquo; for ARM, &ldquo;x86_64&rdquo; for Intel) and then exits.
See for yourself:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -it --rm cunnie/multi-platform
</span></span></code></pre></div><h3 id=gotchas>Gotchas<a hidden class=anchor aria-hidden=true href=#gotchas>#</a></h3><p>Update your Concourse pipelines to use the new resource <code>registry-image</code>
instead of the old, deprecated <code>docker-image</code>, otherwise your pipelines will
pull the old (pre-multi-platform) image, and you&rsquo;ll be sad.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>jobs:
</span></span><span style=display:flex><span>  name: unit
</span></span><span style=display:flex><span>  plan:
</span></span><span style=display:flex><span>  - get: sslip.io
</span></span><span style=display:flex><span>    trigger: true
</span></span><span style=display:flex><span>  - config:
</span></span><span style=display:flex><span>      image_resource:
</span></span><span style=display:flex><span>        source:
</span></span><span style=display:flex><span>          repository: cunnie/fedora-golang-bosh
</span></span><span style=display:flex><span><span style=color:#f92672>-       type: docker-image
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+       type: registry-image
</span></span></span></code></pre></div><h3 id=advanced-topics>Advanced Topics<a hidden class=anchor aria-hidden=true href=#advanced-topics>#</a></h3><p>If your Docker image needs to be built slightly differently for different
platforms, use the
<a href=https://docs.docker.com/engine/reference/builder/#automatic-platform-args-in-the-global-scope><code>TARGETARCH</code></a>
environment variable. In the following
<a href=https://github.com/cunnie/sslip.io/blob/d900b738c7dd6da3b20e806d3e0e87c783e45d26/k8s/Dockerfile-sslip.io-dns-server#L28-L31>Dockerfile</a>
snippet, we use the <code>TARGETARCH</code> to download and install tha Golang-compiled
executables for the appropriate architecture:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span><span style=color:#66d9ef>ARG</span> TARGETARCH <span style=color:#75715e># amd64, arm64 (so I can run on AWS graviton2)</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> curl -L https://github.com/cunnie/sslip.io/releases/download/2.6.1/sslip.io-dns-server-linux-$TARGETARCH <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -o /usr/sbin/sslip.io-dns-server; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  chmod <span style=color:#ae81ff>755</span> /usr/sbin/sslip.io-dns-server<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h2 id=corrections--updates>Corrections & Updates<a hidden class=anchor aria-hidden=true href=#corrections--updates>#</a></h2><p><em>2023-04-18</em></p><p>Gotcha: update your pipelines to use the new <code>registry-image</code> instead of the
old <code>docker-image</code>, lest your pipelines don&rsquo;t pull the new image.</p><p><em>2022-12-04</em></p><p>I updated the post to require Concourse 7.9, which allowed me to remove the
custom Concourse resource type.</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://blog.nono.io/post/backup_vcenter_w_truenas/><span class=title>« Prev</span><br><span>The Least Secure Way to Back Up vCenter 8.0 with TrueNAS 13.0</span>
</a><a class=next href=https://blog.nono.io/post/vcenter_8.0_tls/><span class=title>Next »</span><br><span>How to Install a TLS Certificate on vCenter Server Appliance (VCSA) 8.0</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Creating Multi-Platform Docker Images with Concourse on x" href="https://x.com/intent/tweet/?text=Creating%20Multi-Platform%20Docker%20Images%20with%20Concourse&amp;url=https%3a%2f%2fblog.nono.io%2fpost%2fmulti-platform_docker_images_with_concourse%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Creating Multi-Platform Docker Images with Concourse on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.nono.io%2fpost%2fmulti-platform_docker_images_with_concourse%2f&amp;title=Creating%20Multi-Platform%20Docker%20Images%20with%20Concourse&amp;summary=Creating%20Multi-Platform%20Docker%20Images%20with%20Concourse&amp;source=https%3a%2f%2fblog.nono.io%2fpost%2fmulti-platform_docker_images_with_concourse%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Creating Multi-Platform Docker Images with Concourse on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.nono.io%2fpost%2fmulti-platform_docker_images_with_concourse%2f&title=Creating%20Multi-Platform%20Docker%20Images%20with%20Concourse"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Creating Multi-Platform Docker Images with Concourse on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.nono.io%2fpost%2fmulti-platform_docker_images_with_concourse%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Creating Multi-Platform Docker Images with Concourse on whatsapp" href="https://api.whatsapp.com/send?text=Creating%20Multi-Platform%20Docker%20Images%20with%20Concourse%20-%20https%3a%2f%2fblog.nono.io%2fpost%2fmulti-platform_docker_images_with_concourse%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Creating Multi-Platform Docker Images with Concourse on telegram" href="https://telegram.me/share/url?text=Creating%20Multi-Platform%20Docker%20Images%20with%20Concourse&amp;url=https%3a%2f%2fblog.nono.io%2fpost%2fmulti-platform_docker_images_with_concourse%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Creating Multi-Platform Docker Images with Concourse on ycombinator" href="https://news.ycombinator.com/submitlink?t=Creating%20Multi-Platform%20Docker%20Images%20with%20Concourse&u=https%3a%2f%2fblog.nono.io%2fpost%2fmulti-platform_docker_images_with_concourse%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://blog.nono.io/>Brian Cunnie's Technical Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>