<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to Deploy a Multi-homed BOSH Director to a vSphere Environment | Brian Cunnie's Technical Blog</title><meta name=keywords content><meta name=description content="vSphere users ask, &ldquo;How do I configure my BOSH director so that it can communicate with my vCenter but the director&rsquo;s deployed VMs can&rsquo;t?&rdquo;
One technique is to use a multi-homed BOSH director combined with the BOSH Networking Release (a BOSH release which enables customization of the VM&rsquo;s routing table, allowing more routes than the default gateway).
Network Diagram The following is a network diagram of our deployment. We want to protect the assets at the top (in blue): the vCenter server and its associated ESXi servers."><meta name=author content="Brian Cunnie"><link rel=canonical href=https://blog.nono.io/post/multi-homed-bosh-director/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.nono.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.nono.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.nono.io/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.nono.io/apple-touch-icon.png><link rel=mask-icon href=https://blog.nono.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-0NJ11E527T"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0NJ11E527T",{anonymize_ip:!1})}</script><meta property="og:title" content="How to Deploy a Multi-homed BOSH Director to a vSphere Environment"><meta property="og:description" content="vSphere users ask, &ldquo;How do I configure my BOSH director so that it can communicate with my vCenter but the director&rsquo;s deployed VMs can&rsquo;t?&rdquo;
One technique is to use a multi-homed BOSH director combined with the BOSH Networking Release (a BOSH release which enables customization of the VM&rsquo;s routing table, allowing more routes than the default gateway).
Network Diagram The following is a network diagram of our deployment. We want to protect the assets at the top (in blue): the vCenter server and its associated ESXi servers."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.nono.io/post/multi-homed-bosh-director/"><meta property="og:image" content="https://nono.io/images/brian_cunnie_profile.jpg"><meta property="article:section" content="post"><meta property="article:published_time" content="2016-05-13T13:37:44-07:00"><meta property="article:modified_time" content="2016-05-13T13:37:44-07:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nono.io/images/brian_cunnie_profile.jpg"><meta name=twitter:title content="How to Deploy a Multi-homed BOSH Director to a vSphere Environment"><meta name=twitter:description content="vSphere users ask, &ldquo;How do I configure my BOSH director so that it can communicate with my vCenter but the director&rsquo;s deployed VMs can&rsquo;t?&rdquo;
One technique is to use a multi-homed BOSH director combined with the BOSH Networking Release (a BOSH release which enables customization of the VM&rsquo;s routing table, allowing more routes than the default gateway).
Network Diagram The following is a network diagram of our deployment. We want to protect the assets at the top (in blue): the vCenter server and its associated ESXi servers."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.nono.io/post/"},{"@type":"ListItem","position":2,"name":"How to Deploy a Multi-homed BOSH Director to a vSphere Environment","item":"https://blog.nono.io/post/multi-homed-bosh-director/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to Deploy a Multi-homed BOSH Director to a vSphere Environment","name":"How to Deploy a Multi-homed BOSH Director to a vSphere Environment","description":"vSphere users ask, \u0026ldquo;How do I configure my BOSH director so that it can communicate with my vCenter but the director\u0026rsquo;s deployed VMs can\u0026rsquo;t?\u0026rdquo;\nOne technique is to use a multi-homed BOSH director combined with the BOSH Networking Release (a BOSH release which enables customization of the VM\u0026rsquo;s routing table, allowing more routes than the default gateway).\nNetwork Diagram The following is a network diagram of our deployment. We want to protect the assets at the top (in blue): the vCenter server and its associated ESXi servers.","keywords":[],"articleBody":"vSphere users ask, “How do I configure my BOSH director so that it can communicate with my vCenter but the director’s deployed VMs can’t?”\nOne technique is to use a multi-homed BOSH director combined with the BOSH Networking Release (a BOSH release which enables customization of the VM’s routing table, allowing more routes than the default gateway).\nNetwork Diagram The following is a network diagram of our deployment. We want to protect the assets at the top (in blue): the vCenter server and its associated ESXi servers. These machines are particularly sensitive as they control hundreds of VMs.\nThe BOSH Director needs access to the vCenter, but its deployed VMs must not have access to the vCenter.\nWe provision BOSH as a multi-homed VM attached to both the vCenter management network and the BOSH Routing Network. This allows the director to communicate with the deployed VMs, but prevents the VMs from communicating with the sensitive networks.\nBOSH Deployment Manifest We use a BOSH v2 deployment manifest and a cloud config to deploy our BOSH director. Here is our BOSH director’s manifest:\ndirector_uuid: __DIRECTOR_UUID__ name: bosh releases: - name: bosh version: latest - name: bosh-vsphere-cpi version: latest - name: networking version: latest stemcells: - alias: default os: ubuntu-trusty version: latest update: canaries: 1 max_in_flight: 10 canary_watch_time: 1000-30000 update_watch_time: 1000-30000 jobs: - name: bosh instances: 1 stemcell: default templates: - {name: nats, release: bosh} - {name: postgres, release: bosh} - {name: blobstore, release: bosh} - {name: director, release: bosh} - {name: health_monitor, release: bosh} - {name: vsphere_cpi, release: bosh-vsphere-cpi} - name: routes release: networking properties: # This customizes the BOSH Director's networking.routes: # routing table so it can reach - net: 172.16.1.0 # the two networks to which it deploys netmask: 255.255.255.0 # VMs: interface: eth1 # - CF Public Network (172.16.1.0/24) gateway: 172.16.0.1 # - CF Private Network (172.16.2.0/24) - net: 172.16.2.0 netmask: 255.255.255.0 interface: eth1 gateway: 172.16.0.1 vm_type: medium persistent_disk: 40_960 networks: - {name: bosh-management-network, static_ips: [10.0.1.6], default: [dns,gateway]} - {name: bosh-routing-network, static_ips: [172.16.0.6]} properties: nats: address: 127.0.0.1 user: nats password: nats-password postgres: \u0026db listen_address: 127.0.0.1 host: 127.0.0.1 user: postgres password: postgres-password database: bosh adapter: postgres blobstore: address: 172.16.0.6 port: 25250 provider: dav director: {user: director, password: director-password} agent: {user: agent, password: agent-password} director: address: 127.0.0.1 name: my-bosh db: *db cpi_job: vsphere_cpi user_management: provider: local local: users: - {name: admin, password: admin} - {name: hm, password: hm-password} hm: director_account: {user: hm, password: hm-password} resurrector_enabled: true vcenter: \u0026vcenter # \u003c--- Replace values below address: 10.0.0.5 user: root password: vmware datacenters: - name: datacenter vm_folder: vms template_folder: templates datastore_pattern: vnx5400-ds persistent_datastore_pattern: vnx5400-ds disk_path: disk clusters: [pizza-boxes] agent: {mbus: \"nats://nats:nats-password@172.16.0.6:4222\"} ntp: \u0026ntp [0.pool.ntp.org, 1.pool.ntp.org] Note that properties.blobstore.address and properties.agent.mbus use the BOSH director’s interface that is closest to its deployed VMs (i.e. 172.16.0.6); if you use the other interface (i.e. 10.0.1.6), the VMs will not be able to contact the director and the deployment will fail.\nHere is our cloud-config manifest:\nnetworks: - name: bosh-management-network subnets: - range: 10.0.1.0/24 gateway: 10.0.1.1 static: - 10.0.1.6 cloud_properties: { name: bosh-management-network } - name: bosh-routing-network subnets: - range: 172.16.0.0/24 gateway: 172.16.0.1 static: - 172.16.0.6 cloud_properties: { name: bosh-routing-network } - name: cf-public-network subnets: - range: 172.16.1.0/24 gateway: 172.16.1.1 cloud_properties: { name: cf-public-network } vm_types: - name: tiny cloud_properties: { cpu: 1, ram: 1024, disk: 1024 } - name: medium cloud_properties: { cpu: 2, ram: 2048, disk: 81_920 } compilation: workers: 6 network: bosh-management-network reuse_compilation_vms: true cloud_properties: { cpu: 2, ram: 2048, disk: 1024 } Here is our deployment manifest (a very simple deployment):\nname: simple director_uuid: __BOSH_DIRECTOR_UUID__ releases: [] stemcells: - alias: default os: ubuntu-trusty version: latest update: canaries: 1 max_in_flight: 1 canary_watch_time: 5000-300000 update_watch_time: 5000-300000 instance_groups: - name: simple-vm instances: 1 jobs: [] vm_type: tiny stemcell: default networks: - name: cf-public-network Notes If one were to dispense with the BOSH Routing Network and deploy VMs on the same subnet to which the BOSH director is attached, then one would not need to include the BOSH Networking Release in the BOSH manifest (the BOSH will not need to traverse a router to reach its deployed VMs, for the VMs will be deployed to the same subnet on which the director has an interface).\nMore complex BOSH deployments, e.g. Cloud Foundry Elastic Runtime, typically assume multiple subnets, requiring the use of the networking-release.\nWe use BOSH v2 deployment manifest and cloud config to deploy our BOSH director; however, BOSH directors are most often deployed with bosh-init, which uses a slightly different manifest format. It should be a fairly trivial exercise to convert our manifests to a bosh-init-flavored manifest.\nGotchas BOSH stemcells have been hardened, and this may cause unexpected connectivity issues. Specifically, asymmetric routing may cause pings (or other attempts to connect) to one of the Director’s interfaces to fail (pings to the other interface should succeed).\nThis problem is caused by reverse packet filtering. To fix, one can enable the Director’s kernel to accept asymmetrically routed packets (the following commands must be run as root):\necho 2 \u003e /proc/sys/net/ipv4/conf/default/rp_filter echo 2 \u003e /proc/sys/net/ipv4/conf/all/rp_filter echo 2 \u003e /proc/sys/net/ipv4/conf/eth0/rp_filter echo 2 \u003e /proc/sys/net/ipv4/conf/eth1/rp_filter To make the changes permanent (to persist on reboot), the following should be added to /etc/sysctl.conf:\nnet.ipv4.conf.all.rp_filter=2 net.ipv4.conf.default.rp_filter=2 net.ipv4.conf.eth0.rp_filter=2 net.ipv4.conf.eth1.rp_filter=2 ","wordCount":"865","inLanguage":"en","datePublished":"2016-05-13T13:37:44-07:00","dateModified":"2016-05-13T13:37:44-07:00","author":{"@type":"Person","name":"Brian Cunnie"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.nono.io/post/multi-homed-bosh-director/"},"publisher":{"@type":"Organization","name":"Brian Cunnie's Technical Blog","logo":{"@type":"ImageObject","url":"https://blog.nono.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.nono.io/ accesskey=h title="Brian Cunnie's Technical Blog (Alt + H)">Brian Cunnie's Technical Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.nono.io/>Home</a>&nbsp;»&nbsp;<a href=https://blog.nono.io/post/>Posts</a></div><h1 class=post-title>How to Deploy a Multi-homed BOSH Director to a vSphere Environment</h1><div class=post-meta><span title='2016-05-13 13:37:44 -0700 -0700'>May 13, 2016</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Brian Cunnie&nbsp;|&nbsp;<a href=https://github.com/cunnie/cunnie.github.io/tree/master/content/post/multi-homed-bosh-director.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>vSphere users ask, &ldquo;How do I configure my BOSH director so that it can
communicate with my vCenter but the director&rsquo;s deployed VMs can&rsquo;t?&rdquo;</p><p>One technique is to use a multi-homed BOSH director combined with the BOSH <a href=https://github.com/cloudfoundry/networking-release>Networking
Release</a> (a BOSH release
which enables customization of the VM&rsquo;s routing table, allowing more routes
than the default gateway).</p><h2 id=network-diagram>Network Diagram<a hidden class=anchor aria-hidden=true href=#network-diagram>#</a></h2><p>The following is a network diagram of our deployment. We want to protect the
assets at the top (in blue): the vCenter server and its associated ESXi servers.
These machines are particularly sensitive as they control hundreds of VMs.</p><p>The BOSH Director needs access to the vCenter, but its deployed VMs must <em>not</em>
have access to the vCenter.</p><p>We provision BOSH as a multi-homed VM attached to both the vCenter management
network and the BOSH Routing Network. This allows the director to communicate
with the deployed VMs, but prevents the VMs from communicating with the
sensitive networks.</p><figure class=full><img loading=lazy src="https://docs.google.com/drawings/d/1OReIbjwBHGX19HHgSQThdZenTS03ITtp8gOxwetLNcI/pub?w=894&amp;amp;h=907"></figure><h2 id=bosh-deployment-manifest>BOSH Deployment Manifest<a hidden class=anchor aria-hidden=true href=#bosh-deployment-manifest>#</a></h2><p>We use a BOSH <a href=http://bosh.io/docs/manifest-v2.html>v2 deployment manifest</a> and a <a href=http://bosh.io/docs/cloud-config.html>cloud config</a>
to deploy our BOSH director. Here is our BOSH director&rsquo;s manifest:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>director_uuid</span>: <span style=color:#ae81ff>__DIRECTOR_UUID__</span>
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>bosh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>releases</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>bosh</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>version</span>: <span style=color:#ae81ff>latest</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>bosh-vsphere-cpi</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>version</span>: <span style=color:#ae81ff>latest</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>networking</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>version</span>: <span style=color:#ae81ff>latest</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>stemcells</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>alias</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>os</span>: <span style=color:#ae81ff>ubuntu-trusty</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>version</span>: <span style=color:#ae81ff>latest</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>update</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>canaries</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>max_in_flight</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>canary_watch_time</span>: <span style=color:#ae81ff>1000-30000</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>update_watch_time</span>: <span style=color:#ae81ff>1000-30000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>bosh</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>instances</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>stemcell</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>templates</span>:
</span></span><span style=display:flex><span>  - {<span style=color:#f92672>name: nats, release</span>: <span style=color:#ae81ff>bosh}</span>
</span></span><span style=display:flex><span>  - {<span style=color:#f92672>name: postgres, release</span>: <span style=color:#ae81ff>bosh}</span>
</span></span><span style=display:flex><span>  - {<span style=color:#f92672>name: blobstore, release</span>: <span style=color:#ae81ff>bosh}</span>
</span></span><span style=display:flex><span>  - {<span style=color:#f92672>name: director, release</span>: <span style=color:#ae81ff>bosh}</span>
</span></span><span style=display:flex><span>  - {<span style=color:#f92672>name: health_monitor, release</span>: <span style=color:#ae81ff>bosh}</span>
</span></span><span style=display:flex><span>  - {<span style=color:#f92672>name: vsphere_cpi, release</span>: <span style=color:#ae81ff>bosh-vsphere-cpi}</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>routes</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>release</span>: <span style=color:#ae81ff>networking</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>properties</span>:                 <span style=color:#75715e># This customizes the BOSH Director&#39;s</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>networking.routes</span>:        <span style=color:#75715e># routing table so it can reach</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>net</span>: <span style=color:#ae81ff>172.16.1.0</span>         <span style=color:#75715e># the two networks to which it deploys</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>netmask</span>: <span style=color:#f92672>255.255.255.0  # VMs</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>interface</span>: <span style=color:#ae81ff>eth1        </span> <span style=color:#75715e># - CF Public Network  (172.16.1.0/24)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>gateway</span>: <span style=color:#ae81ff>172.16.0.1</span>     <span style=color:#75715e># - CF Private Network (172.16.2.0/24)</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>net</span>: <span style=color:#ae81ff>172.16.2.0</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>netmask</span>: <span style=color:#ae81ff>255.255.255.0</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>interface</span>: <span style=color:#ae81ff>eth1</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>gateway</span>: <span style=color:#ae81ff>172.16.0.1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>vm_type</span>: <span style=color:#ae81ff>medium</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>persistent_disk</span>: <span style=color:#ae81ff>40_960</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  - {<span style=color:#f92672>name: bosh-management-network, static_ips: [10.0.1.6], default</span>: [<span style=color:#ae81ff>dns,gateway]}</span>
</span></span><span style=display:flex><span>  - {<span style=color:#f92672>name: bosh-routing-network, static_ips</span>: [<span style=color:#ae81ff>172.16.0.6</span>]}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>properties</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nats</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>address</span>: <span style=color:#ae81ff>127.0.0.1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>user</span>: <span style=color:#ae81ff>nats</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>password</span>: <span style=color:#ae81ff>nats-password</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>postgres</span>: <span style=color:#75715e>&amp;db</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>listen_address</span>: <span style=color:#ae81ff>127.0.0.1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>host</span>: <span style=color:#ae81ff>127.0.0.1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>user</span>: <span style=color:#ae81ff>postgres</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>password</span>: <span style=color:#ae81ff>postgres-password</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>database</span>: <span style=color:#ae81ff>bosh</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>adapter</span>: <span style=color:#ae81ff>postgres</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>blobstore</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>address</span>: <span style=color:#ae81ff>172.16.0.6</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>25250</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>dav</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>director</span>: {<span style=color:#f92672>user: director, password</span>: <span style=color:#ae81ff>director-password}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>agent</span>: {<span style=color:#f92672>user: agent, password</span>: <span style=color:#ae81ff>agent-password}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>director</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>address</span>: <span style=color:#ae81ff>127.0.0.1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-bosh</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>db</span>: <span style=color:#75715e>*db</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>cpi_job</span>: <span style=color:#ae81ff>vsphere_cpi</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>user_management</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>local</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>local</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>users</span>:
</span></span><span style=display:flex><span>          - {<span style=color:#f92672>name: admin, password</span>: <span style=color:#ae81ff>admin}</span>
</span></span><span style=display:flex><span>          - {<span style=color:#f92672>name: hm, password</span>: <span style=color:#ae81ff>hm-password}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hm</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>director_account</span>: {<span style=color:#f92672>user: hm, password</span>: <span style=color:#ae81ff>hm-password}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>resurrector_enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>vcenter</span>: <span style=color:#75715e>&amp;vcenter</span> <span style=color:#75715e># &lt;--- Replace values below</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>address</span>: <span style=color:#ae81ff>10.0.0.5</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>user</span>: <span style=color:#ae81ff>root</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>password</span>: <span style=color:#ae81ff>vmware</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>datacenters</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>datacenter</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>vm_folder</span>: <span style=color:#ae81ff>vms</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>template_folder</span>: <span style=color:#ae81ff>templates</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>datastore_pattern</span>: <span style=color:#ae81ff>vnx5400-ds</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>persistent_datastore_pattern</span>: <span style=color:#ae81ff>vnx5400-ds</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>disk_path</span>: <span style=color:#ae81ff>disk</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>clusters</span>: [<span style=color:#ae81ff>pizza-boxes]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>agent</span>: {<span style=color:#f92672>mbus</span>: <span style=color:#e6db74>&#34;nats://nats:nats-password@172.16.0.6:4222&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ntp</span>: <span style=color:#75715e>&amp;ntp</span> [<span style=color:#ae81ff>0.</span><span style=color:#ae81ff>pool.ntp.org, 1.pool.ntp.org]</span>
</span></span></code></pre></div><p>Note that <code>properties.blobstore.address</code> and <code>properties.agent.mbus</code> use the
BOSH director&rsquo;s interface that is <em>closest to its deployed VMs</em> (i.e.
172.16.0.6); if you use the other interface (i.e. 10.0.1.6), the VMs will not
be able to contact the director and the deployment will fail.</p><p>Here is our cloud-config manifest:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>bosh-management-network</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>subnets</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>range</span>: <span style=color:#ae81ff>10.0.1.0</span><span style=color:#ae81ff>/24</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>gateway</span>: <span style=color:#ae81ff>10.0.1.1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>static</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>10.0.1.6</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>cloud_properties</span>: { <span style=color:#f92672>name</span>: <span style=color:#ae81ff>bosh-management-network }</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>bosh-routing-network</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>subnets</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>range</span>: <span style=color:#ae81ff>172.16.0.0</span><span style=color:#ae81ff>/24</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>gateway</span>: <span style=color:#ae81ff>172.16.0.1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>static</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>172.16.0.6</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>cloud_properties</span>: { <span style=color:#f92672>name</span>: <span style=color:#ae81ff>bosh-routing-network }</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cf-public-network</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>subnets</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>range</span>: <span style=color:#ae81ff>172.16.1.0</span><span style=color:#ae81ff>/24</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>gateway</span>: <span style=color:#ae81ff>172.16.1.1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>cloud_properties</span>: { <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cf-public-network }</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>vm_types</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>tiny</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>cloud_properties</span>: { <span style=color:#f92672>cpu: 1, ram: 1024, disk</span>: <span style=color:#ae81ff>1024</span> }
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>medium</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>cloud_properties</span>: { <span style=color:#f92672>cpu: 2, ram: 2048, disk</span>: <span style=color:#ae81ff>81_920 }</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>compilation</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>workers</span>: <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>network</span>: <span style=color:#ae81ff>bosh-management-network</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reuse_compilation_vms</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>cloud_properties</span>: { <span style=color:#f92672>cpu: 2, ram: 2048, disk</span>: <span style=color:#ae81ff>1024</span> }
</span></span></code></pre></div><p>Here is our deployment manifest (a very simple deployment):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>simple</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>director_uuid</span>: <span style=color:#ae81ff>__BOSH_DIRECTOR_UUID__</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>releases</span>: []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>stemcells</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>alias</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>os</span>: <span style=color:#ae81ff>ubuntu-trusty</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>version</span>: <span style=color:#ae81ff>latest</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>update</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>canaries</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>max_in_flight</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>canary_watch_time</span>: <span style=color:#ae81ff>5000-300000</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>update_watch_time</span>: <span style=color:#ae81ff>5000-300000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>instance_groups</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>simple-vm</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>instances</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>jobs</span>: []
</span></span><span style=display:flex><span>  <span style=color:#f92672>vm_type</span>: <span style=color:#ae81ff>tiny</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>stemcell</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cf-public-network</span>
</span></span></code></pre></div><h2 id=notes>Notes<a hidden class=anchor aria-hidden=true href=#notes>#</a></h2><p>If one were to dispense with the BOSH Routing Network and deploy VMs on the
same subnet to which the BOSH director is attached, then one would not need to
include the <a href=https://github.com/cloudfoundry/networking-release>BOSH Networking
Release</a> in the BOSH
manifest (the BOSH will not need to traverse a router to reach its deployed
VMs, for the VMs will be deployed to the same subnet on which the director has
an interface).</p><p>More complex BOSH deployments, e.g. <a href=https://github.com/cloudfoundry/cf-release/>Cloud Foundry Elastic
Runtime</a>, typically assume
multiple subnets, requiring the use of the networking-release.</p><p>We use BOSH v2 deployment manifest and cloud config to deploy our BOSH
director; however, BOSH directors are most often deployed with <em>bosh-init</em>,
which uses a slightly different manifest format. It should be a fairly trivial
exercise to convert our manifests to a <em>bosh-init</em>-flavored manifest.</p><h2 id=gotchas>Gotchas<a hidden class=anchor aria-hidden=true href=#gotchas>#</a></h2><p>BOSH stemcells have been hardened, and this may cause unexpected connectivity
issues. Specifically, asymmetric routing may cause pings (or other attempts to
connect) to one of the Director&rsquo;s interfaces to fail (pings to the other
interface should succeed).</p><p>This problem is caused by <a href=https://access.redhat.com/solutions/53031>reverse packet
filtering</a>. To fix, one can enable
the Director&rsquo;s kernel to accept asymmetrically routed packets (the following
commands must be run as root):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#ae81ff>2</span> &gt; /proc/sys/net/ipv4/conf/default/rp_filter
</span></span><span style=display:flex><span>echo <span style=color:#ae81ff>2</span> &gt; /proc/sys/net/ipv4/conf/all/rp_filter
</span></span><span style=display:flex><span>echo <span style=color:#ae81ff>2</span> &gt; /proc/sys/net/ipv4/conf/eth0/rp_filter
</span></span><span style=display:flex><span>echo <span style=color:#ae81ff>2</span> &gt; /proc/sys/net/ipv4/conf/eth1/rp_filter
</span></span></code></pre></div><p>To make the changes permanent (to persist on reboot), the following should
be added to <code>/etc/sysctl.conf</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>net.ipv4.conf.all.rp_filter<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>net.ipv4.conf.default.rp_filter<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>net.ipv4.conf.eth0.rp_filter<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>net.ipv4.conf.eth1.rp_filter<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://blog.nono.io/post/concourse-no-elb/><span class=title>« Prev</span><br><span>Concourse without a Load Balancer</span></a>
<a class=next href=https://blog.nono.io/post/worlds-smallest-concourse-server/><span class=title>Next »</span><br><span>The World's Smallest Concourse CI Server</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share How to Deploy a Multi-homed BOSH Director to a vSphere Environment on twitter" href="https://twitter.com/intent/tweet/?text=How%20to%20Deploy%20a%20Multi-homed%20BOSH%20Director%20to%20a%20vSphere%20Environment&amp;url=https%3a%2f%2fblog.nono.io%2fpost%2fmulti-homed-bosh-director%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to Deploy a Multi-homed BOSH Director to a vSphere Environment on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.nono.io%2fpost%2fmulti-homed-bosh-director%2f&amp;title=How%20to%20Deploy%20a%20Multi-homed%20BOSH%20Director%20to%20a%20vSphere%20Environment&amp;summary=How%20to%20Deploy%20a%20Multi-homed%20BOSH%20Director%20to%20a%20vSphere%20Environment&amp;source=https%3a%2f%2fblog.nono.io%2fpost%2fmulti-homed-bosh-director%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to Deploy a Multi-homed BOSH Director to a vSphere Environment on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.nono.io%2fpost%2fmulti-homed-bosh-director%2f&title=How%20to%20Deploy%20a%20Multi-homed%20BOSH%20Director%20to%20a%20vSphere%20Environment"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to Deploy a Multi-homed BOSH Director to a vSphere Environment on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.nono.io%2fpost%2fmulti-homed-bosh-director%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to Deploy a Multi-homed BOSH Director to a vSphere Environment on whatsapp" href="https://api.whatsapp.com/send?text=How%20to%20Deploy%20a%20Multi-homed%20BOSH%20Director%20to%20a%20vSphere%20Environment%20-%20https%3a%2f%2fblog.nono.io%2fpost%2fmulti-homed-bosh-director%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to Deploy a Multi-homed BOSH Director to a vSphere Environment on telegram" href="https://telegram.me/share/url?text=How%20to%20Deploy%20a%20Multi-homed%20BOSH%20Director%20to%20a%20vSphere%20Environment&amp;url=https%3a%2f%2fblog.nono.io%2fpost%2fmulti-homed-bosh-director%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.nono.io/>Brian Cunnie's Technical Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>