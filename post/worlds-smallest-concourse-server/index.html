<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>The World's Smallest Concourse CI Server | Brian Cunnie's Technical Blog</title><meta name=keywords content><meta name=description content="[2016-04-06: This Blog Post is out-of-date; Please refer to the official Concourse documentation for instructions how to install a Concourse server] Continuous Integration (CI) is often used in conjunction with test-driven development (TDD); however, CI servers often bring their own set of challenges: they are usually &ldquo;snowflakes&rdquo;, uniquely configured machines that are difficult to upgrade, re-configure, or re-install. [snowflakes]
In this blog post, we describe deploying a publicly-accessible, lean (1GB RAM, 1 vCPU, 15GB disk) Concourse CI server using a 350-line manifest."><meta name=author content="Brian Cunnie"><link rel=canonical href=https://blog.nono.io/post/worlds-smallest-concourse-server/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.nono.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.nono.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.nono.io/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.nono.io/apple-touch-icon.png><link rel=mask-icon href=https://blog.nono.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-0NJ11E527T"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0NJ11E527T",{anonymize_ip:!1})}</script><meta property="og:title" content="The World's Smallest Concourse CI Server"><meta property="og:description" content="[2016-04-06: This Blog Post is out-of-date; Please refer to the official Concourse documentation for instructions how to install a Concourse server] Continuous Integration (CI) is often used in conjunction with test-driven development (TDD); however, CI servers often bring their own set of challenges: they are usually &ldquo;snowflakes&rdquo;, uniquely configured machines that are difficult to upgrade, re-configure, or re-install. [snowflakes]
In this blog post, we describe deploying a publicly-accessible, lean (1GB RAM, 1 vCPU, 15GB disk) Concourse CI server using a 350-line manifest."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.nono.io/post/worlds-smallest-concourse-server/"><meta property="og:image" content="https://nono.io/images/brian_cunnie_profile.jpg"><meta property="article:section" content="post"><meta property="article:published_time" content="2015-10-24T13:52:48-07:00"><meta property="article:modified_time" content="2015-10-24T13:52:48-07:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nono.io/images/brian_cunnie_profile.jpg"><meta name=twitter:title content="The World's Smallest Concourse CI Server"><meta name=twitter:description content="[2016-04-06: This Blog Post is out-of-date; Please refer to the official Concourse documentation for instructions how to install a Concourse server] Continuous Integration (CI) is often used in conjunction with test-driven development (TDD); however, CI servers often bring their own set of challenges: they are usually &ldquo;snowflakes&rdquo;, uniquely configured machines that are difficult to upgrade, re-configure, or re-install. [snowflakes]
In this blog post, we describe deploying a publicly-accessible, lean (1GB RAM, 1 vCPU, 15GB disk) Concourse CI server using a 350-line manifest."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.nono.io/post/"},{"@type":"ListItem","position":2,"name":"The World's Smallest Concourse CI Server","item":"https://blog.nono.io/post/worlds-smallest-concourse-server/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"The World's Smallest Concourse CI Server","name":"The World\u0027s Smallest Concourse CI Server","description":"[2016-04-06: This Blog Post is out-of-date; Please refer to the official Concourse documentation for instructions how to install a Concourse server] Continuous Integration (CI) is often used in conjunction with test-driven development (TDD); however, CI servers often bring their own set of challenges: they are usually \u0026ldquo;snowflakes\u0026rdquo;, uniquely configured machines that are difficult to upgrade, re-configure, or re-install. [snowflakes]\nIn this blog post, we describe deploying a publicly-accessible, lean (1GB RAM, 1 vCPU, 15GB disk) Concourse CI server using a 350-line manifest.","keywords":[],"articleBody":"[2016-04-06: This Blog Post is out-of-date; Please refer to the official Concourse documentation for instructions how to install a Concourse server] Continuous Integration (CI) is often used in conjunction with test-driven development (TDD); however, CI servers often bring their own set of challenges: they are usually “snowflakes”, uniquely configured machines that are difficult to upgrade, re-configure, or re-install. [snowflakes]\nIn this blog post, we describe deploying a publicly-accessible, lean (1GB RAM, 1 vCPU, 15GB disk) Concourse CI server using a 350-line manifest. Upgrades/re-configurations/re-installs are as simple as editing a file and typing one command (bosh-init).\nWe must confess to sleight-of-hand: although we describe deploying a CI server, the worker is too lean to run any but the smallest tests. The deployed CI Server we describe can’t run large tests.\nWe will address that shortcoming in a future blog post where we describe the manual provisioning of local workers. The process isn’t difficult, but including it would have made the blog post undesirably long.\n0. Set Up the Concourse Server In the following steps, we demonstrate creating a Concourse CI server, ci.blabbertabber.com for our open source Android project, BlabberTabber.\n0.0 Prepare an AWS Account We follow the bosh.io instructions [AWS tooling] to prepare our AWS account.\nAfter we have completed this step, we have the information we need to populate our BOSH deployment’s manifest:\nAccess Key ID, e.g. AKIAxxxxxxxxxxxxxxxx Secret Access Key, e.g. 0+B1XW6VVxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx Availability Zone, e.g. us-east-1a Region, e.g. us-east-1 Elastic IP, e.g. 52.23.10.10 Subnet ID, e.g. subnet-1c90ef6b Key Pair Name, e.g. bosh, aws_nono Key Pair Path, e.g. ~/my-bosh/bosh.pem, ~/.ssh/aws_nono.pem 0.1 Create the concourse Security Group Although we created an AWS Security Group in the previous step, it doesn’t suit our purposes—we need to open the ports for HTTP (80) and HTTPS (443). We create a concourse Security Group via the Amazon AWS Console:\nVPC → Security Groups\nclick Create Security Group\nName tag: concourse Description: Rules for accessing Concourse CI server VPC: select the VPC in which you created in the previous step click Yes, Create click Inbound Rules tab\nclick Edit\nadd the following rules:\nType of Traffic Protocol Port Range Source IP CIDR Notes SSH (22) TCP (6) 22 0.0.0.0/0 debugging, agents HTTP (80) TCP (6) 80 0.0.0.0/0 redirect HTTPS (443) TCP (6) 443 0.0.0.0/0 web Custom TCP Rule TCP (6) 2222 0.0.0.0/0 agents Custom TCP Rule TCP (6) 6868 0.0.0.0/0 bosh-init click Save\n0.2 Obtain SSL Certificates We decide to use HTTPS to communicate with our Concourse server, for we will need to authenticate against the webserver when we configure our CI (when we transmit our credentials over the Internet we want them to be encrypted).\nWe purchase valid SSL certificates for our server [Let’s Encrypt] . Using a self-signed certificate is also an option.\nWe use the following command to create our key and CSR. Note that you should substitute your information where appropriate, especially for the CN (Common Name), i.e. don’t use ci.blabbertabber.com.\nopenssl req -new \\ -keyout ci.blabbertabber.com.key \\ -out ci.blabbertabber.com.csr \\ -newkey rsa:4096 -sha256 -nodes \\ -subj '/C=US/ST=California/L=San Francisco/O=blabbertabber.com/OU=/CN=ci.blabbertabber.com/emailAddress=brian.cunnie@gmail.com' We submit the CSR to our vendor, authorize the issuance of the certificate, and receive our certificate, which we will place in our manifest (along with the key and the CA certificate chain).\nWe configure a DNS A record for our concourse server to point to our AWS Elastic IP. We have the following line in our blabbertabber.com zone file:\nci.blabbertabber.com. A 52.23.10.10 0.3 Create Private SSH Key for Remote workers We create a private ssh key for our remote worker:\nssh-keygen -P '' -f ~/.ssh/worker_key We will use the public key in the next step, when we create our BOSH manifest.\n0.4 Create BOSH Manifest We create the BOSH manifest for our Concourse server by doing the following:\ndownload the redacted (passwords \u0026 keys removed) BOSH manifest open it in an editor search for every occurrence of FIXME update the field described by the FIXME, e.g. update the IP address, set the password, set the Subnet ID, etc…. For those interested, our sample Concourse manifest was derived from Concourse’s official sample bosh-init manifest and modified as follows:\nadded an nginx release to provide SSL termination (i.e. HTTPS) while bypassing the need for an ELB ($219.14/year [ELB-pricing] ). This was also why we enabled ports 80 and 443 in our AWS Security Group. added a postgres job and configured our Concourse server to use that instead of Amazon RDS in order to eliminate RDS charges, but we suspect the savings to be insignificant. configured the web interface to be publicly-viewable but require authorization to make changes added our remote worker’s public key to jobs.properties.tsa.authorized_keys 0.5 Deploy the Concourse Server We install bosh-init by following these instructions.\nWe use bosh-init to deploy Concourse using the manifest we created in the previous step. In the following example, our manifest is named concourse-aws.yml:\nbosh-init deploy concourse-aws.yml ... Finished deploying (00:12:15) Stopping registry... Finished (00:00:00) Cleaning up rendered CPI jobs... Finished (00:00:00) A deployment takes ~12 minutes.This gist contains the complete output of the bosh-init deployment.\n0.6 Verify Deployment and Download Concourse CLI We browse to https://ci.blabbertabber.com.\nWe download the fly CLI by clicking on the Apple icon (assuming that your workstation is an OS X machine) and move it into place:\ninstall ~/Downloads/fly /usr/local/bin 0.7 Create Hello World Concourse job We follow Concourse’s Getting Started instructions to create our first pipeline. We add tags [ \"micro\" ] to the sample Concourse pipeline so that the job is run on our “micro” worker (in our BOSH manifest, we tag the worker that is colocated on our t2.micro Concourse server “micro” so that we can steer small jobs to it).\ncat \u003e hello-world.yml \u003c","wordCount":"1633","inLanguage":"en","datePublished":"2015-10-24T13:52:48-07:00","dateModified":"2015-10-24T13:52:48-07:00","author":{"@type":"Person","name":"Brian Cunnie"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.nono.io/post/worlds-smallest-concourse-server/"},"publisher":{"@type":"Organization","name":"Brian Cunnie's Technical Blog","logo":{"@type":"ImageObject","url":"https://blog.nono.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.nono.io/ accesskey=h title="Brian Cunnie's Technical Blog (Alt + H)">Brian Cunnie's Technical Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.nono.io/>Home</a>&nbsp;»&nbsp;<a href=https://blog.nono.io/post/>Posts</a></div><h1 class=post-title>The World's Smallest Concourse CI Server</h1><div class=post-meta><span title='2015-10-24 13:52:48 -0700 -0700'>October 24, 2015</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Brian Cunnie&nbsp;|&nbsp;<a href=https://github.com/cunnie/cunnie.github.io/tree/master/content/post/worlds-smallest-concourse-server.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><h3 id=2016-04-06-this-blog-post-is-out-of-date-please-refer-to-the-official-concourse-documentationhttpconcourseciinstallinghtml-for-instructions-how-to-install-a-concourse-server><em>[2016-04-06: This Blog Post is out-of-date; Please refer to the official <a href=http://concourse.ci/installing.html>Concourse documentation</a> for instructions how to install a Concourse server]</em><a hidden class=anchor aria-hidden=true href=#2016-04-06-this-blog-post-is-out-of-date-please-refer-to-the-official-concourse-documentationhttpconcourseciinstallinghtml-for-instructions-how-to-install-a-concourse-server>#</a></h3><p><a href=https://en.wikipedia.org/wiki/Continuous_integration>Continuous Integration</a>
(CI) is often used in conjunction with test-driven development (TDD);
however, CI servers often
bring their own set of challenges: they are usually &ldquo;snowflakes&rdquo;,
uniquely configured machines that are difficult to upgrade, re-configure, or
re-install. <sup><a href=#snowflakes>[snowflakes]</a></sup></p><p>In this blog post, we describe deploying a publicly-accessible, lean
(1GB RAM, 1 vCPU, 15GB disk)
<a href=http://concourse.ci/>Concourse</a> CI server using a 350-line manifest.
Upgrades/re-configurations/re-installs are as simple as editing a file
and typing one command (<em>bosh-init</em>).</p><p>We must confess to sleight-of-hand: although we describe deploying a CI
server, the worker is too lean to run any but the smallest tests.
<strong>The deployed CI Server we describe can&rsquo;t run large tests</strong>.</p><p>We will address that shortcoming in a future blog post where we describe
the manual provisioning of local workers. The process isn&rsquo;t difficult, but
including it would have made the blog post undesirably long.</p><h2 id=0-set-up-the-concourse-server>0. Set Up the Concourse Server<a hidden class=anchor aria-hidden=true href=#0-set-up-the-concourse-server>#</a></h2><p>In the following steps, we demonstrate creating a Concourse
CI server, <a href=https://ci.blabbertabber.com/>ci.blabbertabber.com</a>
for our open source Android project,
<a href=https://github.com/blabbertabber/blabbertabber>BlabberTabber</a>.</p><h3 id=00-prepare-an-aws-account>0.0 Prepare an AWS Account<a hidden class=anchor aria-hidden=true href=#00-prepare-an-aws-account>#</a></h3><p>We follow the bosh.io <a href=http://bosh.io/docs/init-aws.html#prepare-aws>instructions</a>
<sup><a href=#aws_tooling>[AWS tooling]</a></sup>
to prepare our AWS account.</p><p>After we have completed this step, we have the information
we need to populate our BOSH deployment&rsquo;s manifest:</p><ul><li>Access Key ID, e.g. AKIAxxxxxxxxxxxxxxxx</li><li>Secret Access Key, e.g. 0+B1XW6VVxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</li><li>Availability Zone, e.g. us-east-1a</li><li>Region, e.g. us-east-1</li><li>Elastic IP, e.g. 52.23.10.10</li><li>Subnet ID, e.g. subnet-1c90ef6b</li><li>Key Pair Name, e.g. bosh, aws_nono</li><li>Key Pair Path, e.g. ~/my-bosh/bosh.pem, ~/.ssh/aws_nono.pem</li></ul><h3 id=01-create-the-concourse-security-group>0.1 Create the <em>concourse</em> Security Group<a hidden class=anchor aria-hidden=true href=#01-create-the-concourse-security-group>#</a></h3><p>Although we created an AWS Security Group in the previous step, it doesn&rsquo;t
suit our purposes—we need to open the ports for HTTP (80) and HTTPS (443).
We create a <em>concourse</em> Security Group via the Amazon AWS Console:</p><ul><li><p><strong>VPC → Security Groups</strong></p></li><li><p>click <strong>Create Security Group</strong></p><ul><li>Name tag: <strong>concourse</strong></li><li>Description: <strong>Rules for accessing Concourse CI server</strong></li><li>VPC: <em>select the VPC in which you created in the previous step</em></li><li>click <strong>Yes, Create</strong></li></ul></li><li><p>click <strong>Inbound Rules</strong> tab</p></li><li><p>click <strong>Edit</strong></p></li><li><p>add the following rules:</p><table><thead><tr><th style=text-align:left>Type of Traffic</th><th style=text-align:left>Protocol</th><th style=text-align:right>Port Range</th><th style=text-align:right>Source IP CIDR</th><th style=text-align:left>Notes</th></tr></thead><tbody><tr><td style=text-align:left>SSH (22)</td><td style=text-align:left>TCP (6)</td><td style=text-align:right>22</td><td style=text-align:right>0.0.0.0/0</td><td style=text-align:left>debugging, agents</td></tr><tr><td style=text-align:left>HTTP (80)</td><td style=text-align:left>TCP (6)</td><td style=text-align:right>80</td><td style=text-align:right>0.0.0.0/0</td><td style=text-align:left>redirect</td></tr><tr><td style=text-align:left>HTTPS (443)</td><td style=text-align:left>TCP (6)</td><td style=text-align:right>443</td><td style=text-align:right>0.0.0.0/0</td><td style=text-align:left>web</td></tr><tr><td style=text-align:left>Custom TCP Rule</td><td style=text-align:left>TCP (6)</td><td style=text-align:right>2222</td><td style=text-align:right>0.0.0.0/0</td><td style=text-align:left>agents</td></tr><tr><td style=text-align:left>Custom TCP Rule</td><td style=text-align:left>TCP (6)</td><td style=text-align:right>6868</td><td style=text-align:right>0.0.0.0/0</td><td style=text-align:left>bosh-init</td></tr></tbody></table></li><li><p>click <strong>Save</strong></p></li></ul><h3 id=02-obtain-ssl-certificates>0.2 Obtain SSL Certificates<a hidden class=anchor aria-hidden=true href=#02-obtain-ssl-certificates>#</a></h3><p>We decide to use HTTPS to communicate with our Concourse server, for we will
need to authenticate against the webserver when we configure our CI
(when we transmit our credentials over the Internet we want them to be encrypted).</p><p>We purchase valid SSL certificates for our server <sup><a href=#lets_encrypt>[Let&rsquo;s Encrypt]</a></sup> .
Using a self-signed certificate is also an option.</p><p>We use the following command to create our key and CSR. Note that you
should substitute your information where appropriate, especially for the
CN (Common Name), i.e. don&rsquo;t use <em>ci.blabbertabber.com</em>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>openssl req -new <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -keyout ci.blabbertabber.com.key <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -out ci.blabbertabber.com.csr <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -newkey rsa:4096 -sha256 -nodes <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -subj <span style=color:#e6db74>&#39;/C=US/ST=California/L=San Francisco/O=blabbertabber.com/OU=/CN=ci.blabbertabber.com/emailAddress=brian.cunnie@gmail.com&#39;</span>
</span></span></code></pre></div><p>We submit the CSR to our vendor, authorize the issuance of the certificate,
and receive our certificate, which we will place in our manifest (along with
the key and the CA certificate chain).</p><p>We configure a DNS A record for our concourse server to point to our AWS Elastic IP.
We have the following line in our blabbertabber.com zone file:</p><pre tabindex=0><code>ci.blabbertabber.com. A 52.23.10.10
</code></pre><h3 id=03-create-private-ssh-key-for-remote-workers>0.3 Create Private SSH Key for Remote workers<a hidden class=anchor aria-hidden=true href=#03-create-private-ssh-key-for-remote-workers>#</a></h3><p>We create a private ssh key for our remote worker:</p><pre tabindex=0><code>ssh-keygen -P &#39;&#39;  -f ~/.ssh/worker_key
</code></pre><p>We will use the public key in the next step, when we create our BOSH manifest.</p><h3 id=04-create-bosh-manifest>0.4 Create BOSH Manifest<a hidden class=anchor aria-hidden=true href=#04-create-bosh-manifest>#</a></h3><p>We create the BOSH manifest for our Concourse server by doing the following:</p><ul><li>download the redacted (passwords & keys removed) BOSH <a href=https://github.com/blabbertabber/blabbertabber/blob/develop/ci/concourse-aws.yml>manifest</a></li><li>open it in an editor</li><li>search for every occurrence of <em>FIXME</em></li><li>update the field described by the <em>FIXME</em>, e.g. update the IP address,
set the password, set the Subnet ID, etc&mldr;.</li></ul><p>For those interested, our sample Concourse manifest was derived from
Concourse&rsquo;s official sample <em>bosh-init</em>
<a href=https://github.com/concourse/concourse/blob/master/manifests/bosh-init-aws.yml>manifest</a> and modified as follows:</p><ul><li>added an nginx release to provide SSL termination (i.e. HTTPS)
while bypassing the need for an ELB ($219.14/year <sup><a href=#ELB-pricing>[ELB-pricing]</a></sup> ).
This was also why we enabled ports 80 and 443 in our AWS Security Group.</li><li>added a postgres job and configured our Concourse server to use that instead of Amazon RDS in order
to eliminate RDS charges, but we suspect the savings to be insignificant.</li><li>configured the web interface to be publicly-viewable but require authorization to make changes</li><li>added our remote worker&rsquo;s public key to <em>jobs.properties.tsa.authorized_keys</em></li></ul><h3 id=05-deploy-the-concourse-server>0.5 Deploy the Concourse Server<a hidden class=anchor aria-hidden=true href=#05-deploy-the-concourse-server>#</a></h3><p>We install <em>bosh-init</em> by following these <a href=https://bosh.io/docs/install-bosh-init.html>instructions</a>.</p><p>We use <em>bosh-init</em> to deploy Concourse using the manifest
we created in the previous step. In the following example, our manifest is
named <em>concourse-aws.yml</em>:</p><pre tabindex=0><code>bosh-init deploy concourse-aws.yml
  ...
  Finished deploying (00:12:15)

  Stopping registry... Finished (00:00:00)
  Cleaning up rendered CPI jobs... Finished (00:00:00)
</code></pre><p>A deployment takes ~12 minutes.This <a href=https://gist.github.com/cunnie/088794c9566a707aed71>gist</a> contains
the complete output of the <em>bosh-init</em> deployment.</p><h3 id=06-verify-deployment-and-download-concourse-cli>0.6 Verify Deployment and Download Concourse CLI<a hidden class=anchor aria-hidden=true href=#06-verify-deployment-and-download-concourse-cli>#</a></h3><p>We browse to <a href=https://ci.blabbertabber.com>https://ci.blabbertabber.com</a>.</p><figure><img loading=lazy src=/images/concourse-000/no_pipelines.png></figure><p>We download the <code>fly</code> CLI by clicking on the Apple icon (assuming that your workstation is an OS X machine) and move it into place:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>install ~/Downloads/fly /usr/local/bin
</span></span></code></pre></div><h3 id=07-create-hello-world-concourse-job>0.7 Create <em>Hello World</em> Concourse job<a hidden class=anchor aria-hidden=true href=#07-create-hello-world-concourse-job>#</a></h3><p>We follow Concourse&rsquo;s <a href=http://concourse.ci/getting-started.html>Getting Started</a>
instructions to create our first pipeline. We
add <code>tags [ "micro" ]</code> to the sample Concourse pipeline
so that the job is run on our &ldquo;micro&rdquo; worker (in
our BOSH manifest, we tag the worker that
is colocated on our <em>t2.micro</em> Concourse
server &ldquo;micro&rdquo; so that we can steer small jobs
to it).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat &gt; hello-world.yml <span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>jobs:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- name: hello-world
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  plan:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - task: say-hello
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    config:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      platform: linux
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      image: &#34;docker:///ubuntu&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      tags: [ &#34;micro&#34; ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      run:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        path: echo
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        args: [&#34;Hello, world!&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><p>We configure the pipeline (remember to substitute the username and password in the manifest,
<em>jobs.properties.atc.basic_auth_username</em> and <em>jobs.properties.atc.basic_auth_password</em>,
for &ldquo;user:password&rdquo; below):</p><pre tabindex=0><code>fly -t &#34;https://user:password@ci.blabbertabber.com&#34; set-pipeline -p really-cool-pipeline -c hello-world.yml
</code></pre><p>You can see the gist of the output <a href=https://gist.github.com/cunnie/a3a125e9069e493ef8ca>here</a>.</p><p>Type <strong>y</strong> when prompted to apply the configuration.</p><h3 id=08-browse-to-concourse-and-kick-off-job>0.8 Browse to Concourse and Kick off Job<a hidden class=anchor aria-hidden=true href=#08-browse-to-concourse-and-kick-off-job>#</a></h3><p>Refresh <a href=https://ci.blabbertabber.com>https://ci.blabbertabber.com</a> to
see our newly-created pipeline:</p><figure><img loading=lazy src=/images/concourse-000/new_pipeline.png></figure><p>Next we unpause the job</p><ul><li>click the &ldquo;≡&rdquo; (hamburger) in the upper left hand corner</li><li>click the &ldquo;▶&rdquo; (play button) that appears below the hamburger.
This will un-pause our pipeline and allow builds to run.</li><li>click <strong>Log in with Basic Auth</strong></li><li>authenticate with the <em>atc</em>&rsquo;s account and password (these can be found in the manifest,
<em>jobs.properties.atc.basic_auth_username</em> and <em>jobs.properties.atc.basic_auth_password</em>)</li><li>click the &ldquo;≡&rdquo; (hamburger) in the upper left hand corner (yes, again)</li><li>click the &ldquo;▶&rdquo; (play button) that appears below the hamburger.
The banner at the top of the screen will switch from light-blue to black.
The page should look like this:</li></ul><figure><img loading=lazy src=/images/concourse-000/unpaused_pipeline.png></figure><h3 id=09-our-first-integration-test-hello-world>0.9 Our First Integration Test: Hello World<a hidden class=anchor aria-hidden=true href=#09-our-first-integration-test-hello-world>#</a></h3><p>We kick off our job:</p><ul><li>click the <em>hello-world</em> rectangle in the middle of the screen.</li><li>click the &ldquo;<strong>⊕</strong>&rdquo; button in the upper right hand side of the screen</li></ul><p>We see that the job completes successfully by the
pea-green color. We click &ldquo;<strong>>_ say-hello</strong>&rdquo; to see the output:</p><figure><img loading=lazy src=/images/concourse-000/success.png></figure><h2 id=10-conclusion>1.0 Conclusion<a hidden class=anchor aria-hidden=true href=#10-conclusion>#</a></h2><p>We have demonstrated with the ease with which one can deploy a CI server
using a combination of <em>Concourse</em> and <em>bosh-init</em>, a deployment which takes
less than a quarter hour from start (no disk, no OS) to finish (a publicly-accessible,
up-and-running CI server) and which is easily re-deployed.</p><p>We recognize that our deployment is incomplete, that it lacks the workers
necessary to run jobs of any consequence. We will describe how to manually
provision workers in our next blog post.</p><p>One of the benefits of the <em>Concourse/bosh-init</em> combination is that <em>Concourse</em>
stores its state on a <a href=https://bosh.io/docs/persistent-disks.html>persistent disk</a>,
so that re-deploying the CI server (e.g. new OS, new Concourse) won&rsquo;t cause the loss
of the pipeline configuration or build history.</p><h2 id=appendix-a-concourse-yearly-costs-8034>Appendix A. Concourse Yearly Costs: $80.34<a hidden class=anchor aria-hidden=true href=#appendix-a-concourse-yearly-costs-8034>#</a></h2><p>The yearly cost of running a Concourse server is $80.34. Note that this
does not include the cost of the worker.
Had we chosen to implement the recommended m3.large EC2 instance for a worker, it
would have increased our yearly cost by $713.54 <sup><a href=#m3.large>[m3.large]</a></sup> .</p><p>Here are our costs:</p><table><thead><tr><th>Expense</th><th>Vendor</th><th>Cost</th><th>Cost / year</th></tr></thead><tbody><tr><td><em>ci.blabbertabber.com</em> cert</td><td>cheapsslshop.com</td><td>$14.85 3-year <sup><a href=#inexpensive-SSL>[inexpensive-SSL]</a></sup></td><td>$4.95</td></tr><tr><td>EC2 t2.micro instance</td><td>Amazon AWS</td><td>$0.0086 / hour <sup><a href=#t2.micro>[t2.micro]</a></sup></td><td>$75.39</td></tr></tbody></table><h2 id=footnotes>Footnotes<a hidden class=anchor aria-hidden=true href=#footnotes>#</a></h2><p><a name=snowflakes><sup>[snowflakes]</sup></a>
Even the most innocuous changes to a CI server can be fraught with anxiety: two years
ago when we were migrating one of our development team&rsquo;s Jenkins CI server VM
from one datastore to another (a very low-risk operation),
we needed to have several meetings with the Team&rsquo;s
product manager and the anchor before they were willing to allow us to proceed
with the migration.</p><p><a name=aws_tooling><sup>[AWS Tooling]</sup></a>
We appreciate that creating the AWS infrastructure (VPC, Elastic IP, Key Pair)
is tedious and a bit of a clickfest. We&rsquo;re working to make this much easier, soon.
Per Rob Dimsdale, &ldquo;the MEGA team is actively working on tooling to improve the
user-experience of creating the AWS stack for Concourse, but we&rsquo;re not ready
for public consumption of that tooling just yet.&rdquo; Stay tuned.</p><p><a name=lets_encrypt><sup>[Let&rsquo;s Encrypt]</sup></a>
<a href=https://letsencrypt.org/>Let&rsquo;s Encrypt</a> is a &ldquo;free, automated, and open&rdquo;
Certificate Authority which issues valid SSL certificates free of charge.
We are eagerly awaiting its launch, which hopefully will happen within the
next few weeks.</p><p><a name=ELB-pricing><sup>[ELB-pricing]</sup></a> ELB pricing, as of this writing, is <a href=https://aws.amazon.com/elasticloadbalancing/pricing/>$0.025/hour</a>, $0.60/day, $219.1455 / year (assuming 365.2425 days / year).</p><p><a name=m3.large><sup>[m3.large]</sup></a> Amazon effectively charges <a href=https://aws.amazon.com/ec2/pricing/>$0.0814/hour</a> for a 1 year term all-upfront m3.large reserved instance.</p><p><a name=inexpensive-SSL><sup>[inexpensive-SSL]</sup></a> One shouldn&rsquo;t pay more than
$25 for a 3-year certificate. We used <a href=https://www.cheapsslshop.com/comodo-positive-ssl>SSLSHOP</a> to purchase our <em>Comodo Positive SSL</em>, but there are many good SSL vendors, and we don&rsquo;t endorse one over
the other.</p><p><a name=t2.micro><sup>[t2.micro]</sup></a> Amazon effectively charges <a href=https://aws.amazon.com/ec2/pricing/>$0.0086/hour</a> for a 1 year term all-upfront t2.micro reserved instance.</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://blog.nono.io/post/multi-homed-bosh-director/><span class=title>« Prev</span><br><span>How to Deploy a Multi-homed BOSH Director to a vSphere Environment</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share The World's Smallest Concourse CI Server on twitter" href="https://twitter.com/intent/tweet/?text=The%20World%27s%20Smallest%20Concourse%20CI%20Server&url=https%3a%2f%2fblog.nono.io%2fpost%2fworlds-smallest-concourse-server%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share The World's Smallest Concourse CI Server on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.nono.io%2fpost%2fworlds-smallest-concourse-server%2f&title=The%20World%27s%20Smallest%20Concourse%20CI%20Server&summary=The%20World%27s%20Smallest%20Concourse%20CI%20Server&source=https%3a%2f%2fblog.nono.io%2fpost%2fworlds-smallest-concourse-server%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share The World's Smallest Concourse CI Server on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.nono.io%2fpost%2fworlds-smallest-concourse-server%2f&title=The%20World%27s%20Smallest%20Concourse%20CI%20Server"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share The World's Smallest Concourse CI Server on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.nono.io%2fpost%2fworlds-smallest-concourse-server%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share The World's Smallest Concourse CI Server on whatsapp" href="https://api.whatsapp.com/send?text=The%20World%27s%20Smallest%20Concourse%20CI%20Server%20-%20https%3a%2f%2fblog.nono.io%2fpost%2fworlds-smallest-concourse-server%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share The World's Smallest Concourse CI Server on telegram" href="https://telegram.me/share/url?text=The%20World%27s%20Smallest%20Concourse%20CI%20Server&url=https%3a%2f%2fblog.nono.io%2fpost%2fworlds-smallest-concourse-server%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://blog.nono.io/>Brian Cunnie's Technical Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>