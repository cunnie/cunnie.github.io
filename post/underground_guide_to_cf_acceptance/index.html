<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>The Underground Guide to Cloud Foundry Acceptance Tests | Brian Cunnie's Technical Blog</title><meta name=keywords content><meta name=description content="The Cloud Foundry Acceptance Tests are the gold standard to test the proper functioning of your Cloud Foundry deployment. This guide tells you how to run them. When in doubt, refer to the README.
Quick Start cd ~/workspace/ git clone git@github.com:cloudfoundry/cf-acceptance-tests.git cd cf-acceptance-tests . ./.envrc bin/update_submodules cp example-cats-config.json cats-config.json export CONFIG=cats-config.json cf api api.cf.nono.io # or whatever your Cloud Foundry's API endpoint is cf login -u admin cf create-space -o system system # don't worry if it's already created cf t -o system -s system cf enable-feature-flag diego_docker # necessary if you're running the Docker tests (`&#34;include_docker&#34;: true`) Let&rsquo;s configure our cats-config."><meta name=author content="Brian Cunnie"><link rel=canonical href=https://blog.nono.io/post/underground_guide_to_cf_acceptance/><link crossorigin=anonymous href=/assets/css/stylesheet.min.6cba0d81b5f3f42bb578d49f402ba4175aa72b43def148780b8ad714c957c6f5.css integrity="sha256-bLoNgbXz9Cu1eNSfQCukF1qnK0Pe8Uh4C4rXFMlXxvU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.nono.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.nono.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.nono.io/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.nono.io/apple-touch-icon.png><link rel=mask-icon href=https://blog.nono.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.102.3"><script async src="https://www.googletagmanager.com/gtag/js?id=G-0NJ11E527T"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0NJ11E527T",{anonymize_ip:!1})}</script><meta property="og:title" content="The Underground Guide to Cloud Foundry Acceptance Tests"><meta property="og:description" content="The Cloud Foundry Acceptance Tests are the gold standard to test the proper functioning of your Cloud Foundry deployment. This guide tells you how to run them. When in doubt, refer to the README.
Quick Start cd ~/workspace/ git clone git@github.com:cloudfoundry/cf-acceptance-tests.git cd cf-acceptance-tests . ./.envrc bin/update_submodules cp example-cats-config.json cats-config.json export CONFIG=cats-config.json cf api api.cf.nono.io # or whatever your Cloud Foundry's API endpoint is cf login -u admin cf create-space -o system system # don't worry if it's already created cf t -o system -s system cf enable-feature-flag diego_docker # necessary if you're running the Docker tests (`&#34;include_docker&#34;: true`) Let&rsquo;s configure our cats-config."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.nono.io/post/underground_guide_to_cf_acceptance/"><meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/2/29/Postgresql_elephant.svg"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-07-04T12:46:03-07:00"><meta property="article:modified_time" content="2022-07-04T12:46:03-07:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://upload.wikimedia.org/wikipedia/commons/2/29/Postgresql_elephant.svg"><meta name=twitter:title content="The Underground Guide to Cloud Foundry Acceptance Tests"><meta name=twitter:description content="The Cloud Foundry Acceptance Tests are the gold standard to test the proper functioning of your Cloud Foundry deployment. This guide tells you how to run them. When in doubt, refer to the README.
Quick Start cd ~/workspace/ git clone git@github.com:cloudfoundry/cf-acceptance-tests.git cd cf-acceptance-tests . ./.envrc bin/update_submodules cp example-cats-config.json cats-config.json export CONFIG=cats-config.json cf api api.cf.nono.io # or whatever your Cloud Foundry's API endpoint is cf login -u admin cf create-space -o system system # don't worry if it's already created cf t -o system -s system cf enable-feature-flag diego_docker # necessary if you're running the Docker tests (`&#34;include_docker&#34;: true`) Let&rsquo;s configure our cats-config."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.nono.io/post/"},{"@type":"ListItem","position":2,"name":"The Underground Guide to Cloud Foundry Acceptance Tests","item":"https://blog.nono.io/post/underground_guide_to_cf_acceptance/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"The Underground Guide to Cloud Foundry Acceptance Tests","name":"The Underground Guide to Cloud Foundry Acceptance Tests","description":"The Cloud Foundry Acceptance Tests are the gold standard to test the proper functioning of your Cloud Foundry deployment. This guide tells you how to run them. When in doubt, refer to the README.\nQuick Start cd ~/workspace/ git clone git@github.com:cloudfoundry/cf-acceptance-tests.git cd cf-acceptance-tests . ./.envrc bin/update_submodules cp example-cats-config.json cats-config.json export CONFIG=cats-config.json cf api api.cf.nono.io # or whatever your Cloud Foundry\u0026#39;s API endpoint is cf login -u admin cf create-space -o system system # don\u0026#39;t worry if it\u0026#39;s already created cf t -o system -s system cf enable-feature-flag diego_docker # necessary if you\u0026#39;re running the Docker tests (`\u0026#34;include_docker\u0026#34;: true`) Let\u0026rsquo;s configure our cats-config.","keywords":[],"articleBody":" The Cloud Foundry Acceptance Tests are the gold standard to test the proper functioning of your Cloud Foundry deployment. This guide tells you how to run them. When in doubt, refer to the README.\nQuick Start cd ~/workspace/ git clone git@github.com:cloudfoundry/cf-acceptance-tests.git cd cf-acceptance-tests . ./.envrc bin/update_submodules cp example-cats-config.json cats-config.json export CONFIG=cats-config.json cf api api.cf.nono.io # or whatever your Cloud Foundry's API endpoint is cf login -u admin cf create-space -o system system # don't worry if it's already created cf t -o system -s system cf enable-feature-flag diego_docker # necessary if you're running the Docker tests (`\"include_docker\": true`) Let’s configure our cats-config.json. You should know the values for all the replacements except credhub_secret; we’ll explain how to get that next:\n-IN DEVELOPMENT { - \"api\": \"api.DOMAIN.com\", - \"apps_domain\": \"DOMAIN.com\", + \"api\": \"api.cf.nono.io\", + \"apps_domain\": \"foundry.fun\", \"admin_user\": \"admin\", - \"admin_password\": \"PASSWORD\", + \"admin_password\": \"MySecretAdminPassword\", \"credhub_mode\": \"assisted\", - \"credhub_client\": \"CREDHUB_CLIENT\", - \"credhub_secret\": \"CREDHUB_SECRET\", + \"credhub_client\": \"credhub_admin_client\", + \"credhub_secret\": \"XDBlXvmH7aN3IG2czVfzvitu5dTHIj\", \"artifacts_directory\": \"logs\", \"skip_ssl_validation\": true, \"timeout_scale\": 1, By default you’re running the CredHub tests, so you need credhub_secret, but getting it is a multi-step affair. First, get the credentials to communicate with the BOSH Director’s CredHub:\nbosh int --path /instance_groups/name=bosh/jobs/name=uaa/properties/uaa/scim/users/name=credhub_cli_user bosh-vsphere.yml [where bosh-vsphere.yml is your BOSH Director’s manifest]\nThe output should look something like the following:\ngroups: - credhub.read - credhub.write name: credhub_cli_user password: SomeKrazyPassword Now that we have the password (“SomeKrazyPassword”), let’s authenticate to the BOSH Director’s CredHub using the CredHub CLI:\ncredhub api bosh-vsphere.nono.io:8844 --skip-tls-validation # assuming your BOSH Director's hostname is \"bosh-vsphere.nono.io\" credhub login --username=credhub_cli_user --password=SomeKrazyPassword credhub find -n / # we don't need this, but it gives us a complete list of creds credhub get -n /bosh-vsphere/cf/credhub_admin_client_secret # your path might be different, e.g. \"/bosh/TAS/credhub_admin_client_secret\" id: 1b238b69-72ac-4a73-a124-b67da71da572 name: /bosh-vsphere/cf/credhub_admin_client_secret type: password value: XDBlXvmH7aN3IG2czVfzvitu5dTHIj version_created_at: \"2021-11-18T23:25:53Z\" Aha! Now in our cats-config.json, set \"credhub_secret\": \"XDBlXvmH7aN3IG2czVfzvitu5dTHIj\".\nBut we’re still not done: we need to create a security group that allows the apps to communicate with Cloud Foundry’s CredHub (separate \u0026 distinct from the BOSH Director’s CredHub) (yes, it’s confusing).\ncf create-security-group credhub \u003c(echo '[{\"protocol\":\"tcp\",\"destination\":\"10.0.0.0/8\",\"ports\":\"8443,8844\",\"description\":\"credhub\"}]') cf bind-running-security-group credhub cf bind-staging-security-group credhub Now let’s run our tests!\nbin/test -nodes=6 Troubleshooting Docker Failures [Fail] [docker] Docker Application Lifecycle running a docker app with a start command [BeforeEach] retains its start command through starts and stops /home/cunnie/workspace/cf-acceptance-tests/docker/docker_lifecycle.go:53 [Fail] [docker] Docker Application Lifecycle running a docker app without a start command [BeforeEach] handles docker-defined metadata and environment variables correctly /home/cunnie/workspace/cf-acceptance-tests/docker/docker_lifecycle.go:80 [Fail] [docker] Docker Application Lifecycle running a docker app without a start command [BeforeEach] when env vars are set with 'cf set-env' prefers the env vars from cf set-env over those in the Dockerfile /home/cunnie/workspace/cf-acceptance-tests/docker/docker_lifecycle.go:80 Means you’ve forgotten to cf enable-feature-flag diego_docker.\nTroubleshoot Service Binding Failures (CredHub) [Fail] [credhub] service bindings during staging [BeforeEach] [assisted credhub] has CredHub references in VCAP_SERVICES interpolated /home/cunnie/workspace/cf-acceptance-tests/credhub/service_bindings.go:123 [Fail] [credhub] service bindings during staging [BeforeEach] [non-assisted credhub] still contains CredHub references in VCAP_SERVICES /home/cunnie/workspace/cf-acceptance-tests/credhub/service_bindings.go:123 [Fail] [credhub] service bindings during runtime service bindings to credhub enabled broker [assisted credhub] [BeforeEach] the broker returns credhub-ref in the credentials block /home/cunnie/workspace/cf-acceptance-tests/credhub/service_bindings.go:123 [Fail] [credhub] service bindings during runtime service bindings to credhub enabled broker [assisted credhub] [BeforeEach] the bound app gets CredHub refs in VCAP_SERVICES interpolated /home/cunnie/workspace/cf-acceptance-tests/credhub/service_bindings.go:123 Means you’ve either set the wrong credhub_secret in cats-config.json or you forgot to create \u0026 bind the credhub security group.\n","wordCount":"550","inLanguage":"en","datePublished":"2022-07-04T12:46:03-07:00","dateModified":"2022-07-04T12:46:03-07:00","author":{"@type":"Person","name":"Brian Cunnie"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.nono.io/post/underground_guide_to_cf_acceptance/"},"publisher":{"@type":"Organization","name":"Brian Cunnie's Technical Blog","logo":{"@type":"ImageObject","url":"https://blog.nono.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://blog.nono.io/ accesskey=h title="Brian Cunnie's Technical Blog (Alt + H)">Brian Cunnie's Technical Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.nono.io/>Home</a>&nbsp;»&nbsp;<a href=https://blog.nono.io/post/>Posts</a></div><h1 class=post-title>The Underground Guide to Cloud Foundry Acceptance Tests</h1><div class=post-meta>July 4, 2022&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Brian Cunnie&nbsp;|&nbsp;<a href=https://github.com/cunnie/cunnie.github.io/tree/master/content/post/underground_guide_to_cf_acceptance.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><figure><img loading=lazy src=https://user-images.githubusercontent.com/1020675/177218158-146d64ab-80fd-45e7-b116-fdff2da22620.png alt="Cloud Foundry logo"></figure><p>The <a href=https://github.com/cloudfoundry/cf-acceptance-tests>Cloud Foundry Acceptance
Tests</a> are the gold
standard to test the proper functioning of your Cloud Foundry deployment. This
guide tells you how to run them. When in doubt, refer to the
<a href=https://github.com/cloudfoundry/cf-acceptance-tests>README</a>.</p><h4 id=quick-start>Quick Start<a hidden class=anchor aria-hidden=true href=#quick-start>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd ~/workspace/
</span></span><span style=display:flex><span>git clone git@github.com:cloudfoundry/cf-acceptance-tests.git
</span></span><span style=display:flex><span>cd cf-acceptance-tests
</span></span><span style=display:flex><span>. ./.envrc
</span></span><span style=display:flex><span>bin/update_submodules
</span></span><span style=display:flex><span>cp example-cats-config.json cats-config.json
</span></span><span style=display:flex><span>export CONFIG<span style=color:#f92672>=</span>cats-config.json
</span></span><span style=display:flex><span>cf api api.cf.nono.io <span style=color:#75715e># or whatever your Cloud Foundry&#39;s API endpoint is</span>
</span></span><span style=display:flex><span>cf login -u admin
</span></span><span style=display:flex><span>cf create-space -o system system <span style=color:#75715e># don&#39;t worry if it&#39;s already created</span>
</span></span><span style=display:flex><span>cf t -o system -s system
</span></span><span style=display:flex><span>cf enable-feature-flag diego_docker <span style=color:#75715e># necessary if you&#39;re running the Docker tests (`&#34;include_docker&#34;: true`)</span>
</span></span></code></pre></div><p>Let&rsquo;s configure our <code>cats-config.json</code>. You should know the values for all the
replacements except <code>credhub_secret</code>; we&rsquo;ll explain how to get that next:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span><span style=color:#f92672>-IN DEVELOPMENT
</span></span></span><span style=display:flex><span><span style=color:#f92672></span> {
</span></span><span style=display:flex><span><span style=color:#f92672>-  &#34;api&#34;: &#34;api.DOMAIN.com&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f92672>-  &#34;apps_domain&#34;: &#34;DOMAIN.com&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+  &#34;api&#34;: &#34;api.cf.nono.io&#34;,
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+  &#34;apps_domain&#34;: &#34;foundry.fun&#34;,
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>   &#34;admin_user&#34;: &#34;admin&#34;,
</span></span><span style=display:flex><span><span style=color:#f92672>-  &#34;admin_password&#34;: &#34;PASSWORD&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+  &#34;admin_password&#34;: &#34;MySecretAdminPassword&#34;,
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>   &#34;credhub_mode&#34;: &#34;assisted&#34;,
</span></span><span style=display:flex><span><span style=color:#f92672>-  &#34;credhub_client&#34;: &#34;CREDHUB_CLIENT&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f92672>-  &#34;credhub_secret&#34;: &#34;CREDHUB_SECRET&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+  &#34;credhub_client&#34;: &#34;credhub_admin_client&#34;,
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+  &#34;credhub_secret&#34;: &#34;XDBlXvmH7aN3IG2czVfzvitu5dTHIj&#34;,
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>   &#34;artifacts_directory&#34;: &#34;logs&#34;,
</span></span><span style=display:flex><span>   &#34;skip_ssl_validation&#34;: true,
</span></span><span style=display:flex><span>   &#34;timeout_scale&#34;: 1,
</span></span></code></pre></div><p>By default you&rsquo;re running the CredHub tests, so you need <code>credhub_secret</code>, but
getting it is a multi-step affair. First, get the credentials to communicate
with the BOSH Director&rsquo;s CredHub:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bosh int --path /instance_groups/name<span style=color:#f92672>=</span>bosh/jobs/name<span style=color:#f92672>=</span>uaa/properties/uaa/scim/users/name<span style=color:#f92672>=</span>credhub_cli_user bosh-vsphere.yml
</span></span></code></pre></div><p><em>[where <code>bosh-vsphere.yml</code> is your BOSH Director&rsquo;s manifest]</em></p><p>The output should look something like the following:</p><pre tabindex=0><code>groups:
- credhub.read
- credhub.write
name: credhub_cli_user
password: SomeKrazyPassword
</code></pre><p>Now that we have the password (&ldquo;SomeKrazyPassword&rdquo;), let&rsquo;s authenticate to the
BOSH Director&rsquo;s CredHub using the <a href=https://github.com/cloudfoundry/credhub-cli>CredHub
CLI</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>credhub api bosh-vsphere.nono.io:8844 --skip-tls-validation <span style=color:#75715e># assuming your BOSH Director&#39;s hostname is &#34;bosh-vsphere.nono.io&#34;</span>
</span></span><span style=display:flex><span>credhub login --username<span style=color:#f92672>=</span>credhub_cli_user --password<span style=color:#f92672>=</span>SomeKrazyPassword
</span></span><span style=display:flex><span>credhub find -n / <span style=color:#75715e># we don&#39;t need this, but it gives us a complete list of creds</span>
</span></span><span style=display:flex><span>credhub get -n /bosh-vsphere/cf/credhub_admin_client_secret <span style=color:#75715e># your path might be different, e.g. &#34;/bosh/TAS/credhub_admin_client_secret&#34;</span>
</span></span><span style=display:flex><span>  id: 1b238b69-72ac-4a73-a124-b67da71da572
</span></span><span style=display:flex><span>  name: /bosh-vsphere/cf/credhub_admin_client_secret
</span></span><span style=display:flex><span>  type: password
</span></span><span style=display:flex><span>  value: XDBlXvmH7aN3IG2czVfzvitu5dTHIj
</span></span><span style=display:flex><span>  version_created_at: <span style=color:#e6db74>&#34;2021-11-18T23:25:53Z&#34;</span>
</span></span></code></pre></div><p>Aha! Now in our <code>cats-config.json</code>, set <code>"credhub_secret": "XDBlXvmH7aN3IG2czVfzvitu5dTHIj"</code>.</p><p>But we&rsquo;re still not done: we need to create a security group that allows the
apps to communicate with Cloud Foundry&rsquo;s CredHub (separate & distinct from the
BOSH Director&rsquo;s CredHub) (yes, it&rsquo;s confusing).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cf create-security-group credhub &lt;<span style=color:#f92672>(</span>echo <span style=color:#e6db74>&#39;[{&#34;protocol&#34;:&#34;tcp&#34;,&#34;destination&#34;:&#34;10.0.0.0/8&#34;,&#34;ports&#34;:&#34;8443,8844&#34;,&#34;description&#34;:&#34;credhub&#34;}]&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>cf bind-running-security-group credhub
</span></span><span style=display:flex><span>cf bind-staging-security-group credhub
</span></span></code></pre></div><p>Now let&rsquo;s run our tests!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/test -nodes<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span>
</span></span></code></pre></div><h4 id=troubleshooting-docker-failures>Troubleshooting Docker Failures<a hidden class=anchor aria-hidden=true href=#troubleshooting-docker-failures>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[Fail] [docker] Docker Application Lifecycle running a docker app with a start command [BeforeEach] retains its start command through starts and stops
</span></span><span style=display:flex><span>/home/cunnie/workspace/cf-acceptance-tests/docker/docker_lifecycle.go:53
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[Fail] [docker] Docker Application Lifecycle running a docker app without a start command [BeforeEach] handles docker-defined metadata and environment variables correctly
</span></span><span style=display:flex><span>/home/cunnie/workspace/cf-acceptance-tests/docker/docker_lifecycle.go:80
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[Fail] [docker] Docker Application Lifecycle running a docker app without a start command [BeforeEach] when env vars are set with &#39;cf set-env&#39; prefers the env vars from cf set-env over those in the Dockerfile
</span></span><span style=display:flex><span>/home/cunnie/workspace/cf-acceptance-tests/docker/docker_lifecycle.go:80
</span></span></code></pre></div><p>Means you&rsquo;ve forgotten to <code>cf enable-feature-flag diego_docker</code>.</p><h4 id=troubleshoot-service-binding-failures-credhub>Troubleshoot Service Binding Failures (CredHub)<a hidden class=anchor aria-hidden=true href=#troubleshoot-service-binding-failures-credhub>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[Fail] [credhub] service bindings during staging [BeforeEach] [assisted credhub]  has CredHub references in VCAP_SERVICES interpolated
</span></span><span style=display:flex><span>/home/cunnie/workspace/cf-acceptance-tests/credhub/service_bindings.go:123
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[Fail] [credhub] service bindings during staging [BeforeEach] [non-assisted credhub]  still contains CredHub references in VCAP_SERVICES
</span></span><span style=display:flex><span>/home/cunnie/workspace/cf-acceptance-tests/credhub/service_bindings.go:123
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[Fail] [credhub] service bindings during runtime service bindings to credhub enabled broker [assisted credhub]  [BeforeEach] the broker returns credhub-ref in the credentials block
</span></span><span style=display:flex><span>/home/cunnie/workspace/cf-acceptance-tests/credhub/service_bindings.go:123
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[Fail] [credhub] service bindings during runtime service bindings to credhub enabled broker [assisted credhub]  [BeforeEach] the bound app gets CredHub refs in VCAP_SERVICES interpolated
</span></span><span style=display:flex><span>/home/cunnie/workspace/cf-acceptance-tests/credhub/service_bindings.go:123
</span></span></code></pre></div><p>Means you&rsquo;ve either set the wrong <code>credhub_secret</code> in <code>cats-config.json</code> or you forgot to create & bind the <code>credhub</code> security group.</p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://blog.nono.io/post/tuning_haproxy/><span class=title>« Prev Page</span><br><span>Tuning HAProxy in a vSphere Environment</span></a>
<a class=next href=https://blog.nono.io/post/concourse_on_k8s-6/><span class=title>Next Page »</span><br><span>Concourse CI on Kubernetes (GKE), Part 6: Concourse & Vault: Backup & Restore</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share The Underground Guide to Cloud Foundry Acceptance Tests on twitter" href="https://twitter.com/intent/tweet/?text=The%20Underground%20Guide%20to%20Cloud%20Foundry%20Acceptance%20Tests&url=https%3a%2f%2fblog.nono.io%2fpost%2funderground_guide_to_cf_acceptance%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share The Underground Guide to Cloud Foundry Acceptance Tests on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.nono.io%2fpost%2funderground_guide_to_cf_acceptance%2f&title=The%20Underground%20Guide%20to%20Cloud%20Foundry%20Acceptance%20Tests&summary=The%20Underground%20Guide%20to%20Cloud%20Foundry%20Acceptance%20Tests&source=https%3a%2f%2fblog.nono.io%2fpost%2funderground_guide_to_cf_acceptance%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share The Underground Guide to Cloud Foundry Acceptance Tests on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.nono.io%2fpost%2funderground_guide_to_cf_acceptance%2f&title=The%20Underground%20Guide%20to%20Cloud%20Foundry%20Acceptance%20Tests"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share The Underground Guide to Cloud Foundry Acceptance Tests on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.nono.io%2fpost%2funderground_guide_to_cf_acceptance%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share The Underground Guide to Cloud Foundry Acceptance Tests on whatsapp" href="https://api.whatsapp.com/send?text=The%20Underground%20Guide%20to%20Cloud%20Foundry%20Acceptance%20Tests%20-%20https%3a%2f%2fblog.nono.io%2fpost%2funderground_guide_to_cf_acceptance%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share The Underground Guide to Cloud Foundry Acceptance Tests on telegram" href="https://telegram.me/share/url?text=The%20Underground%20Guide%20to%20Cloud%20Foundry%20Acceptance%20Tests&url=https%3a%2f%2fblog.nono.io%2fpost%2funderground_guide_to_cf_acceptance%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://blog.nono.io/>Brian Cunnie's Technical Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>