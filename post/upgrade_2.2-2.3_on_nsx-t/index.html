<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Safely Upgrading PAS 2.2 with NSX-T Load Balancers | Brian Cunnie's Technical Blog</title><meta name=keywords content><meta name=description content="When customers with vSphere+NSX-T-based foundations apply a stemcell update, update a tile, or upgrade PAS (Pivotal Application Service) from 2.2 to 2.3, their Cloud Foundry may become unreachable as their NSX-T static load balancer server pools have been emptied.
This blog post describes a method to ensure availability during upgrades. We use a combination of customized Operations Manager resource configs and BOSH VM Extensions.
The sample workflow in this post is for upgrading PAS 2."><meta name=author content="Brian Cunnie"><link rel=canonical href=https://blog.nono.io/post/upgrade_2.2-2.3_on_nsx-t/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.nono.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.nono.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.nono.io/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.nono.io/apple-touch-icon.png><link rel=mask-icon href=https://blog.nono.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-0NJ11E527T"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0NJ11E527T",{anonymize_ip:!1})}</script><meta property="og:title" content="Safely Upgrading PAS 2.2 with NSX-T Load Balancers"><meta property="og:description" content="When customers with vSphere+NSX-T-based foundations apply a stemcell update, update a tile, or upgrade PAS (Pivotal Application Service) from 2.2 to 2.3, their Cloud Foundry may become unreachable as their NSX-T static load balancer server pools have been emptied.
This blog post describes a method to ensure availability during upgrades. We use a combination of customized Operations Manager resource configs and BOSH VM Extensions.
The sample workflow in this post is for upgrading PAS 2."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.nono.io/post/upgrade_2.2-2.3_on_nsx-t/"><meta property="og:image" content="https://nono.io/images/brian_cunnie_profile.jpg"><meta property="article:section" content="post"><meta property="article:published_time" content="2018-09-06T10:44:30+00:00"><meta property="article:modified_time" content="2018-09-06T10:44:30+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nono.io/images/brian_cunnie_profile.jpg"><meta name=twitter:title content="Safely Upgrading PAS 2.2 with NSX-T Load Balancers"><meta name=twitter:description content="When customers with vSphere+NSX-T-based foundations apply a stemcell update, update a tile, or upgrade PAS (Pivotal Application Service) from 2.2 to 2.3, their Cloud Foundry may become unreachable as their NSX-T static load balancer server pools have been emptied.
This blog post describes a method to ensure availability during upgrades. We use a combination of customized Operations Manager resource configs and BOSH VM Extensions.
The sample workflow in this post is for upgrading PAS 2."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.nono.io/post/"},{"@type":"ListItem","position":2,"name":"Safely Upgrading PAS 2.2 with NSX-T Load Balancers","item":"https://blog.nono.io/post/upgrade_2.2-2.3_on_nsx-t/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Safely Upgrading PAS 2.2 with NSX-T Load Balancers","name":"Safely Upgrading PAS 2.2 with NSX-T Load Balancers","description":"When customers with vSphere+NSX-T-based foundations apply a stemcell update, update a tile, or upgrade PAS (Pivotal Application Service) from 2.2 to 2.3, their Cloud Foundry may become unreachable as their NSX-T static load balancer server pools have been emptied.\nThis blog post describes a method to ensure availability during upgrades. We use a combination of customized Operations Manager resource configs and BOSH VM Extensions.\nThe sample workflow in this post is for upgrading PAS 2.","keywords":[],"articleBody":"When customers with vSphere+NSX-T-based foundations apply a stemcell update, update a tile, or upgrade PAS (Pivotal Application Service) from 2.2 to 2.3, their Cloud Foundry may become unreachable as their NSX-T static load balancer server pools have been emptied.\nThis blog post describes a method to ensure availability during upgrades. We use a combination of customized Operations Manager resource configs and BOSH VM Extensions.\nThe sample workflow in this post is for upgrading PAS 2.2 to PAS 2.3 with an Operations Manager upgrade; however, it can also be adapted to stemcell or tile upgrades as well.\nOperations Manager 2.3 introduces the capability to manage the full lifecycle of the membership of the NSX-T load balancer pools, which relieves customers of the responsibility of manually assigning VMs to server pools. This allows uninterrupted availability of the BOSH instance group VMs that use NSX-T load balancers even during upgrades, re-deploys, and IP address re-assignment.\nTo enable these features without downtime for deployments using Operations Manager 2.2, one must migrate membership from out-of-band VM assignment to BOSH-managed assignment prior to upgrading to Operations Manager 2.3. This blog post describes that migration process.\n0. Procedure Review manually-created static [or Dynamic] NSX-T Load Balancer Server Pools Craft BOSH VM Extensions Craft Operations Manager resource configs Upgrade Operations Manager to version 2.3 Stage VM extensions with the Operations Manager API Prepare to upgrade Pivotal Application Service to 2.3.0 Stage new resource configs with the Operations Manager API Apply changes (deploy) 1. Review Manually-Created Static NSX-T Load Balancer Server Pools We log into our NSX Manager to review the Server Pool configuration of our Static Load Balancers:\nYou may not have four pools; it’s possible you may only have one. In that case, adapt the instructions below to the number of load balancer server pools you have.\nFor example, you may not have a TCP Router server pool if you don’t use the TCP routing feature of PAS.\nIn the table below, we describe the purpose of each of the load balancer server pools. The most important load balancers are the first two; they allow HTTP(S) access to our applications. The “Job” column is the name of the job that is load balanced by this server pool; they can be viewed in the Pivotal Application Service “Status” page in Operations Manager. The “BOSH instance group” column is the name of the instance group for this job within BOSH.\nServer Pool Description Port Job BOSH instance group PAS-GoRouter443ServerPool HTTPS access to cf apps 443 Router router PAS-GoRouter80ServerPool HTTP access to cf apps 80 Router router PAS-SSHProxyServerPool cf ssh 2222 Diego Brain diego_brain PAS-TCPRouterServerPool TCP access to non-HTTP(S) cf apps (optional) * TCP Router tcp_router * - the TCP router server pool uses a port range, e.g. 1024-1124, and does not load balance a single port.\nWe double-check to make sure the IP addresses of the VMs backing each server pool correspond to the IP addresses of the jobs. For example, we check the IP addresses backing the PAS-GoRouter443ServerPool server pool:\nWe cross-reference those IP addresses to the IPs of the Router VMs in our foundation:\nWe cross-reference all server pools.\n2. Craft BOSH VM Extensions For each BOSH instance group, we prepare a JSON file describing a VM extension that will be applied to that instance group.\nHere is an example of the VM extension configuration for the Router job:\n{ \"cloud_properties\": { \"nsxt\": { \"lb\": { \"server_pools\": [ { \"name\": \"PAS-GoRouter443ServerPool\", \"port\": 443 }, { \"name\": \"PAS-GoRouter80ServerPool\", \"port\": 80 } ] } } }, \"name\": \"http_https_lb\" } The server_pools array should contain a list of JSON objects with the name of the NSX-T load balancer server pool, and where applicable, a port. When configuring load balancers that use a port range, such as the TCP router load balancer, the port should be omitted.\nThe name (e.g. http_https_lb) is arbitrary but must match the name used in the the resource config in the following section.\nIn our case, we create 3 VM extensions: router_vm-extension.json, diego_brain_vm-extension.json, tcp_router_vm-extension.json.\n3. Craft Operations Manager resource configs For each BOSH instance group, we prepare a JSON (JavaScript Object Notation) file describing the resource config that BOSH will use when redeploying the instance group during the upgrade.\n3.0 Authenticate To Use the Operations Manager API We authenticate in order to obtain our UAA access token.\nFOUNDATION_URL= # your ops manager URL goes here, e.g. https://pcf.example.com UAA_ACCESS_TOKEN= # your token goes here, a very long string. Very long. 3.1 Determine the GUID of the PAS Foundation We use the Operations Manager API to determine the GUID of the PAS foundation:\ncurl \"$FOUNDATION_URL/api/v0/staged/products\" -H \"Authorization: Bearer $UAA_ACCESS_TOKEN\" This will return a long string of JSON. We’re looking for this part: [..., {\"installation_name\":\"some-guid\",\"guid\":\"some-guid\",\"type\":\"cf\",\"product_version\":\"2.2.2\"}, ...]. This is our guid: cf-ebd5ce1f7b11714cbb94.\n3.2 Determine the GUID of the Jobs That Belong in Server Pools CF_GUID= # the GUID we got from the previous step curl \"$FOUNDATION_URL/api/v0/staged/products/$CF_GUID/jobs\" -H \"Authorization: Bearer $UAA_ACCESS_TOKEN\" This also returns a long string of JSON. We want to find the GUIDs for the jobs (BOSH instance groups) router, diego_brain, and tcp_router (the corresponding GUIDs in our foundation are router-1a40bb1433cd790d3920, diego_brain-247c1f4a616b5d43546e, and tcp_router-93c7a99605c109f53f8c).\nIf you have jq installed, you may use the following command to isolate the important components: jq -r '.jobs[] | select(.name==\"router\" or .name==\"diego_brain\" or .name==\"tcp_router\")'.\n3.3 Get Existing Resource Configs Attached to the Jobs We run the following command for the GUID of each job we’re interested in:\ncurl \"$FOUNDATION_URL/api/v0/staged/products/$CF_GUID/jobs/$JOB_GUID/resource_config\" -H \"Authorization: Bearer $UAA_ACCESS_TOKEN\" \u003e $JOB_NAME-resource-config.json Where CF_GUID is set to the GUID from step 3.1, JOB_GUID is set to the GUID from step 3.2, and JOB_NAME is set to the name of the BOSH instance group for this job.\nThis produces a result like {\"instance_type\":{\"id\":\"automatic\"},\"instances\":2,\"nsx_security_groups\":null,\"nsx_lbs\":[],\"additional_vm_extensions\":[]}.\n3.4 Write New Resource Configs For Each Job Edit each file from the previous step to add the name of the corresponding load balancer (see table in step 1), in quotes, to the additional_vm_extensions array. [Resource Config]\nWe do this once for each load-balanced job (router, diego_brain, and tcp_router).\n4. Upgrade Operations Manager to Version 2.3 Following the steps in the Upgrading Pivotal Cloud Foundry documentation, we upgrade Operations Manager to version 2.3.\nDo not follow steps to upgrade the PAS tile at this time.\nIf you are using the VMware NSX-T tile, and it is version 2.2 or earlier, you should now stage version 2.3 of that tile.\nDo not press “Apply Changes” during this step.\n5. Stage VM Extensions with the Operations Manager API For each VM extension JSON file we wrote in step 2, we run the following curl command:\ncurl \"$FOUNDATION_URL/api/v0/staged/vm_extensions\" -X POST -H \"Authorization: Bearer $UAA_ACCESS_TOKEN\" -d \"@${VM_EXTENSION_FILE}\" -H \"Content-Type: application/json\" Where ${VM_EXTENSION_FILE} is the path to the file. We expect to see an HTTP status 200 and an empty JSON object {} returned for each call.\n6. Stage Pivotal Application Service Tile Version 2.3.0 Following the steps in the Upgrading Pivotal Cloud Foundry documentation, we stage PAS tile version 2.3.0.\nDo not press “Apply Changes” during this step.\n7. Stage New Resource Configs with the Operations Manager API For each resource config JSON file we wrote in step 3.4, we run the following curl command:\ncurl \"$FOUNDATION_URL/api/v0/staged/products/${CF_GUID}/jobs/${JOB_GUID}/resource_config\" -X PUT -H \"Authorization: Bearer $UAA_ACCESS_TOKEN\" -d \"@${RESOURCE_CONFIG_FILE}\" -H \"Content-Type: application/json\" Where ${RESOURCE_CONFIG_FILE} is the path to the file. We expect to see an HTTP status 200 and an empty JSON object {} returned for each call.\n8. Apply Changes (Deploy) Press “Review Pending Changes” in the Operations Manager 2.3 UI, then press “Apply Changes”.\nAt the end of this step, you will have a PAS 2.3.0 foundation, with networking optionally provided by VMware NSX-T tile 2.3.0, where each job VM is located in the appropriate NSX-T load balancer server pool.\n9. Gotchas An incident occurred where the NSX-T load balancer was unable to forward traffic to the newly-deployed gorouters.\nRebooting one of the NSX-T Edges restored the flow of traffic from the NSX-T load balancer to the gorouters. We are unsure of the root cause; however, since existing load balancer pools continued to function, we suspect the Edge had become incapable of honoring updates.\n10. Troubleshooting We find the Traceflow (Tools → Traceflow) networking tool invaluable when debugging network failures. In the screenshot below, we examine the gorouter/0 VM’s ability to communicate with the load balancer (IP address 10.144.15.4) on port 443 (HTTPS). In this case, we determined the gorouter’s CID using the bosh vms command, but we could have just as easily determined it by looking it up on the Status page of the PAS tile on Operations Manager:\nReferences VM Extensions we used for our deployment:\nRouter Diego Brain TCP Router Our BASH commands we followed when we upgraded: script.\nAcknowledgements Josh Gray of the PEZ Team was instrumental in discovering the behavior and providing resources to test remediation. The BOSH vSphere CPI Team provided invaluable support.\nBryan Kelly of Cerner provided invaluable feedback, pointing out that this process is relevant not only to 2.2 → 2.3 upgrades but also to stemcell upgrades and tile upgrades.\nCorrections \u0026 Updates 2018-11-20\nAdded Gotchas and Troubleshooting sections after suggestions from Bryan Kelly.\nFootnotes [or Dynamic] This blog post focuses on static pools, but the procedure is identical for dynamic pools since the BOSH vSphere CPI “looks up the NSGroup [of the server pool] and adds the VM to the NSGroup”.\n[resource_config] In a prettified JSON file, our change would look like the following:\n{ \"instance_type\": { \"id\": \"automatic\" }, \"instances\": 2, \"nsx_security_groups\": null, \"nsx_lbs\": [], \"additional_vm_extensions\": [ + \"http_https_lb\" ] } ","wordCount":"1586","inLanguage":"en","datePublished":"2018-09-06T10:44:30Z","dateModified":"2018-09-06T10:44:30Z","author":{"@type":"Person","name":"Brian Cunnie"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.nono.io/post/upgrade_2.2-2.3_on_nsx-t/"},"publisher":{"@type":"Organization","name":"Brian Cunnie's Technical Blog","logo":{"@type":"ImageObject","url":"https://blog.nono.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.nono.io/ accesskey=h title="Brian Cunnie's Technical Blog (Alt + H)">Brian Cunnie's Technical Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.nono.io/>Home</a>&nbsp;»&nbsp;<a href=https://blog.nono.io/post/>Posts</a></div><h1 class=post-title>Safely Upgrading PAS 2.2 with NSX-T Load Balancers</h1><div class=post-meta><span title='2018-09-06 10:44:30 +0000 UTC'>September 6, 2018</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Brian Cunnie&nbsp;|&nbsp;<a href=https://github.com/cunnie/cunnie.github.io/tree/master/content/post/upgrade_2.2-2.3_on_nsx-t.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>When customers with vSphere+NSX-T-based foundations apply a stemcell update,
update a tile, or upgrade PAS (Pivotal Application Service) from 2.2 to 2.3,
their Cloud Foundry may become unreachable as their NSX-T static load balancer
server pools have been emptied.</p><p>This blog post describes a method to ensure availability during upgrades. We
use a combination of customized Operations Manager <a href=https://docs.pivotal.io/pivotalcf/2-2/customizing/config-er-vmware.html#resources>resource
configs</a>
and BOSH <a href=https://bosh.io/docs/terminology/#vm-extension>VM Extensions</a>.</p><p>The sample workflow in this post is for upgrading PAS 2.2 to PAS 2.3 with an
Operations Manager upgrade; however, it can also be adapted to stemcell or
tile upgrades as well.</p><p><em>Operations Manager 2.3 introduces the capability to manage the full lifecycle
of the membership of the NSX-T load balancer pools, which relieves customers of
the responsibility of manually assigning VMs to server pools. This allows
uninterrupted availability of the BOSH instance group VMs that use NSX-T load
balancers even during upgrades, re-deploys, and IP address re-assignment.</em></p><p><em>To enable these features without downtime for deployments using Operations
Manager 2.2, one must migrate membership from out-of-band VM assignment to
BOSH-managed assignment prior to upgrading to Operations Manager 2.3. This blog
post describes that migration process.</em></p><h2 id=0-procedure>0. Procedure<a hidden class=anchor aria-hidden=true href=#0-procedure>#</a></h2><ul><li>Review manually-created static <a href=#dynamic><sup>[or Dynamic]</sup></a> NSX-T Load Balancer Server Pools</li><li>Craft BOSH VM Extensions</li><li>Craft Operations Manager resource configs</li><li>Upgrade Operations Manager to version 2.3</li><li>Stage VM extensions with the Operations Manager API</li><li>Prepare to upgrade Pivotal Application Service to 2.3.0</li><li>Stage new resource configs with the Operations Manager API</li><li>Apply changes (deploy)</li></ul><h2 id=1-review-manually-created-static-nsx-t-load-balancer-server-pools>1. Review Manually-Created Static NSX-T Load Balancer Server Pools<a hidden class=anchor aria-hidden=true href=#1-review-manually-created-static-nsx-t-load-balancer-server-pools>#</a></h2><p>We log into our NSX Manager to review the Server Pool configuration of our Static Load Balancers:</p><figure><img loading=lazy src=https://user-images.githubusercontent.com/1020675/45176304-68843000-b1c4-11e8-84ea-14011b80de79.png></figure><div class="alert alert-warning" role=alert><p>You may not have four pools; it&rsquo;s possible you may only have one. In that case,
adapt the instructions below to the number of load balancer server pools you have.<br><br></p><p>For example, you may not have a TCP Router server pool if you don&rsquo;t use the TCP
routing feature of PAS.</p></div><p>In the table below, we describe the purpose of each of the load balancer server
pools. The most important load balancers are the first two; they allow HTTP(S)
access to our applications. The &ldquo;Job&rdquo; column is the name of the job that is
load balanced by this server pool; they can be viewed in the Pivotal Application
Service &ldquo;Status&rdquo; page in Operations Manager. The &ldquo;BOSH instance group&rdquo; column is
the name of the instance group for this job within BOSH.</p><table><thead><tr><th>Server Pool</th><th>Description</th><th>Port</th><th>Job</th><th>BOSH instance group</th></tr></thead><tbody><tr><td>PAS-GoRouter443ServerPool</td><td>HTTPS access to cf apps</td><td>443</td><td>Router</td><td><code>router</code></td></tr><tr><td>PAS-GoRouter80ServerPool</td><td>HTTP access to cf apps</td><td>80</td><td>Router</td><td><code>router</code></td></tr><tr><td>PAS-SSHProxyServerPool</td><td><code>cf ssh</code></td><td>2222</td><td>Diego Brain</td><td><code>diego_brain</code></td></tr><tr><td>PAS-TCPRouterServerPool</td><td>TCP access to non-HTTP(S) cf apps (optional)</td><td>*</td><td>TCP Router</td><td><code>tcp_router</code></td></tr></tbody></table><p>* - the TCP router server pool uses a port range, e.g. 1024-1124, and does not load balance a single port.</p><p>We double-check to make sure the IP addresses of the VMs backing each
server pool correspond to the IP addresses of the jobs. For example, we check
the IP addresses backing the <strong>PAS-GoRouter443ServerPool</strong> server pool:</p><figure><img loading=lazy src=https://user-images.githubusercontent.com/1020675/45178047-8902b900-b1c9-11e8-9fbc-cfd28a055078.png></figure><p>We cross-reference those IP addresses to the IPs of the Router VMs in our foundation:</p><figure><img loading=lazy src=https://user-images.githubusercontent.com/1020675/45177840-eea27580-b1c8-11e8-9b00-98e720550c6a.png></figure><p>We cross-reference all server pools.</p><h2 id=2-craft-bosh-vm-extensions>2. Craft BOSH VM Extensions<a hidden class=anchor aria-hidden=true href=#2-craft-bosh-vm-extensions>#</a></h2><p>For each BOSH instance group, we prepare a JSON file describing a VM extension
that will be applied to that instance group.</p><p>Here is an example of the VM extension configuration for the Router job:</p><pre tabindex=0><code>{
  &#34;cloud_properties&#34;: {
    &#34;nsxt&#34;: {
      &#34;lb&#34;: {
        &#34;server_pools&#34;: [
          {
            &#34;name&#34;: &#34;PAS-GoRouter443ServerPool&#34;,
            &#34;port&#34;: 443
          },
          {
            &#34;name&#34;: &#34;PAS-GoRouter80ServerPool&#34;,
            &#34;port&#34;: 80
          }
        ]
      }
    }
  },
  &#34;name&#34;: &#34;http_https_lb&#34;
}
</code></pre><p>The <code>server_pools</code> array should contain a list of JSON objects with the name of
the NSX-T load balancer server pool, and where applicable, a port. When
configuring load balancers that use a port range, such as the TCP router load
balancer, the port should be omitted.</p><p>The <code>name</code> (e.g. <code>http_https_lb</code>) is arbitrary but must match the <code>name</code> used
in the the resource config in the following section.</p><p>In our case, we create 3 VM extensions: <code>router_vm-extension.json</code>,
<code>diego_brain_vm-extension.json</code>, <code>tcp_router_vm-extension.json</code>.</p><h2 id=3-craft-operations-manager-resource-configs>3. Craft Operations Manager resource configs<a hidden class=anchor aria-hidden=true href=#3-craft-operations-manager-resource-configs>#</a></h2><p>For each BOSH instance group, we prepare a JSON (JavaScript Object Notation)
file describing the resource config that BOSH will use when redeploying the
instance group during the upgrade.</p><h3 id=30-authenticate-to-use-the-operations-manager-api>3.0 Authenticate To Use the Operations Manager API<a hidden class=anchor aria-hidden=true href=#30-authenticate-to-use-the-operations-manager-api>#</a></h3><p>We <a href=http://docs.pivotal.io/pivotalcf/2-3/opsman-api/#authentication>authenticate</a>
in order to obtain our UAA access token.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>FOUNDATION_URL<span style=color:#f92672>=</span> <span style=color:#75715e># your ops manager URL goes here, e.g. https://pcf.example.com</span>
</span></span><span style=display:flex><span>UAA_ACCESS_TOKEN<span style=color:#f92672>=</span> <span style=color:#75715e># your token goes here, a very long string. Very long.</span>
</span></span></code></pre></div><h3 id=31-determine-the-guid-of-the-pas-foundation>3.1 Determine the GUID of the PAS Foundation<a hidden class=anchor aria-hidden=true href=#31-determine-the-guid-of-the-pas-foundation>#</a></h3><p>We use the Operations Manager API to determine the GUID of the PAS foundation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl <span style=color:#e6db74>&#34;</span>$FOUNDATION_URL<span style=color:#e6db74>/api/v0/staged/products&#34;</span> -H <span style=color:#e6db74>&#34;Authorization: Bearer </span>$UAA_ACCESS_TOKEN<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p>This will return a long string of JSON. We&rsquo;re looking for this part:
<code>[..., {"installation_name":"some-guid","guid":"some-guid","type":"cf","product_version":"2.2.2"}, ...]</code>.
This is our <code>guid</code>: <code>cf-ebd5ce1f7b11714cbb94</code>.</p><h3 id=32-determine-the-guid-of-the-jobs-that-belong-in-server-pools>3.2 Determine the GUID of the Jobs That Belong in Server Pools<a hidden class=anchor aria-hidden=true href=#32-determine-the-guid-of-the-jobs-that-belong-in-server-pools>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>CF_GUID<span style=color:#f92672>=</span> <span style=color:#75715e># the GUID we got from the previous step</span>
</span></span><span style=display:flex><span>curl <span style=color:#e6db74>&#34;</span>$FOUNDATION_URL<span style=color:#e6db74>/api/v0/staged/products/</span>$CF_GUID<span style=color:#e6db74>/jobs&#34;</span> -H <span style=color:#e6db74>&#34;Authorization: Bearer </span>$UAA_ACCESS_TOKEN<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p>This also returns a long string of JSON. We want to find the GUIDs for the jobs
(BOSH instance groups) <code>router</code>, <code>diego_brain</code>, and <code>tcp_router</code> (the
corresponding GUIDs in our foundation are <code>router-1a40bb1433cd790d3920</code>,
<code>diego_brain-247c1f4a616b5d43546e</code>, and <code>tcp_router-93c7a99605c109f53f8c</code>).</p><p>If you have <code>jq</code> installed,
you may use the following command to isolate the important components:
<code>jq -r '.jobs[] | select(.name=="router" or .name=="diego_brain" or .name=="tcp_router")'</code>.</p><h3 id=33-get-existing-resource-configs-attached-to-the-jobs>3.3 Get Existing Resource Configs Attached to the Jobs<a hidden class=anchor aria-hidden=true href=#33-get-existing-resource-configs-attached-to-the-jobs>#</a></h3><p>We run the following command for the GUID of each job we&rsquo;re interested in:</p><pre tabindex=0><code>curl &#34;$FOUNDATION_URL/api/v0/staged/products/$CF_GUID/jobs/$JOB_GUID/resource_config&#34; -H &#34;Authorization: Bearer $UAA_ACCESS_TOKEN&#34; &gt; $JOB_NAME-resource-config.json
</code></pre><p>Where <code>CF_GUID</code> is set to the GUID from step 3.1, <code>JOB_GUID</code> is set to the GUID
from step 3.2, and <code>JOB_NAME</code> is set to the name of the BOSH instance group for
this job.</p><p>This produces a result like <code>{"instance_type":{"id":"automatic"},"instances":2,"nsx_security_groups":null,"nsx_lbs":[],"additional_vm_extensions":[]}</code>.</p><h3 id=34-write-new-resource-configs-for-each-job>3.4 Write New Resource Configs For Each Job<a hidden class=anchor aria-hidden=true href=#34-write-new-resource-configs-for-each-job>#</a></h3><p>Edit each file from the previous step to add the name of the corresponding load
balancer (see table in step 1), in quotes, to the <code>additional_vm_extensions</code>
array. <a href=#resource_config><sup>[Resource Config]</sup></a></p><p>We do this once for each load-balanced job (<code>router</code>, <code>diego_brain</code>, and <code>tcp_router</code>).</p><h2 id=4-upgrade-operations-manager-to-version-23>4. Upgrade Operations Manager to Version 2.3<a hidden class=anchor aria-hidden=true href=#4-upgrade-operations-manager-to-version-23>#</a></h2><p>Following the steps in the <a href=https://docs.pivotal.io/pivotalcf/2-2/customizing/upgrading-pcf.html>Upgrading Pivotal Cloud Foundry</a>
documentation, we upgrade Operations Manager to version 2.3.</p><p><em><strong>Do not</strong></em> follow steps to upgrade the PAS tile at this time.</p><p>If you are using the VMware NSX-T tile, and it is version 2.2 or earlier, you should now stage version 2.3 of that tile.</p><p><em><strong>Do not</strong></em> press &ldquo;Apply Changes&rdquo; during this step.</p><h2 id=5-stage-vm-extensions-with-the-operations-manager-api>5. Stage VM Extensions with the Operations Manager API<a hidden class=anchor aria-hidden=true href=#5-stage-vm-extensions-with-the-operations-manager-api>#</a></h2><p>For each VM extension JSON file we wrote in step 2, we run the following <code>curl</code> command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl <span style=color:#e6db74>&#34;</span>$FOUNDATION_URL<span style=color:#e6db74>/api/v0/staged/vm_extensions&#34;</span> -X POST -H <span style=color:#e6db74>&#34;Authorization: Bearer </span>$UAA_ACCESS_TOKEN<span style=color:#e6db74>&#34;</span> -d <span style=color:#e6db74>&#34;@</span><span style=color:#e6db74>${</span>VM_EXTENSION_FILE<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span>
</span></span></code></pre></div><p>Where <code>${VM_EXTENSION_FILE}</code> is the path to the file. We expect to see an HTTP status 200 and an empty JSON object <code>{}</code> returned for each call.</p><h2 id=6-stage-pivotal-application-service-tile-version-230>6. Stage Pivotal Application Service Tile Version 2.3.0<a hidden class=anchor aria-hidden=true href=#6-stage-pivotal-application-service-tile-version-230>#</a></h2><p>Following the steps in the <a href=https://docs.pivotal.io/pivotalcf/2-2/customizing/upgrading-pcf.html>Upgrading Pivotal Cloud Foundry</a>
documentation, we stage PAS tile version 2.3.0.</p><p><em><strong>Do not</strong></em> press &ldquo;Apply Changes&rdquo; during this step.</p><h2 id=7-stage-new-resource-configs-with-the-operations-manager-api>7. Stage New Resource Configs with the Operations Manager API<a hidden class=anchor aria-hidden=true href=#7-stage-new-resource-configs-with-the-operations-manager-api>#</a></h2><p>For each resource config JSON file we wrote in step 3.4, we run the following <code>curl</code> command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl <span style=color:#e6db74>&#34;</span>$FOUNDATION_URL<span style=color:#e6db74>/api/v0/staged/products/</span><span style=color:#e6db74>${</span>CF_GUID<span style=color:#e6db74>}</span><span style=color:#e6db74>/jobs/</span><span style=color:#e6db74>${</span>JOB_GUID<span style=color:#e6db74>}</span><span style=color:#e6db74>/resource_config&#34;</span> -X PUT -H <span style=color:#e6db74>&#34;Authorization: Bearer </span>$UAA_ACCESS_TOKEN<span style=color:#e6db74>&#34;</span> -d <span style=color:#e6db74>&#34;@</span><span style=color:#e6db74>${</span>RESOURCE_CONFIG_FILE<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span>
</span></span></code></pre></div><p>Where <code>${RESOURCE_CONFIG_FILE}</code> is the path to the file. We expect to see an HTTP status 200 and an empty JSON object <code>{}</code> returned for each call.</p><h2 id=8-apply-changes-deploy>8. Apply Changes (Deploy)<a hidden class=anchor aria-hidden=true href=#8-apply-changes-deploy>#</a></h2><p>Press &ldquo;Review Pending Changes&rdquo; in the Operations Manager 2.3 UI, then press &ldquo;Apply Changes&rdquo;.</p><p>At the end of this step, you will have a PAS 2.3.0 foundation, with networking
optionally provided by VMware NSX-T tile 2.3.0, where each job VM is located in
the appropriate NSX-T load balancer server pool.</p><h2 id=9-gotchas>9. Gotchas<a hidden class=anchor aria-hidden=true href=#9-gotchas>#</a></h2><p>An incident occurred where the NSX-T load balancer was unable to forward traffic
to the newly-deployed gorouters.</p><p>Rebooting one of the NSX-T Edges restored the flow of traffic from the NSX-T
load balancer to the gorouters. We are unsure of the root cause; however, since
existing load balancer pools continued to function, we suspect the Edge had
become incapable of honoring updates.</p><h2 id=10-troubleshooting>10. Troubleshooting<a hidden class=anchor aria-hidden=true href=#10-troubleshooting>#</a></h2><p>We find the Traceflow (<em>Tools → Traceflow</em>) networking tool
invaluable when debugging network failures. In the screenshot below, we examine
the <code>gorouter/0</code> VM&rsquo;s ability to communicate with the load balancer (IP address
10.144.15.4) on port 443 (HTTPS). In this case, we determined the gorouter&rsquo;s CID
using the <code>bosh vms</code> command, but we could have just as easily determined it by
looking it up on the <em>Status</em> page of the PAS tile on Operations Manager:</p><figure><img loading=lazy src=https://user-images.githubusercontent.com/1020675/48797866-2beead80-ecb8-11e8-8be2-ceb62b5a503c.png></figure><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><p>VM Extensions we used for our deployment:</p><ul><li><a href=https://github.com/cunnie/deployments/blob/1ed754e555722df3ce5f503d4d4d27820ac0a2ad/nsx-t/gorouter-443-80-vm-extension.json>Router</a></li><li><a href=https://github.com/cunnie/deployments/blob/1ed754e555722df3ce5f503d4d4d27820ac0a2ad/nsx-t/ssh-proxy-vm-extension.json>Diego Brain</a></li><li><a href=https://github.com/cunnie/deployments/blob/1ed754e555722df3ce5f503d4d4d27820ac0a2ad/nsx-t/tcp-router-vm-extension.json>TCP Router</a></li></ul><p>Our BASH commands we followed when we upgraded: <a href=https://github.com/cunnie/deployments/blob/018c61d891a68bb78f3750b466165b00f3176817/nsx-t/scripts.md>script</a>.</p><h2 id=acknowledgements>Acknowledgements<a hidden class=anchor aria-hidden=true href=#acknowledgements>#</a></h2><p>Josh Gray of the PEZ Team was instrumental in discovering the behavior and
providing resources to test remediation. The BOSH vSphere CPI Team provided
invaluable support.</p><p>Bryan Kelly of Cerner provided invaluable feedback, pointing out that this
process is relevant not only to 2.2 → 2.3 upgrades but also to stemcell upgrades
and tile upgrades.</p><h2 id=corrections--updates>Corrections & Updates<a hidden class=anchor aria-hidden=true href=#corrections--updates>#</a></h2><p><em>2018-11-20</em></p><p>Added <em>Gotchas</em> and <em>Troubleshooting</em> sections after suggestions from Bryan Kelly.</p><h2 id=footnotes>Footnotes<a hidden class=anchor aria-hidden=true href=#footnotes>#</a></h2><p><a id=dynamic><sup>[or Dynamic]</sup></a> This blog post focuses on static
pools, but the procedure is identical for dynamic pools since the BOSH
vSphere CPI <a href=https://bosh.io/docs/vsphere-cpi/#resource-pools>&ldquo;looks up the NSGroup [of the server pool] and adds the VM to the
NSGroup&rdquo;</a>.</p><p><a id=resource_config><sup>[resource_config]</sup></a> In a prettified JSON file, our change would look like the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    &#34;instance_type&#34;: {
</span></span><span style=display:flex><span>      &#34;id&#34;: &#34;automatic&#34;
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    &#34;instances&#34;: 2,
</span></span><span style=display:flex><span>    &#34;nsx_security_groups&#34;: null,
</span></span><span style=display:flex><span>    &#34;nsx_lbs&#34;: [],
</span></span><span style=display:flex><span>    &#34;additional_vm_extensions&#34;: [
</span></span><span style=display:flex><span><span style=color:#a6e22e>+     &#34;http_https_lb&#34;
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>    ]
</span></span><span style=display:flex><span>  }
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://blog.nono.io/post/ssh_handshake_failed/><span class=title>« Prev</span><br><span>Troubleshooting Obscure OpenSSH Failures</span></a>
<a class=next href=https://blog.nono.io/post/vcenter_6.7_tls/><span class=title>Next »</span><br><span>How to Install a TLS Certificate on vCenter Server Appliance (VCSA) 6.7 [Updated for vCenter 7]</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Safely Upgrading PAS 2.2 with NSX-T Load Balancers on twitter" href="https://twitter.com/intent/tweet/?text=Safely%20Upgrading%20PAS%202.2%20with%20NSX-T%20Load%20Balancers&url=https%3a%2f%2fblog.nono.io%2fpost%2fupgrade_2.2-2.3_on_nsx-t%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Safely Upgrading PAS 2.2 with NSX-T Load Balancers on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.nono.io%2fpost%2fupgrade_2.2-2.3_on_nsx-t%2f&title=Safely%20Upgrading%20PAS%202.2%20with%20NSX-T%20Load%20Balancers&summary=Safely%20Upgrading%20PAS%202.2%20with%20NSX-T%20Load%20Balancers&source=https%3a%2f%2fblog.nono.io%2fpost%2fupgrade_2.2-2.3_on_nsx-t%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Safely Upgrading PAS 2.2 with NSX-T Load Balancers on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.nono.io%2fpost%2fupgrade_2.2-2.3_on_nsx-t%2f&title=Safely%20Upgrading%20PAS%202.2%20with%20NSX-T%20Load%20Balancers"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Safely Upgrading PAS 2.2 with NSX-T Load Balancers on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.nono.io%2fpost%2fupgrade_2.2-2.3_on_nsx-t%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Safely Upgrading PAS 2.2 with NSX-T Load Balancers on whatsapp" href="https://api.whatsapp.com/send?text=Safely%20Upgrading%20PAS%202.2%20with%20NSX-T%20Load%20Balancers%20-%20https%3a%2f%2fblog.nono.io%2fpost%2fupgrade_2.2-2.3_on_nsx-t%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Safely Upgrading PAS 2.2 with NSX-T Load Balancers on telegram" href="https://telegram.me/share/url?text=Safely%20Upgrading%20PAS%202.2%20with%20NSX-T%20Load%20Balancers&url=https%3a%2f%2fblog.nono.io%2fpost%2fupgrade_2.2-2.3_on_nsx-t%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.nono.io/>Brian Cunnie's Technical Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>